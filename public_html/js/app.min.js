var body = document.body, timer;

window.addEventListener('scroll', function() {
    clearTimeout(timer);
    if(!body.classList.contains('disable-hover'))
    {
        body.classList.add('disable-hover')
    }

    timer = setTimeout(function(){
        body.classList.remove('disable-hover')
    }, 500);
}, false);

// Find, Replace, Case
// i.e "Test to see if this works? (Yes|No)".replaceAll('(Yes|No)', 'Yes!');
// i.e.2 "Test to see if this works? (Yes|No)".replaceAll('(yes|no)', 'Yes!', true);
String.prototype.replaceAll = function(_f, _r, _c){ 
    var o = this.toString();
    var r = '';
    var s = o;
    var b = 0;
    var e = -1;
    if(_c){ _f = _f.toLowerCase(); s = o.toLowerCase(); }

    while((e=s.indexOf(_f)) > -1)
    {
        r += o.substring(b, b+e) + _r;
        s = s.substring(e+_f.length, s.length);
        b += e+_f.length;
    }

    // Add Leftover
    if(s.length>0){ r+=o.substring(o.length-s.length, o.length); }

    // Return New String
    return r;
};

if (!Array.prototype.indexOf) {
    Array.prototype.indexOf = function (searchElement, fromIndex) {
      if ( this === undefined || this === null ) {
        throw new TypeError( '"this" is null or not defined' );
      }

      var length = this.length >>> 0; // Hack to convert object.length to a UInt32

      fromIndex = +fromIndex || 0;

      if (Math.abs(fromIndex) === Infinity) {
        fromIndex = 0;
      }

      if (fromIndex < 0) {
        fromIndex += length;
        if (fromIndex < 0) {
          fromIndex = 0;
        }
      }

      for (;fromIndex < length; fromIndex++) {
        if (this[fromIndex] === searchElement) {
          return fromIndex;
        }
      }

      return -1;
    };
}

// Simple JavaScript Templating
// John Resig - http://ejohn.org/ - MIT Licensed
;(function(){
    var cache = {};

    this.tmpl = function tmpl(str, data){
        // Figure out if we're getting a template, or if we need to
        // load the template - and be sure to cache the result.
        var fn = !/\W/.test(str) ?
            cache[str] = cache[str] ||
                tmpl(document.getElementById(str).innerHTML) :

            // Generate a reusable function that will serve as a template
            // generator (and which will be cached).
            new Function("obj",
                "var p=[],print=function(){p.push.apply(p,arguments);};" +

                    // Introduce the data as local variables using with(){}
                    "with(obj){p.push('" +

                    // Convert the template into pure JavaScript
                    str
                        .replace(/[\r\t\n]/g, " ")
                        .split("<%").join("\t")
                        .replace(/((^|%>)[^\t]*)'/g, "$1\r")
                        .replace(/\t=(.*?)%>/g, "',$1,'")
                        .split("\t").join("');")
                        .split("%>").join("p.push('")
                        .split("\r").join("\\'")
                    + "');}return p.join('');");

        // Provide some basic currying to the user
        return data ? fn( data ) : fn;
    };
})();

(function($) {
    $.app = {
        run: function()
        {
            $.app.module.bear.init();
            $.app.module.form_ajax();
            $.app.module.resize(function(){ }, 500);

            // $('.header-logo').on('click', function(e){
            //     e.preventDefault();
            //     var vh = $(window).height();
                
            //     $('#wrapper-main').find('.wrapper-main').css({ 'height': vh, 'top': -vh });
            //     $('#wrapper-main').find('.wrapper-main').stop().show().animate({ 'top': '0' }, 250, function(){
            //         $('#wrapper-main').addClass('wrapper-main-open');
            //     });
            // });

            $(".integer").on('keypress', function (e) { if( [0, 8].indexOf( e.which ) < 0 && ( e.which < 48 || e.which > 57 ) ) { return false; } });
            
            $('body').on('click', '.toggle-trigger', function(e){
                e.preventDefault();

                var id = $(this).attr('href');
                if( $(id).length > 0 )
                {
                    if( $(this).hasClass('ul_list-item_link-drop') )
                    {
                        $(this).toggleClass('ul_list-item_link-drop-up');
                    }

                    $(id).slideToggle(150);
                    $('html, body').animate({ scrollTop: $(this).offset().top }, 'slow');
                }
            });
        
            $('body').on('mouseenter', '.nav-list-item', function(e){
                if ($(this).find('.submenu').length)
                {
                    var $this = $(this),
                        $submenu = $this.find('.submenu');

                    setTimeout(function(){
                        $submenu.addClass('is-show');

                        setTimeout(function(){
                            $submenu.addClass('is-animate');
                        }, 10);
                    }, 50);
                }
            });
            
            $('body').on('mouseleave', '.nav-list-item', function(e){
                if ($(this).find('.submenu').length)
                {
                    var $this = $(this),
                        $submenu = $this.find('.submenu');

                    setTimeout(function(){
                        $submenu.removeClass('is-animate');

                        setTimeout(function(){
                            $submenu.removeClass('is-show');
                        }, 250);
                    }, 50);
                }
            });
            
            if( typeof $.initPopups !== 'undefined' )
            {
                $.initPopups();

                if(window.location.hash.length > 1 && $(window.location.hash).hasClass('popup') )
                {
                    try {
                        $.popup.open(window.location.hash.substr(1));
                    }
                    catch(e) {}
                }
            }
        },
        module: {
            bear: {
                timeout: 20000,
                element: '#bear',
                move: function(_go_)
                {
                    var _self_ = this, timeout = _self_.timeout;
                    _go_ = window.innerWidth - _go_ - 298;
                    
                    if(_go_ > window.innerWidth)
                    {
                        _go_ = window.innerWidth;
                    }

                    if(typeof($.cookie('_go_')) !== 'undefined')
                    {
                        _go_ = $.cookie('_go_');
                    }

                    $.cookie('_go_', _go_, { expires: 7, path: '/' });

                    if(typeof($.cookie('coordinate')) !== 'undefined' && $.cookie('coordinate') !== '')
                    {
                        var coord = Math.floor($.cookie('coordinate'));
                        
                        $(_self_.element).css({ 'left': coord });

                        var percent = 100 - Math.floor(((window.innerWidth - coord) * 100) / window.innerWidth);
                        var timeout = timeout - ( timeout * percent / 100);
                    }
                   
                    $(_self_.element).stop().animate({ left: _go_ }, { duration: timeout, step: function(now, fx) {
                        
                        $.cookie('coordinate', now, { expires: 7, path: '/' });

                        if(now == _go_)
                        {
                            $(_self_.element).toggleClass('footer-bear-reverse');

                            $.removeCookie('coordinate', { path: '/' });
                            $.removeCookie('_go_', { path: '/' });

                            $.app.module.bear.move(_go_);
                        }
                    }});
                },
                rotate: function( deg )
                {
                    $(this.element).find('.footer-bear-inner').stop().animate({ rotation: deg }, { duration: 1800, step: function(now, fx) {
                        $(this).css({"transform": "rotate("+now+"deg)"});
                        if(now == deg)
                        {
                            $.app.module.bear.rotate((deg*-1));
                        }
                    }});
                },
                init: function()
                {
                    this.rotate(6);
                    this.move(0);
                }
            },
            resize: function( callback, time )
            {
                $(window).resize(function(e){
                    window.resizeEvt;
                    $(window).resize(function(){
                    clearTimeout(window.resizeEvt);
                        window.resizeEvt = setTimeout(function(){
                            callback.apply();
                        }, time);
                    });
                });
            },
            googleMap: function()
            {
                var mapOptions = {
                    zoom: 16,
                    zoomControl: !0,
                    zoomControlOptions: {
                        style: google.maps.ZoomControlStyle.LARGE,
                        position: google.maps.ControlPosition.LEFT_TOP
                    },
                    panControl: !0,
                    panControlOptions: {
                        position: google.maps.ControlPosition.LEFT_TOP
                    },
                    scrollwheel: !1,
                    navigationControl: !1,
                    mapTypeControl: !1,
                    scaleControl: !1,
                    draggable: !0,
                    styles: [
                        {
                            stylers: [
                                { hue: '#adced5' }
                            ]
                        },
                        {
                            elementType: 'labels',
                            stylers: [
                                { visibility: 'on' }
                            ]
                        },
                        {
                            featureType: 'water',
                            stylers: [
                                { color: '#c9dfe4' }
                            ]
                        }
                    ],
                    disableDoubleClickZoom: !0,
                    center: new google.maps.LatLng(43.569787, 39.756362)
                };

                var map = new google.maps.Map(document.getElementById( 'map-conteiner' ), mapOptions);
                
                var bullet = {
                    url: 'images/map-bullet.png',
                    size: new google.maps.Size(39, 52),
                    origin: new google.maps.Point(0,0),
                    anchor: new google.maps.Point(39, 52)
                };
                
                new google.maps.Marker({
                    position: new google.maps.LatLng(43.569787, 39.756362),
                    map: map,
                    icon: bullet
                });
            },
            cache: function( s, cb )
            {
                try {
                    var a, g = [], i, x, cnt = s.length, p = { i: {}, ac: 0, c: 0 }, cb = cb || function(){};
                    
                    function y( index, src )
                    {
                        g.push( src );
                        
                        if( g.length >= cnt )
                        {
                            cb.call();
                        }
                        
                        p.c++
                    }

                    for (x in s)
                    {
                        a = s[x];
                        
                        i = new Image();
                        i.src = a;

                        i.onload = y( x, a );

                        p.i[a] = i;
                        p.ac++
                    }
                }
                catch(e) {}
            },
            retina: function()
            {
                if( 'devicePixelRatio' in window && window.devicePixelRatio == 2 )
                {
                    var i=0, src, img = $( 'img.replace-2x' ).get(), l = img.length;
                    for (i; i<l; i++)
                    {
                        src = img[i].src;
                        src = src.replace(/\.(png|jpg|gif)+$/i, '@2x.$1');
                        img[i].src = src;
                    }
                }
            },
            isUndefined: function( obj )
            {
                return obj === void 0;
            },
            updateImage: function(element)
            {
                if( $(element).length > 0 ) {
                    var image = $(element).attr('src').split( '?' )[0] ;
                    $(element).attr('src', image + '?v=' + Math.random() );
                }
                return false;
            },
            random: function(min, max)
            {
                min = min || 0 ;
                max = max || 100 ;
                return Math.floor(Math.random() * ( max - min + 1 )) + min ;
            }
        }
    };

    $.app.movies = {};
    $.app.movies.load = function() {
        alert( 'load more' );
        return false;
    };

    $.app.module.form_validation_default = function($form, errors) {
        $form.find('.form_error_block').hide();
        $form.find('.error').removeClass('error');
        $form.find('.checkbox__label-error').removeClass('checkbox__label-error');
        if(errors) {
            var $error_block = $('#form-errors');
            $error_block.html('');

            for(fieldName in errors)
            {
                $field = $form.find('input[name="'+fieldName+'"]');
                $error_block.append(
                    [
                        '<span>',
                        $field.data('error'),
                        '</span>'
                    ].join('')
                );
            }
        }
    };

    $.app.callback_stack = {};
    $.app.callback_stack.form_ajax_default = function($form, response) {
        if(response.status) {
            if(response.hasOwnProperty('redirect_url')) {
                window.location.href = response.redirect_url;
            }
        }
        else if(response.errors) {
            $.app.module.form_validation_default($form, response.errors);
        }
        
        if(response.hasOwnProperty('message')) {
            $.popup.message(response.title, response.message);
        }
    };

    $.app.module.form_ajax = function() {
        $('body').on('submit' ,'.form-ajax', function(e) {
            var $form = $(this);
            e.preventDefault();
            
            $.ajax({
                url: $form.attr('action'),
                type: ($form.attr('method') || 'post'),
                data: $form.serialize(),
                dataType: 'json',
                success: function(response)
                {
                    if($form.data('callback') && $.app.callback_stack.hasOwnProperty($form.data('callback'))) {
                        $.app.callback_stack[$form.data('callback')]($form, response);
                    }
                    else {
                        $.app.callback_stack.form_ajax_default($form, response);
                    }

                    if( response.status === true && response.message !== '' )
                    {
                        $.popup.message( response.title, response.message );
                    }
                },
                error: function(response)
                {
                    $.app.callback_stack.form_ajax_default($form, response);
                    alert("error");
                }
            });
        });
    };

    $.app.module.upload_button = function(){
        $('body').on('submit' ,'.form-file-upload', function(e) {
            return AIM.submit(this, {
                onStart: function()
                {

                },
                onComplete: function( result )
                {
                    if( typeof result === 'object' && result.status === true && typeof result.photo_url !== 'undefined' )
                    { }
                }
            });
        });
        
        $(document).on('change', '.upload_button_onchange', function(){
            if( $(this).closest('.upload_button').find('.upload_button_field').length > 0 )
            {
                $(this).closest('.upload_button').find('.upload_button_field').html( $(this).val() );
            }
        });
    };

    $.app.custom_placeholder = function() {
        if (Modernizr.touch) {
            return;
        }

        $('input, textarea').each(function() {
            var $input = $(this), $inputWrapper, $placeholder, placeholderText = $input.attr('placeholder');
            if(placeholderText) {
                $inputWrapper = $input.parent();
                $placeholder = $('<div class="default-input__placeholder" style="line-height: '+($input.is('textarea') ? '36px' : ( $inputWrapper.innerHeight() == 0 ? '36' : $inputWrapper.innerHeight() )+'px')+'">'+placeholderText+'</div>');
                $placeholder[$input.val().length ? 'hide' : 'show']();
                $input.addClass('custom-placeholder').attr('placeholder', '');
                $inputWrapper.append($placeholder);
            }
        });
        
        $('body').on('blur', '.custom-placeholder', function() {
            var $this = $(this);
            if(!$this.val().length) {
                $this.parent().find('.default-input__placeholder').show();
            }
        });
        $('body').on('focus', '.custom-placeholder', function() {
            $(this).parent().find('.default-input__placeholder').hide();
        });

        $('body').on('click', '.default-input__placeholder', function() {
            var $this = $(this);
    
            $this.hide();
            $this.parent().find('.custom-placeholder').trigger('focus');
        });
        $('body').on('selectstart', '.default-input__placeholder', false);
    };

    $.app.run();
})(jQuery);
;(function($) {
    $.cart = {
        initRequestClick: function()
        {
            $('body').on('click', '.j-remover-request', function(e){
                e.preventDefault();

                var $remover = $(this).closest('.remover'), product = $(this).data('element'), status = $(this).data('status');

                if (status !== 0)
                {
                    if ($('#cart-product-'+product).length)
                    {
                        $('#cart-product-'+product).fadeOut(function(){
                            $(this).remove();
                        });
                    }

                    console.log(product + ' as ' + status);
                }
                
                setTimeout(function(){
                    $remover.fadeOut(function(){
                        $(this).remove();
                    });
                }, 150);

                return !1;
            });
        },

    	init: function()
    	{
    		$.cart.initBuy();
    		$.cart.initRemove();
    		$.cart.initControll();

            $.cart.initRequestClick();

            $('body').on('click', '.j-cart-remove', function(e){
                e.preventDefault();

                if (!$(this).closest('.list-item-footer').find('.remover').length)
                {
                    var $remover, product = $(this).data('element');

                    $remover = [
                        '<div class="remover">',
                            '<div class="remover__content">',
                                '<div class="remover__title">',
                                    'Действительно удалить?',
                                '</div>',

                                '<div class="remover__buttons">',
                                    '<a href="#" data-element="' + product + '" data-status="1" class="remover__button is-yes j-remover-request">Да</a>',
                                    '<a href="#" data-element="' + product + '" data-status="0" class="remover__button is-no j-remover-request">Нет</a>',
                                '</div>',
                            '</div>',
                        '</div>'
                    ].join(' ');
                    
                    $(this).closest('.list-item-footer').append($remover);
                }
                else
                {
                    var $remover = $(this).closest('.list-item-footer').find('.remover');

                    $remover.fadeOut(function(){
                        $(this).remove();
                    });
                }

                return !1;
            });
    	},

    	initBuy: function()
    	{
    		$('.add-cart-trigger').on('click', function(e){
    			e.preventDefault();
    			$.cart.buyItem( $(this).attr('href').split('-')[1] );
    		});
    	},
    	initControll: function()
    	{
    		$('.increase-cart-trigger').on('click', function(e){
    			e.preventDefault();
    			$.cart.increase( $(this).attr('href').split('-')[1] );
    		});

			$('.decrease-cart-trigger').on('click', function(e){
    			e.preventDefault();
    			$.cart.decrease( $(this).attr('href').split('-')[1] );
    		});
    	},
    	initRemove: function()
    	{
    		$('.remove-cart-trigger').on('click', function(e){
    			e.preventDefault();
    			$.cart.removeItem($(this).attr('href').split('-')[1], this);
    		});
    	},
    	removeItem: function(id, _self_)
		{
			$.post('/ajax/cart/remove/', { item: id }, function(data) {
				if( $('#list-item-'+id).find('.incart').length > 0 )
				{
					$('#list-item-'+id).find('.incart').remove();
				}
				
				if($(_self_).hasClass('list-item-incart'))
				{
					$(_self_).remove();
				}
				else
				{
					$('#incart-item-'+id).html( '<a href="#item-'+id+'" title="Добавить в корзину" class="button-cart add-cart-trigger">Купить кресло</a>' );
					$.cart.initBuy();
				}

		        $.cart.addedItem('Товар удален из корзины.');
			});
		},
		buyItem: function(id)
		{
			var count = 1;
			
			if( $('#count-'+id).length > 0 ) {
				count = parseInt( $('#count-'+id).val() ) ;
			}

			$.post('../cart.json', { item: id, count: count }, function(data) {
				if( $('#cart-count').length > 0 )
				{
					$('#cart-count').html( data.count );
				}
				
				if( $('#cart-price').length > 0 )
				{
					$('#cart-price').html( data.money );
				}
				
				if( $('#count-'+id).length > 0 )
				{
					$('#count-'+id).val(1);
				}

				if( $('#list-item-'+id).find('.incart').length == 0 ) {
					$('#incart-item-'+id).html( '<a href="#item-' + id + '" title="Удалить из корзины" class="button-remove remove-cart-trigger">Кресло в корзине</a>' );

					$.cart.initRemove();
				}

				$.cart.addedItem();
			}, 'JSON');
		},
		addedItem: function(text, large)
		{
		    text = !text ? 'Товар добавлен в корзину.' : text ;
		    large = !large ? false : large ;
		    var timeout = !large ? 1500 : 5000, addclass = !large ? '' : ' adding-large' ;
		    
		    if( $('body').find('#item-added-to-cart').length == 0 ) {
		        $('body').append('<div id="item-added-to-cart" class="showadding' + addclass + '"><div class="adding-inner"><div class="adding-content">' + text + '</div></div></div>');
		        setTimeout(function(){
		            $('body').find('#item-added-to-cart').remove() ;
		        },timeout);
		    }
		    else {
		        setTimeout(function(){
		            $('body').find('#item-added-to-cart').remove() ;
		        },timeout);
		    }
		},
		increase: function(id)
		{
			if( $('#count-'+id).length > 0 ) {
		        var value = parseInt( $('#count-'+id).val() ) ;
		            value = !value ? 0 : value ;
		            
		            value++ ;
		            
		            $('#count-'+id).val( value ) ;
		    }
			
			if($('#cart-table').length > 0)
			{
				$.cart.reTotal(id);
			}
		},
		decrease: function(id)
		{
			if( $('#count-'+id).length > 0 )
			{
				var value = parseInt( $('#count-'+id).val() ) ;
					value = !value ? 1 : value ;
					
					if( value >= 2 ) value-- ;
					else value = 1 ;
					
					$('#count-'+id).val( value ) ;
			}
			
			if($('#cart-table').length > 0)
			{
				$.cart.reTotal(id);
			}
		},
		reTotal: function(id)
		{
			if( $('#count-'+id).length > 0 )
			{
				var count = parseInt( $('#count-'+id).val() );
				
				$.post('/ajax/cart/recount/', { item: id, count: count }, function(data) {
					var price = parseInt( $('#cart-item-price-'+id).html() );
					var total = count * price;

					$('#cart-item-total-'+id).html(total) ;
					$('#cart-total-count').html(data.count);
					$('#cart-total-price').html(data.money);

					if( $('#cart-count').length > 0 )
					{
						$('#cart-count').html( data.count );
					}
					
					if( $('#cart-price').length > 0 )
					{
						$('#cart-price').html( data.money );
					}
				}, 'JSON');
			}
		}
	}

	$.cart.init();
})(jQuery);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIl9fYXBwLmpzIiwiX2NhcnQuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN2Z0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6ImFwcC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgYm9keSA9IGRvY3VtZW50LmJvZHksIHRpbWVyO1xuXG53aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignc2Nyb2xsJywgZnVuY3Rpb24oKSB7XG4gICAgY2xlYXJUaW1lb3V0KHRpbWVyKTtcbiAgICBpZighYm9keS5jbGFzc0xpc3QuY29udGFpbnMoJ2Rpc2FibGUtaG92ZXInKSlcbiAgICB7XG4gICAgICAgIGJvZHkuY2xhc3NMaXN0LmFkZCgnZGlzYWJsZS1ob3ZlcicpXG4gICAgfVxuXG4gICAgdGltZXIgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7XG4gICAgICAgIGJvZHkuY2xhc3NMaXN0LnJlbW92ZSgnZGlzYWJsZS1ob3ZlcicpXG4gICAgfSwgNTAwKTtcbn0sIGZhbHNlKTtcblxuLy8gRmluZCwgUmVwbGFjZSwgQ2FzZVxuLy8gaS5lIFwiVGVzdCB0byBzZWUgaWYgdGhpcyB3b3Jrcz8gKFllc3xObylcIi5yZXBsYWNlQWxsKCcoWWVzfE5vKScsICdZZXMhJyk7XG4vLyBpLmUuMiBcIlRlc3QgdG8gc2VlIGlmIHRoaXMgd29ya3M/IChZZXN8Tm8pXCIucmVwbGFjZUFsbCgnKHllc3xubyknLCAnWWVzIScsIHRydWUpO1xuU3RyaW5nLnByb3RvdHlwZS5yZXBsYWNlQWxsID0gZnVuY3Rpb24oX2YsIF9yLCBfYyl7IFxuICAgIHZhciBvID0gdGhpcy50b1N0cmluZygpO1xuICAgIHZhciByID0gJyc7XG4gICAgdmFyIHMgPSBvO1xuICAgIHZhciBiID0gMDtcbiAgICB2YXIgZSA9IC0xO1xuICAgIGlmKF9jKXsgX2YgPSBfZi50b0xvd2VyQ2FzZSgpOyBzID0gby50b0xvd2VyQ2FzZSgpOyB9XG5cbiAgICB3aGlsZSgoZT1zLmluZGV4T2YoX2YpKSA+IC0xKVxuICAgIHtcbiAgICAgICAgciArPSBvLnN1YnN0cmluZyhiLCBiK2UpICsgX3I7XG4gICAgICAgIHMgPSBzLnN1YnN0cmluZyhlK19mLmxlbmd0aCwgcy5sZW5ndGgpO1xuICAgICAgICBiICs9IGUrX2YubGVuZ3RoO1xuICAgIH1cblxuICAgIC8vIEFkZCBMZWZ0b3ZlclxuICAgIGlmKHMubGVuZ3RoPjApeyByKz1vLnN1YnN0cmluZyhvLmxlbmd0aC1zLmxlbmd0aCwgby5sZW5ndGgpOyB9XG5cbiAgICAvLyBSZXR1cm4gTmV3IFN0cmluZ1xuICAgIHJldHVybiByO1xufTtcblxuaWYgKCFBcnJheS5wcm90b3R5cGUuaW5kZXhPZikge1xuICAgIEFycmF5LnByb3RvdHlwZS5pbmRleE9mID0gZnVuY3Rpb24gKHNlYXJjaEVsZW1lbnQsIGZyb21JbmRleCkge1xuICAgICAgaWYgKCB0aGlzID09PSB1bmRlZmluZWQgfHwgdGhpcyA9PT0gbnVsbCApIHtcbiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvciggJ1widGhpc1wiIGlzIG51bGwgb3Igbm90IGRlZmluZWQnICk7XG4gICAgICB9XG5cbiAgICAgIHZhciBsZW5ndGggPSB0aGlzLmxlbmd0aCA+Pj4gMDsgLy8gSGFjayB0byBjb252ZXJ0IG9iamVjdC5sZW5ndGggdG8gYSBVSW50MzJcblxuICAgICAgZnJvbUluZGV4ID0gK2Zyb21JbmRleCB8fCAwO1xuXG4gICAgICBpZiAoTWF0aC5hYnMoZnJvbUluZGV4KSA9PT0gSW5maW5pdHkpIHtcbiAgICAgICAgZnJvbUluZGV4ID0gMDtcbiAgICAgIH1cblxuICAgICAgaWYgKGZyb21JbmRleCA8IDApIHtcbiAgICAgICAgZnJvbUluZGV4ICs9IGxlbmd0aDtcbiAgICAgICAgaWYgKGZyb21JbmRleCA8IDApIHtcbiAgICAgICAgICBmcm9tSW5kZXggPSAwO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGZvciAoO2Zyb21JbmRleCA8IGxlbmd0aDsgZnJvbUluZGV4KyspIHtcbiAgICAgICAgaWYgKHRoaXNbZnJvbUluZGV4XSA9PT0gc2VhcmNoRWxlbWVudCkge1xuICAgICAgICAgIHJldHVybiBmcm9tSW5kZXg7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgcmV0dXJuIC0xO1xuICAgIH07XG59XG5cbi8vIFNpbXBsZSBKYXZhU2NyaXB0IFRlbXBsYXRpbmdcbi8vIEpvaG4gUmVzaWcgLSBodHRwOi8vZWpvaG4ub3JnLyAtIE1JVCBMaWNlbnNlZFxuOyhmdW5jdGlvbigpe1xuICAgIHZhciBjYWNoZSA9IHt9O1xuXG4gICAgdGhpcy50bXBsID0gZnVuY3Rpb24gdG1wbChzdHIsIGRhdGEpe1xuICAgICAgICAvLyBGaWd1cmUgb3V0IGlmIHdlJ3JlIGdldHRpbmcgYSB0ZW1wbGF0ZSwgb3IgaWYgd2UgbmVlZCB0b1xuICAgICAgICAvLyBsb2FkIHRoZSB0ZW1wbGF0ZSAtIGFuZCBiZSBzdXJlIHRvIGNhY2hlIHRoZSByZXN1bHQuXG4gICAgICAgIHZhciBmbiA9ICEvXFxXLy50ZXN0KHN0cikgP1xuICAgICAgICAgICAgY2FjaGVbc3RyXSA9IGNhY2hlW3N0cl0gfHxcbiAgICAgICAgICAgICAgICB0bXBsKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHN0cikuaW5uZXJIVE1MKSA6XG5cbiAgICAgICAgICAgIC8vIEdlbmVyYXRlIGEgcmV1c2FibGUgZnVuY3Rpb24gdGhhdCB3aWxsIHNlcnZlIGFzIGEgdGVtcGxhdGVcbiAgICAgICAgICAgIC8vIGdlbmVyYXRvciAoYW5kIHdoaWNoIHdpbGwgYmUgY2FjaGVkKS5cbiAgICAgICAgICAgIG5ldyBGdW5jdGlvbihcIm9ialwiLFxuICAgICAgICAgICAgICAgIFwidmFyIHA9W10scHJpbnQ9ZnVuY3Rpb24oKXtwLnB1c2guYXBwbHkocCxhcmd1bWVudHMpO307XCIgK1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIEludHJvZHVjZSB0aGUgZGF0YSBhcyBsb2NhbCB2YXJpYWJsZXMgdXNpbmcgd2l0aCgpe31cbiAgICAgICAgICAgICAgICAgICAgXCJ3aXRoKG9iail7cC5wdXNoKCdcIiArXG5cbiAgICAgICAgICAgICAgICAgICAgLy8gQ29udmVydCB0aGUgdGVtcGxhdGUgaW50byBwdXJlIEphdmFTY3JpcHRcbiAgICAgICAgICAgICAgICAgICAgc3RyXG4gICAgICAgICAgICAgICAgICAgICAgICAucmVwbGFjZSgvW1xcclxcdFxcbl0vZywgXCIgXCIpXG4gICAgICAgICAgICAgICAgICAgICAgICAuc3BsaXQoXCI8JVwiKS5qb2luKFwiXFx0XCIpXG4gICAgICAgICAgICAgICAgICAgICAgICAucmVwbGFjZSgvKChefCU+KVteXFx0XSopJy9nLCBcIiQxXFxyXCIpXG4gICAgICAgICAgICAgICAgICAgICAgICAucmVwbGFjZSgvXFx0PSguKj8pJT4vZywgXCInLCQxLCdcIilcbiAgICAgICAgICAgICAgICAgICAgICAgIC5zcGxpdChcIlxcdFwiKS5qb2luKFwiJyk7XCIpXG4gICAgICAgICAgICAgICAgICAgICAgICAuc3BsaXQoXCIlPlwiKS5qb2luKFwicC5wdXNoKCdcIilcbiAgICAgICAgICAgICAgICAgICAgICAgIC5zcGxpdChcIlxcclwiKS5qb2luKFwiXFxcXCdcIilcbiAgICAgICAgICAgICAgICAgICAgKyBcIicpO31yZXR1cm4gcC5qb2luKCcnKTtcIik7XG5cbiAgICAgICAgLy8gUHJvdmlkZSBzb21lIGJhc2ljIGN1cnJ5aW5nIHRvIHRoZSB1c2VyXG4gICAgICAgIHJldHVybiBkYXRhID8gZm4oIGRhdGEgKSA6IGZuO1xuICAgIH07XG59KSgpO1xuXG4oZnVuY3Rpb24oJCkge1xuICAgICQuYXBwID0ge1xuICAgICAgICBydW46IGZ1bmN0aW9uKClcbiAgICAgICAge1xuICAgICAgICAgICAgJC5hcHAubW9kdWxlLmJlYXIuaW5pdCgpO1xuICAgICAgICAgICAgJC5hcHAubW9kdWxlLmZvcm1fYWpheCgpO1xuICAgICAgICAgICAgJC5hcHAubW9kdWxlLnJlc2l6ZShmdW5jdGlvbigpeyB9LCA1MDApO1xuXG4gICAgICAgICAgICAvLyAkKCcuaGVhZGVyLWxvZ28nKS5vbignY2xpY2snLCBmdW5jdGlvbihlKXtcbiAgICAgICAgICAgIC8vICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAvLyAgICAgdmFyIHZoID0gJCh3aW5kb3cpLmhlaWdodCgpO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gICAgICQoJyN3cmFwcGVyLW1haW4nKS5maW5kKCcud3JhcHBlci1tYWluJykuY3NzKHsgJ2hlaWdodCc6IHZoLCAndG9wJzogLXZoIH0pO1xuICAgICAgICAgICAgLy8gICAgICQoJyN3cmFwcGVyLW1haW4nKS5maW5kKCcud3JhcHBlci1tYWluJykuc3RvcCgpLnNob3coKS5hbmltYXRlKHsgJ3RvcCc6ICcwJyB9LCAyNTAsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAvLyAgICAgICAgICQoJyN3cmFwcGVyLW1haW4nKS5hZGRDbGFzcygnd3JhcHBlci1tYWluLW9wZW4nKTtcbiAgICAgICAgICAgIC8vICAgICB9KTtcbiAgICAgICAgICAgIC8vIH0pO1xuXG4gICAgICAgICAgICAkKFwiLmludGVnZXJcIikub24oJ2tleXByZXNzJywgZnVuY3Rpb24gKGUpIHsgaWYoIFswLCA4XS5pbmRleE9mKCBlLndoaWNoICkgPCAwICYmICggZS53aGljaCA8IDQ4IHx8IGUud2hpY2ggPiA1NyApICkgeyByZXR1cm4gZmFsc2U7IH0gfSk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgICQoJ2JvZHknKS5vbignY2xpY2snLCAnLnRvZ2dsZS10cmlnZ2VyJywgZnVuY3Rpb24oZSl7XG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgICAgICAgICAgdmFyIGlkID0gJCh0aGlzKS5hdHRyKCdocmVmJyk7XG4gICAgICAgICAgICAgICAgaWYoICQoaWQpLmxlbmd0aCA+IDAgKVxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgaWYoICQodGhpcykuaGFzQ2xhc3MoJ3VsX2xpc3QtaXRlbV9saW5rLWRyb3AnKSApXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICQodGhpcykudG9nZ2xlQ2xhc3MoJ3VsX2xpc3QtaXRlbV9saW5rLWRyb3AtdXAnKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICQoaWQpLnNsaWRlVG9nZ2xlKDE1MCk7XG4gICAgICAgICAgICAgICAgICAgICQoJ2h0bWwsIGJvZHknKS5hbmltYXRlKHsgc2Nyb2xsVG9wOiAkKHRoaXMpLm9mZnNldCgpLnRvcCB9LCAnc2xvdycpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICAgICAgICQoJ2JvZHknKS5vbignbW91c2VlbnRlcicsICcubmF2LWxpc3QtaXRlbScsIGZ1bmN0aW9uKGUpe1xuICAgICAgICAgICAgICAgIGlmICgkKHRoaXMpLmZpbmQoJy5zdWJtZW51JykubGVuZ3RoKVxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyICR0aGlzID0gJCh0aGlzKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICRzdWJtZW51ID0gJHRoaXMuZmluZCgnLnN1Ym1lbnUnKTtcblxuICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgICAgICAkc3VibWVudS5hZGRDbGFzcygnaXMtc2hvdycpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHN1Ym1lbnUuYWRkQ2xhc3MoJ2lzLWFuaW1hdGUnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIDEwKTtcbiAgICAgICAgICAgICAgICAgICAgfSwgNTApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAkKCdib2R5Jykub24oJ21vdXNlbGVhdmUnLCAnLm5hdi1saXN0LWl0ZW0nLCBmdW5jdGlvbihlKXtcbiAgICAgICAgICAgICAgICBpZiAoJCh0aGlzKS5maW5kKCcuc3VibWVudScpLmxlbmd0aClcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIHZhciAkdGhpcyA9ICQodGhpcyksXG4gICAgICAgICAgICAgICAgICAgICAgICAkc3VibWVudSA9ICR0aGlzLmZpbmQoJy5zdWJtZW51Jyk7XG5cbiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICAgICAgJHN1Ym1lbnUucmVtb3ZlQ2xhc3MoJ2lzLWFuaW1hdGUnKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzdWJtZW51LnJlbW92ZUNsYXNzKCdpcy1zaG93Jyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9LCAyNTApO1xuICAgICAgICAgICAgICAgICAgICB9LCA1MCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGlmKCB0eXBlb2YgJC5pbml0UG9wdXBzICE9PSAndW5kZWZpbmVkJyApXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgJC5pbml0UG9wdXBzKCk7XG5cbiAgICAgICAgICAgICAgICBpZih3aW5kb3cubG9jYXRpb24uaGFzaC5sZW5ndGggPiAxICYmICQod2luZG93LmxvY2F0aW9uLmhhc2gpLmhhc0NsYXNzKCdwb3B1cCcpIClcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkLnBvcHVwLm9wZW4od2luZG93LmxvY2F0aW9uLmhhc2guc3Vic3RyKDEpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBjYXRjaChlKSB7fVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgbW9kdWxlOiB7XG4gICAgICAgICAgICBiZWFyOiB7XG4gICAgICAgICAgICAgICAgdGltZW91dDogMjAwMDAsXG4gICAgICAgICAgICAgICAgZWxlbWVudDogJyNiZWFyJyxcbiAgICAgICAgICAgICAgICBtb3ZlOiBmdW5jdGlvbihfZ29fKVxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIF9zZWxmXyA9IHRoaXMsIHRpbWVvdXQgPSBfc2VsZl8udGltZW91dDtcbiAgICAgICAgICAgICAgICAgICAgX2dvXyA9IHdpbmRvdy5pbm5lcldpZHRoIC0gX2dvXyAtIDI5ODtcbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgIGlmKF9nb18gPiB3aW5kb3cuaW5uZXJXaWR0aClcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgX2dvXyA9IHdpbmRvdy5pbm5lcldpZHRoO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgaWYodHlwZW9mKCQuY29va2llKCdfZ29fJykpICE9PSAndW5kZWZpbmVkJylcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgX2dvXyA9ICQuY29va2llKCdfZ29fJyk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAkLmNvb2tpZSgnX2dvXycsIF9nb18sIHsgZXhwaXJlczogNywgcGF0aDogJy8nIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmKHR5cGVvZigkLmNvb2tpZSgnY29vcmRpbmF0ZScpKSAhPT0gJ3VuZGVmaW5lZCcgJiYgJC5jb29raWUoJ2Nvb3JkaW5hdGUnKSAhPT0gJycpXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjb29yZCA9IE1hdGguZmxvb3IoJC5jb29raWUoJ2Nvb3JkaW5hdGUnKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgICQoX3NlbGZfLmVsZW1lbnQpLmNzcyh7ICdsZWZ0JzogY29vcmQgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwZXJjZW50ID0gMTAwIC0gTWF0aC5mbG9vcigoKHdpbmRvdy5pbm5lcldpZHRoIC0gY29vcmQpICogMTAwKSAvIHdpbmRvdy5pbm5lcldpZHRoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0aW1lb3V0ID0gdGltZW91dCAtICggdGltZW91dCAqIHBlcmNlbnQgLyAxMDApO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICQoX3NlbGZfLmVsZW1lbnQpLnN0b3AoKS5hbmltYXRlKHsgbGVmdDogX2dvXyB9LCB7IGR1cmF0aW9uOiB0aW1lb3V0LCBzdGVwOiBmdW5jdGlvbihub3csIGZ4KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgICQuY29va2llKCdjb29yZGluYXRlJywgbm93LCB7IGV4cGlyZXM6IDcsIHBhdGg6ICcvJyB9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYobm93ID09IF9nb18pXG4gICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJChfc2VsZl8uZWxlbWVudCkudG9nZ2xlQ2xhc3MoJ2Zvb3Rlci1iZWFyLXJldmVyc2UnKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICQucmVtb3ZlQ29va2llKCdjb29yZGluYXRlJywgeyBwYXRoOiAnLycgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJC5yZW1vdmVDb29raWUoJ19nb18nLCB7IHBhdGg6ICcvJyB9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICQuYXBwLm1vZHVsZS5iZWFyLm1vdmUoX2dvXyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH19KTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHJvdGF0ZTogZnVuY3Rpb24oIGRlZyApXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAkKHRoaXMuZWxlbWVudCkuZmluZCgnLmZvb3Rlci1iZWFyLWlubmVyJykuc3RvcCgpLmFuaW1hdGUoeyByb3RhdGlvbjogZGVnIH0sIHsgZHVyYXRpb246IDE4MDAsIHN0ZXA6IGZ1bmN0aW9uKG5vdywgZngpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICQodGhpcykuY3NzKHtcInRyYW5zZm9ybVwiOiBcInJvdGF0ZShcIitub3crXCJkZWcpXCJ9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKG5vdyA9PSBkZWcpXG4gICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJC5hcHAubW9kdWxlLmJlYXIucm90YXRlKChkZWcqLTEpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfX0pO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgaW5pdDogZnVuY3Rpb24oKVxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yb3RhdGUoNik7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubW92ZSgwKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmVzaXplOiBmdW5jdGlvbiggY2FsbGJhY2ssIHRpbWUgKVxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICQod2luZG93KS5yZXNpemUoZnVuY3Rpb24oZSl7XG4gICAgICAgICAgICAgICAgICAgIHdpbmRvdy5yZXNpemVFdnQ7XG4gICAgICAgICAgICAgICAgICAgICQod2luZG93KS5yZXNpemUoZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHdpbmRvdy5yZXNpemVFdnQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LnJlc2l6ZUV2dCA9IHNldFRpbWVvdXQoZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjay5hcHBseSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSwgdGltZSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdvb2dsZU1hcDogZnVuY3Rpb24oKVxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHZhciBtYXBPcHRpb25zID0ge1xuICAgICAgICAgICAgICAgICAgICB6b29tOiAxNixcbiAgICAgICAgICAgICAgICAgICAgem9vbUNvbnRyb2w6ICEwLFxuICAgICAgICAgICAgICAgICAgICB6b29tQ29udHJvbE9wdGlvbnM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0eWxlOiBnb29nbGUubWFwcy5ab29tQ29udHJvbFN0eWxlLkxBUkdFLFxuICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246IGdvb2dsZS5tYXBzLkNvbnRyb2xQb3NpdGlvbi5MRUZUX1RPUFxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBwYW5Db250cm9sOiAhMCxcbiAgICAgICAgICAgICAgICAgICAgcGFuQ29udHJvbE9wdGlvbnM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiBnb29nbGUubWFwcy5Db250cm9sUG9zaXRpb24uTEVGVF9UT1BcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgc2Nyb2xsd2hlZWw6ICExLFxuICAgICAgICAgICAgICAgICAgICBuYXZpZ2F0aW9uQ29udHJvbDogITEsXG4gICAgICAgICAgICAgICAgICAgIG1hcFR5cGVDb250cm9sOiAhMSxcbiAgICAgICAgICAgICAgICAgICAgc2NhbGVDb250cm9sOiAhMSxcbiAgICAgICAgICAgICAgICAgICAgZHJhZ2dhYmxlOiAhMCxcbiAgICAgICAgICAgICAgICAgICAgc3R5bGVzOiBbXG4gICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3R5bGVyczogW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7IGh1ZTogJyNhZGNlZDUnIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBdXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnRUeXBlOiAnbGFiZWxzJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHlsZXJzOiBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgdmlzaWJpbGl0eTogJ29uJyB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXVxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmZWF0dXJlVHlwZTogJ3dhdGVyJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHlsZXJzOiBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgY29sb3I6ICcjYzlkZmU0JyB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgICAgICBkaXNhYmxlRG91YmxlQ2xpY2tab29tOiAhMCxcbiAgICAgICAgICAgICAgICAgICAgY2VudGVyOiBuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nKDQzLjU2OTc4NywgMzkuNzU2MzYyKVxuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICB2YXIgbWFwID0gbmV3IGdvb2dsZS5tYXBzLk1hcChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCggJ21hcC1jb250ZWluZXInICksIG1hcE9wdGlvbnMpO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIHZhciBidWxsZXQgPSB7XG4gICAgICAgICAgICAgICAgICAgIHVybDogJ2ltYWdlcy9tYXAtYnVsbGV0LnBuZycsXG4gICAgICAgICAgICAgICAgICAgIHNpemU6IG5ldyBnb29nbGUubWFwcy5TaXplKDM5LCA1MiksXG4gICAgICAgICAgICAgICAgICAgIG9yaWdpbjogbmV3IGdvb2dsZS5tYXBzLlBvaW50KDAsMCksXG4gICAgICAgICAgICAgICAgICAgIGFuY2hvcjogbmV3IGdvb2dsZS5tYXBzLlBvaW50KDM5LCA1MilcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIG5ldyBnb29nbGUubWFwcy5NYXJrZXIoe1xuICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogbmV3IGdvb2dsZS5tYXBzLkxhdExuZyg0My41Njk3ODcsIDM5Ljc1NjM2MiksXG4gICAgICAgICAgICAgICAgICAgIG1hcDogbWFwLFxuICAgICAgICAgICAgICAgICAgICBpY29uOiBidWxsZXRcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjYWNoZTogZnVuY3Rpb24oIHMsIGNiIClcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgYSwgZyA9IFtdLCBpLCB4LCBjbnQgPSBzLmxlbmd0aCwgcCA9IHsgaToge30sIGFjOiAwLCBjOiAwIH0sIGNiID0gY2IgfHwgZnVuY3Rpb24oKXt9O1xuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24geSggaW5kZXgsIHNyYyApXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGcucHVzaCggc3JjICk7XG4gICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCBnLmxlbmd0aCA+PSBjbnQgKVxuICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNiLmNhbGwoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgcC5jKytcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGZvciAoeCBpbiBzKVxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhID0gc1t4XTtcbiAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgaSA9IG5ldyBJbWFnZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaS5zcmMgPSBhO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBpLm9ubG9hZCA9IHkoIHgsIGEgKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgcC5pW2FdID0gaTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHAuYWMrK1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNhdGNoKGUpIHt9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmV0aW5hOiBmdW5jdGlvbigpXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgaWYoICdkZXZpY2VQaXhlbFJhdGlvJyBpbiB3aW5kb3cgJiYgd2luZG93LmRldmljZVBpeGVsUmF0aW8gPT0gMiApXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICB2YXIgaT0wLCBzcmMsIGltZyA9ICQoICdpbWcucmVwbGFjZS0yeCcgKS5nZXQoKSwgbCA9IGltZy5sZW5ndGg7XG4gICAgICAgICAgICAgICAgICAgIGZvciAoaTsgaTxsOyBpKyspXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNyYyA9IGltZ1tpXS5zcmM7XG4gICAgICAgICAgICAgICAgICAgICAgICBzcmMgPSBzcmMucmVwbGFjZSgvXFwuKHBuZ3xqcGd8Z2lmKSskL2ksICdAMnguJDEnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGltZ1tpXS5zcmMgPSBzcmM7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaXNVbmRlZmluZWQ6IGZ1bmN0aW9uKCBvYmogKVxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHJldHVybiBvYmogPT09IHZvaWQgMDtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB1cGRhdGVJbWFnZTogZnVuY3Rpb24oZWxlbWVudClcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBpZiggJChlbGVtZW50KS5sZW5ndGggPiAwICkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgaW1hZ2UgPSAkKGVsZW1lbnQpLmF0dHIoJ3NyYycpLnNwbGl0KCAnPycgKVswXSA7XG4gICAgICAgICAgICAgICAgICAgICQoZWxlbWVudCkuYXR0cignc3JjJywgaW1hZ2UgKyAnP3Y9JyArIE1hdGgucmFuZG9tKCkgKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJhbmRvbTogZnVuY3Rpb24obWluLCBtYXgpXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgbWluID0gbWluIHx8IDAgO1xuICAgICAgICAgICAgICAgIG1heCA9IG1heCB8fCAxMDAgO1xuICAgICAgICAgICAgICAgIHJldHVybiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAoIG1heCAtIG1pbiArIDEgKSkgKyBtaW4gO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfTtcblxuICAgICQuYXBwLm1vdmllcyA9IHt9O1xuICAgICQuYXBwLm1vdmllcy5sb2FkID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIGFsZXJ0KCAnbG9hZCBtb3JlJyApO1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfTtcblxuICAgICQuYXBwLm1vZHVsZS5mb3JtX3ZhbGlkYXRpb25fZGVmYXVsdCA9IGZ1bmN0aW9uKCRmb3JtLCBlcnJvcnMpIHtcbiAgICAgICAgJGZvcm0uZmluZCgnLmZvcm1fZXJyb3JfYmxvY2snKS5oaWRlKCk7XG4gICAgICAgICRmb3JtLmZpbmQoJy5lcnJvcicpLnJlbW92ZUNsYXNzKCdlcnJvcicpO1xuICAgICAgICAkZm9ybS5maW5kKCcuY2hlY2tib3hfX2xhYmVsLWVycm9yJykucmVtb3ZlQ2xhc3MoJ2NoZWNrYm94X19sYWJlbC1lcnJvcicpO1xuICAgICAgICBpZihlcnJvcnMpIHtcbiAgICAgICAgICAgIHZhciAkZXJyb3JfYmxvY2sgPSAkKCcjZm9ybS1lcnJvcnMnKTtcbiAgICAgICAgICAgICRlcnJvcl9ibG9jay5odG1sKCcnKTtcblxuICAgICAgICAgICAgZm9yKGZpZWxkTmFtZSBpbiBlcnJvcnMpXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgJGZpZWxkID0gJGZvcm0uZmluZCgnaW5wdXRbbmFtZT1cIicrZmllbGROYW1lKydcIl0nKTtcbiAgICAgICAgICAgICAgICAkZXJyb3JfYmxvY2suYXBwZW5kKFxuICAgICAgICAgICAgICAgICAgICBbXG4gICAgICAgICAgICAgICAgICAgICAgICAnPHNwYW4+JyxcbiAgICAgICAgICAgICAgICAgICAgICAgICRmaWVsZC5kYXRhKCdlcnJvcicpLFxuICAgICAgICAgICAgICAgICAgICAgICAgJzwvc3Bhbj4nXG4gICAgICAgICAgICAgICAgICAgIF0uam9pbignJylcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfTtcblxuICAgICQuYXBwLmNhbGxiYWNrX3N0YWNrID0ge307XG4gICAgJC5hcHAuY2FsbGJhY2tfc3RhY2suZm9ybV9hamF4X2RlZmF1bHQgPSBmdW5jdGlvbigkZm9ybSwgcmVzcG9uc2UpIHtcbiAgICAgICAgaWYocmVzcG9uc2Uuc3RhdHVzKSB7XG4gICAgICAgICAgICBpZihyZXNwb25zZS5oYXNPd25Qcm9wZXJ0eSgncmVkaXJlY3RfdXJsJykpIHtcbiAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IHJlc3BvbnNlLnJlZGlyZWN0X3VybDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmKHJlc3BvbnNlLmVycm9ycykge1xuICAgICAgICAgICAgJC5hcHAubW9kdWxlLmZvcm1fdmFsaWRhdGlvbl9kZWZhdWx0KCRmb3JtLCByZXNwb25zZS5lcnJvcnMpO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBpZihyZXNwb25zZS5oYXNPd25Qcm9wZXJ0eSgnbWVzc2FnZScpKSB7XG4gICAgICAgICAgICAkLnBvcHVwLm1lc3NhZ2UocmVzcG9uc2UudGl0bGUsIHJlc3BvbnNlLm1lc3NhZ2UpO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgICQuYXBwLm1vZHVsZS5mb3JtX2FqYXggPSBmdW5jdGlvbigpIHtcbiAgICAgICAgJCgnYm9keScpLm9uKCdzdWJtaXQnICwnLmZvcm0tYWpheCcsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgIHZhciAkZm9ybSA9ICQodGhpcyk7XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgICQuYWpheCh7XG4gICAgICAgICAgICAgICAgdXJsOiAkZm9ybS5hdHRyKCdhY3Rpb24nKSxcbiAgICAgICAgICAgICAgICB0eXBlOiAoJGZvcm0uYXR0cignbWV0aG9kJykgfHwgJ3Bvc3QnKSxcbiAgICAgICAgICAgICAgICBkYXRhOiAkZm9ybS5zZXJpYWxpemUoKSxcbiAgICAgICAgICAgICAgICBkYXRhVHlwZTogJ2pzb24nLFxuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKHJlc3BvbnNlKVxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgaWYoJGZvcm0uZGF0YSgnY2FsbGJhY2snKSAmJiAkLmFwcC5jYWxsYmFja19zdGFjay5oYXNPd25Qcm9wZXJ0eSgkZm9ybS5kYXRhKCdjYWxsYmFjaycpKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgJC5hcHAuY2FsbGJhY2tfc3RhY2tbJGZvcm0uZGF0YSgnY2FsbGJhY2snKV0oJGZvcm0sIHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICQuYXBwLmNhbGxiYWNrX3N0YWNrLmZvcm1fYWpheF9kZWZhdWx0KCRmb3JtLCByZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBpZiggcmVzcG9uc2Uuc3RhdHVzID09PSB0cnVlICYmIHJlc3BvbnNlLm1lc3NhZ2UgIT09ICcnIClcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgJC5wb3B1cC5tZXNzYWdlKCByZXNwb25zZS50aXRsZSwgcmVzcG9uc2UubWVzc2FnZSApO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24ocmVzcG9uc2UpXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAkLmFwcC5jYWxsYmFja19zdGFjay5mb3JtX2FqYXhfZGVmYXVsdCgkZm9ybSwgcmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICBhbGVydChcImVycm9yXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgJC5hcHAubW9kdWxlLnVwbG9hZF9idXR0b24gPSBmdW5jdGlvbigpe1xuICAgICAgICAkKCdib2R5Jykub24oJ3N1Ym1pdCcgLCcuZm9ybS1maWxlLXVwbG9hZCcsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgIHJldHVybiBBSU0uc3VibWl0KHRoaXMsIHtcbiAgICAgICAgICAgICAgICBvblN0YXJ0OiBmdW5jdGlvbigpXG4gICAgICAgICAgICAgICAge1xuXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBvbkNvbXBsZXRlOiBmdW5jdGlvbiggcmVzdWx0IClcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIGlmKCB0eXBlb2YgcmVzdWx0ID09PSAnb2JqZWN0JyAmJiByZXN1bHQuc3RhdHVzID09PSB0cnVlICYmIHR5cGVvZiByZXN1bHQucGhvdG9fdXJsICE9PSAndW5kZWZpbmVkJyApXG4gICAgICAgICAgICAgICAgICAgIHsgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgICQoZG9jdW1lbnQpLm9uKCdjaGFuZ2UnLCAnLnVwbG9hZF9idXR0b25fb25jaGFuZ2UnLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgaWYoICQodGhpcykuY2xvc2VzdCgnLnVwbG9hZF9idXR0b24nKS5maW5kKCcudXBsb2FkX2J1dHRvbl9maWVsZCcpLmxlbmd0aCA+IDAgKVxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICQodGhpcykuY2xvc2VzdCgnLnVwbG9hZF9idXR0b24nKS5maW5kKCcudXBsb2FkX2J1dHRvbl9maWVsZCcpLmh0bWwoICQodGhpcykudmFsKCkgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgICQuYXBwLmN1c3RvbV9wbGFjZWhvbGRlciA9IGZ1bmN0aW9uKCkge1xuICAgICAgICBpZiAoTW9kZXJuaXpyLnRvdWNoKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICAkKCdpbnB1dCwgdGV4dGFyZWEnKS5lYWNoKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyICRpbnB1dCA9ICQodGhpcyksICRpbnB1dFdyYXBwZXIsICRwbGFjZWhvbGRlciwgcGxhY2Vob2xkZXJUZXh0ID0gJGlucHV0LmF0dHIoJ3BsYWNlaG9sZGVyJyk7XG4gICAgICAgICAgICBpZihwbGFjZWhvbGRlclRleHQpIHtcbiAgICAgICAgICAgICAgICAkaW5wdXRXcmFwcGVyID0gJGlucHV0LnBhcmVudCgpO1xuICAgICAgICAgICAgICAgICRwbGFjZWhvbGRlciA9ICQoJzxkaXYgY2xhc3M9XCJkZWZhdWx0LWlucHV0X19wbGFjZWhvbGRlclwiIHN0eWxlPVwibGluZS1oZWlnaHQ6ICcrKCRpbnB1dC5pcygndGV4dGFyZWEnKSA/ICczNnB4JyA6ICggJGlucHV0V3JhcHBlci5pbm5lckhlaWdodCgpID09IDAgPyAnMzYnIDogJGlucHV0V3JhcHBlci5pbm5lckhlaWdodCgpICkrJ3B4JykrJ1wiPicrcGxhY2Vob2xkZXJUZXh0Kyc8L2Rpdj4nKTtcbiAgICAgICAgICAgICAgICAkcGxhY2Vob2xkZXJbJGlucHV0LnZhbCgpLmxlbmd0aCA/ICdoaWRlJyA6ICdzaG93J10oKTtcbiAgICAgICAgICAgICAgICAkaW5wdXQuYWRkQ2xhc3MoJ2N1c3RvbS1wbGFjZWhvbGRlcicpLmF0dHIoJ3BsYWNlaG9sZGVyJywgJycpO1xuICAgICAgICAgICAgICAgICRpbnB1dFdyYXBwZXIuYXBwZW5kKCRwbGFjZWhvbGRlcik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICAgJCgnYm9keScpLm9uKCdibHVyJywgJy5jdXN0b20tcGxhY2Vob2xkZXInLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhciAkdGhpcyA9ICQodGhpcyk7XG4gICAgICAgICAgICBpZighJHRoaXMudmFsKCkubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgJHRoaXMucGFyZW50KCkuZmluZCgnLmRlZmF1bHQtaW5wdXRfX3BsYWNlaG9sZGVyJykuc2hvdygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgJCgnYm9keScpLm9uKCdmb2N1cycsICcuY3VzdG9tLXBsYWNlaG9sZGVyJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkKHRoaXMpLnBhcmVudCgpLmZpbmQoJy5kZWZhdWx0LWlucHV0X19wbGFjZWhvbGRlcicpLmhpZGUoKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgJCgnYm9keScpLm9uKCdjbGljaycsICcuZGVmYXVsdC1pbnB1dF9fcGxhY2Vob2xkZXInLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhciAkdGhpcyA9ICQodGhpcyk7XG4gICAgXG4gICAgICAgICAgICAkdGhpcy5oaWRlKCk7XG4gICAgICAgICAgICAkdGhpcy5wYXJlbnQoKS5maW5kKCcuY3VzdG9tLXBsYWNlaG9sZGVyJykudHJpZ2dlcignZm9jdXMnKTtcbiAgICAgICAgfSk7XG4gICAgICAgICQoJ2JvZHknKS5vbignc2VsZWN0c3RhcnQnLCAnLmRlZmF1bHQtaW5wdXRfX3BsYWNlaG9sZGVyJywgZmFsc2UpO1xuICAgIH07XG5cbiAgICAkLmFwcC5ydW4oKTtcbn0pKGpRdWVyeSk7IiwiOyhmdW5jdGlvbigkKSB7XG4gICAgJC5jYXJ0ID0ge1xuICAgICAgICBpbml0UmVxdWVzdENsaWNrOiBmdW5jdGlvbigpXG4gICAgICAgIHtcbiAgICAgICAgICAgICQoJ2JvZHknKS5vbignY2xpY2snLCAnLmotcmVtb3Zlci1yZXF1ZXN0JywgZnVuY3Rpb24oZSl7XG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgICAgICAgICAgdmFyICRyZW1vdmVyID0gJCh0aGlzKS5jbG9zZXN0KCcucmVtb3ZlcicpLCBwcm9kdWN0ID0gJCh0aGlzKS5kYXRhKCdlbGVtZW50JyksIHN0YXR1cyA9ICQodGhpcykuZGF0YSgnc3RhdHVzJyk7XG5cbiAgICAgICAgICAgICAgICBpZiAoc3RhdHVzICE9PSAwKVxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCQoJyNjYXJ0LXByb2R1Y3QtJytwcm9kdWN0KS5sZW5ndGgpXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICQoJyNjYXJ0LXByb2R1Y3QtJytwcm9kdWN0KS5mYWRlT3V0KGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2cocHJvZHVjdCArICcgYXMgJyArIHN0YXR1cyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgJHJlbW92ZXIuZmFkZU91dChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSwgMTUwKTtcblxuICAgICAgICAgICAgICAgIHJldHVybiAhMTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgXHRpbml0OiBmdW5jdGlvbigpXG4gICAgXHR7XG4gICAgXHRcdCQuY2FydC5pbml0QnV5KCk7XG4gICAgXHRcdCQuY2FydC5pbml0UmVtb3ZlKCk7XG4gICAgXHRcdCQuY2FydC5pbml0Q29udHJvbGwoKTtcblxuICAgICAgICAgICAgJC5jYXJ0LmluaXRSZXF1ZXN0Q2xpY2soKTtcblxuICAgICAgICAgICAgJCgnYm9keScpLm9uKCdjbGljaycsICcuai1jYXJ0LXJlbW92ZScsIGZ1bmN0aW9uKGUpe1xuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcblxuICAgICAgICAgICAgICAgIGlmICghJCh0aGlzKS5jbG9zZXN0KCcubGlzdC1pdGVtLWZvb3RlcicpLmZpbmQoJy5yZW1vdmVyJykubGVuZ3RoKVxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyICRyZW1vdmVyLCBwcm9kdWN0ID0gJCh0aGlzKS5kYXRhKCdlbGVtZW50Jyk7XG5cbiAgICAgICAgICAgICAgICAgICAgJHJlbW92ZXIgPSBbXG4gICAgICAgICAgICAgICAgICAgICAgICAnPGRpdiBjbGFzcz1cInJlbW92ZXJcIj4nLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8ZGl2IGNsYXNzPVwicmVtb3Zlcl9fY29udGVudFwiPicsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8ZGl2IGNsYXNzPVwicmVtb3Zlcl9fdGl0bGVcIj4nLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ9CU0LXQudGB0YLQstC40YLQtdC70YzQvdC+INGD0LTQsNC70LjRgtGMPycsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8L2Rpdj4nLFxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8ZGl2IGNsYXNzPVwicmVtb3Zlcl9fYnV0dG9uc1wiPicsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPGEgaHJlZj1cIiNcIiBkYXRhLWVsZW1lbnQ9XCInICsgcHJvZHVjdCArICdcIiBkYXRhLXN0YXR1cz1cIjFcIiBjbGFzcz1cInJlbW92ZXJfX2J1dHRvbiBpcy15ZXMgai1yZW1vdmVyLXJlcXVlc3RcIj7QlNCwPC9hPicsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPGEgaHJlZj1cIiNcIiBkYXRhLWVsZW1lbnQ9XCInICsgcHJvZHVjdCArICdcIiBkYXRhLXN0YXR1cz1cIjBcIiBjbGFzcz1cInJlbW92ZXJfX2J1dHRvbiBpcy1ubyBqLXJlbW92ZXItcmVxdWVzdFwiPtCd0LXRgjwvYT4nLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPC9kaXY+JyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPC9kaXY+JyxcbiAgICAgICAgICAgICAgICAgICAgICAgICc8L2Rpdj4nXG4gICAgICAgICAgICAgICAgICAgIF0uam9pbignICcpO1xuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5jbG9zZXN0KCcubGlzdC1pdGVtLWZvb3RlcicpLmFwcGVuZCgkcmVtb3Zlcik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIHZhciAkcmVtb3ZlciA9ICQodGhpcykuY2xvc2VzdCgnLmxpc3QtaXRlbS1mb290ZXInKS5maW5kKCcucmVtb3ZlcicpO1xuXG4gICAgICAgICAgICAgICAgICAgICRyZW1vdmVyLmZhZGVPdXQoZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICQodGhpcykucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHJldHVybiAhMTtcbiAgICAgICAgICAgIH0pO1xuICAgIFx0fSxcblxuICAgIFx0aW5pdEJ1eTogZnVuY3Rpb24oKVxuICAgIFx0e1xuICAgIFx0XHQkKCcuYWRkLWNhcnQtdHJpZ2dlcicpLm9uKCdjbGljaycsIGZ1bmN0aW9uKGUpe1xuICAgIFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcbiAgICBcdFx0XHQkLmNhcnQuYnV5SXRlbSggJCh0aGlzKS5hdHRyKCdocmVmJykuc3BsaXQoJy0nKVsxXSApO1xuICAgIFx0XHR9KTtcbiAgICBcdH0sXG4gICAgXHRpbml0Q29udHJvbGw6IGZ1bmN0aW9uKClcbiAgICBcdHtcbiAgICBcdFx0JCgnLmluY3JlYXNlLWNhcnQtdHJpZ2dlcicpLm9uKCdjbGljaycsIGZ1bmN0aW9uKGUpe1xuICAgIFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcbiAgICBcdFx0XHQkLmNhcnQuaW5jcmVhc2UoICQodGhpcykuYXR0cignaHJlZicpLnNwbGl0KCctJylbMV0gKTtcbiAgICBcdFx0fSk7XG5cblx0XHRcdCQoJy5kZWNyZWFzZS1jYXJ0LXRyaWdnZXInKS5vbignY2xpY2snLCBmdW5jdGlvbihlKXtcbiAgICBcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgXHRcdFx0JC5jYXJ0LmRlY3JlYXNlKCAkKHRoaXMpLmF0dHIoJ2hyZWYnKS5zcGxpdCgnLScpWzFdICk7XG4gICAgXHRcdH0pO1xuICAgIFx0fSxcbiAgICBcdGluaXRSZW1vdmU6IGZ1bmN0aW9uKClcbiAgICBcdHtcbiAgICBcdFx0JCgnLnJlbW92ZS1jYXJ0LXRyaWdnZXInKS5vbignY2xpY2snLCBmdW5jdGlvbihlKXtcbiAgICBcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgXHRcdFx0JC5jYXJ0LnJlbW92ZUl0ZW0oJCh0aGlzKS5hdHRyKCdocmVmJykuc3BsaXQoJy0nKVsxXSwgdGhpcyk7XG4gICAgXHRcdH0pO1xuICAgIFx0fSxcbiAgICBcdHJlbW92ZUl0ZW06IGZ1bmN0aW9uKGlkLCBfc2VsZl8pXG5cdFx0e1xuXHRcdFx0JC5wb3N0KCcvYWpheC9jYXJ0L3JlbW92ZS8nLCB7IGl0ZW06IGlkIH0sIGZ1bmN0aW9uKGRhdGEpIHtcblx0XHRcdFx0aWYoICQoJyNsaXN0LWl0ZW0tJytpZCkuZmluZCgnLmluY2FydCcpLmxlbmd0aCA+IDAgKVxuXHRcdFx0XHR7XG5cdFx0XHRcdFx0JCgnI2xpc3QtaXRlbS0nK2lkKS5maW5kKCcuaW5jYXJ0JykucmVtb3ZlKCk7XG5cdFx0XHRcdH1cblx0XHRcdFx0XG5cdFx0XHRcdGlmKCQoX3NlbGZfKS5oYXNDbGFzcygnbGlzdC1pdGVtLWluY2FydCcpKVxuXHRcdFx0XHR7XG5cdFx0XHRcdFx0JChfc2VsZl8pLnJlbW92ZSgpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdGVsc2Vcblx0XHRcdFx0e1xuXHRcdFx0XHRcdCQoJyNpbmNhcnQtaXRlbS0nK2lkKS5odG1sKCAnPGEgaHJlZj1cIiNpdGVtLScraWQrJ1wiIHRpdGxlPVwi0JTQvtCx0LDQstC40YLRjCDQsiDQutC+0YDQt9C40L3Rg1wiIGNsYXNzPVwiYnV0dG9uLWNhcnQgYWRkLWNhcnQtdHJpZ2dlclwiPtCa0YPQv9C40YLRjCDQutGA0LXRgdC70L48L2E+JyApO1xuXHRcdFx0XHRcdCQuY2FydC5pbml0QnV5KCk7XG5cdFx0XHRcdH1cblxuXHRcdCAgICAgICAgJC5jYXJ0LmFkZGVkSXRlbSgn0KLQvtCy0LDRgCDRg9C00LDQu9C10L0g0LjQtyDQutC+0YDQt9C40L3Riy4nKTtcblx0XHRcdH0pO1xuXHRcdH0sXG5cdFx0YnV5SXRlbTogZnVuY3Rpb24oaWQpXG5cdFx0e1xuXHRcdFx0dmFyIGNvdW50ID0gMTtcblx0XHRcdFxuXHRcdFx0aWYoICQoJyNjb3VudC0nK2lkKS5sZW5ndGggPiAwICkge1xuXHRcdFx0XHRjb3VudCA9IHBhcnNlSW50KCAkKCcjY291bnQtJytpZCkudmFsKCkgKSA7XG5cdFx0XHR9XG5cblx0XHRcdCQucG9zdCgnLi4vY2FydC5qc29uJywgeyBpdGVtOiBpZCwgY291bnQ6IGNvdW50IH0sIGZ1bmN0aW9uKGRhdGEpIHtcblx0XHRcdFx0aWYoICQoJyNjYXJ0LWNvdW50JykubGVuZ3RoID4gMCApXG5cdFx0XHRcdHtcblx0XHRcdFx0XHQkKCcjY2FydC1jb3VudCcpLmh0bWwoIGRhdGEuY291bnQgKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRcblx0XHRcdFx0aWYoICQoJyNjYXJ0LXByaWNlJykubGVuZ3RoID4gMCApXG5cdFx0XHRcdHtcblx0XHRcdFx0XHQkKCcjY2FydC1wcmljZScpLmh0bWwoIGRhdGEubW9uZXkgKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRcblx0XHRcdFx0aWYoICQoJyNjb3VudC0nK2lkKS5sZW5ndGggPiAwIClcblx0XHRcdFx0e1xuXHRcdFx0XHRcdCQoJyNjb3VudC0nK2lkKS52YWwoMSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiggJCgnI2xpc3QtaXRlbS0nK2lkKS5maW5kKCcuaW5jYXJ0JykubGVuZ3RoID09IDAgKSB7XG5cdFx0XHRcdFx0JCgnI2luY2FydC1pdGVtLScraWQpLmh0bWwoICc8YSBocmVmPVwiI2l0ZW0tJyArIGlkICsgJ1wiIHRpdGxlPVwi0KPQtNCw0LvQuNGC0Ywg0LjQtyDQutC+0YDQt9C40L3Ri1wiIGNsYXNzPVwiYnV0dG9uLXJlbW92ZSByZW1vdmUtY2FydC10cmlnZ2VyXCI+0JrRgNC10YHQu9C+INCyINC60L7RgNC30LjQvdC1PC9hPicgKTtcblxuXHRcdFx0XHRcdCQuY2FydC5pbml0UmVtb3ZlKCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHQkLmNhcnQuYWRkZWRJdGVtKCk7XG5cdFx0XHR9LCAnSlNPTicpO1xuXHRcdH0sXG5cdFx0YWRkZWRJdGVtOiBmdW5jdGlvbih0ZXh0LCBsYXJnZSlcblx0XHR7XG5cdFx0ICAgIHRleHQgPSAhdGV4dCA/ICfQotC+0LLQsNGAINC00L7QsdCw0LLQu9C10L0g0LIg0LrQvtGA0LfQuNC90YMuJyA6IHRleHQgO1xuXHRcdCAgICBsYXJnZSA9ICFsYXJnZSA/IGZhbHNlIDogbGFyZ2UgO1xuXHRcdCAgICB2YXIgdGltZW91dCA9ICFsYXJnZSA/IDE1MDAgOiA1MDAwLCBhZGRjbGFzcyA9ICFsYXJnZSA/ICcnIDogJyBhZGRpbmctbGFyZ2UnIDtcblx0XHQgICAgXG5cdFx0ICAgIGlmKCAkKCdib2R5JykuZmluZCgnI2l0ZW0tYWRkZWQtdG8tY2FydCcpLmxlbmd0aCA9PSAwICkge1xuXHRcdCAgICAgICAgJCgnYm9keScpLmFwcGVuZCgnPGRpdiBpZD1cIml0ZW0tYWRkZWQtdG8tY2FydFwiIGNsYXNzPVwic2hvd2FkZGluZycgKyBhZGRjbGFzcyArICdcIj48ZGl2IGNsYXNzPVwiYWRkaW5nLWlubmVyXCI+PGRpdiBjbGFzcz1cImFkZGluZy1jb250ZW50XCI+JyArIHRleHQgKyAnPC9kaXY+PC9kaXY+PC9kaXY+Jyk7XG5cdFx0ICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7XG5cdFx0ICAgICAgICAgICAgJCgnYm9keScpLmZpbmQoJyNpdGVtLWFkZGVkLXRvLWNhcnQnKS5yZW1vdmUoKSA7XG5cdFx0ICAgICAgICB9LHRpbWVvdXQpO1xuXHRcdCAgICB9XG5cdFx0ICAgIGVsc2Uge1xuXHRcdCAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpe1xuXHRcdCAgICAgICAgICAgICQoJ2JvZHknKS5maW5kKCcjaXRlbS1hZGRlZC10by1jYXJ0JykucmVtb3ZlKCkgO1xuXHRcdCAgICAgICAgfSx0aW1lb3V0KTtcblx0XHQgICAgfVxuXHRcdH0sXG5cdFx0aW5jcmVhc2U6IGZ1bmN0aW9uKGlkKVxuXHRcdHtcblx0XHRcdGlmKCAkKCcjY291bnQtJytpZCkubGVuZ3RoID4gMCApIHtcblx0XHQgICAgICAgIHZhciB2YWx1ZSA9IHBhcnNlSW50KCAkKCcjY291bnQtJytpZCkudmFsKCkgKSA7XG5cdFx0ICAgICAgICAgICAgdmFsdWUgPSAhdmFsdWUgPyAwIDogdmFsdWUgO1xuXHRcdCAgICAgICAgICAgIFxuXHRcdCAgICAgICAgICAgIHZhbHVlKysgO1xuXHRcdCAgICAgICAgICAgIFxuXHRcdCAgICAgICAgICAgICQoJyNjb3VudC0nK2lkKS52YWwoIHZhbHVlICkgO1xuXHRcdCAgICB9XG5cdFx0XHRcblx0XHRcdGlmKCQoJyNjYXJ0LXRhYmxlJykubGVuZ3RoID4gMClcblx0XHRcdHtcblx0XHRcdFx0JC5jYXJ0LnJlVG90YWwoaWQpO1xuXHRcdFx0fVxuXHRcdH0sXG5cdFx0ZGVjcmVhc2U6IGZ1bmN0aW9uKGlkKVxuXHRcdHtcblx0XHRcdGlmKCAkKCcjY291bnQtJytpZCkubGVuZ3RoID4gMCApXG5cdFx0XHR7XG5cdFx0XHRcdHZhciB2YWx1ZSA9IHBhcnNlSW50KCAkKCcjY291bnQtJytpZCkudmFsKCkgKSA7XG5cdFx0XHRcdFx0dmFsdWUgPSAhdmFsdWUgPyAxIDogdmFsdWUgO1xuXHRcdFx0XHRcdFxuXHRcdFx0XHRcdGlmKCB2YWx1ZSA+PSAyICkgdmFsdWUtLSA7XG5cdFx0XHRcdFx0ZWxzZSB2YWx1ZSA9IDEgO1xuXHRcdFx0XHRcdFxuXHRcdFx0XHRcdCQoJyNjb3VudC0nK2lkKS52YWwoIHZhbHVlICkgO1xuXHRcdFx0fVxuXHRcdFx0XG5cdFx0XHRpZigkKCcjY2FydC10YWJsZScpLmxlbmd0aCA+IDApXG5cdFx0XHR7XG5cdFx0XHRcdCQuY2FydC5yZVRvdGFsKGlkKTtcblx0XHRcdH1cblx0XHR9LFxuXHRcdHJlVG90YWw6IGZ1bmN0aW9uKGlkKVxuXHRcdHtcblx0XHRcdGlmKCAkKCcjY291bnQtJytpZCkubGVuZ3RoID4gMCApXG5cdFx0XHR7XG5cdFx0XHRcdHZhciBjb3VudCA9IHBhcnNlSW50KCAkKCcjY291bnQtJytpZCkudmFsKCkgKTtcblx0XHRcdFx0XG5cdFx0XHRcdCQucG9zdCgnL2FqYXgvY2FydC9yZWNvdW50LycsIHsgaXRlbTogaWQsIGNvdW50OiBjb3VudCB9LCBmdW5jdGlvbihkYXRhKSB7XG5cdFx0XHRcdFx0dmFyIHByaWNlID0gcGFyc2VJbnQoICQoJyNjYXJ0LWl0ZW0tcHJpY2UtJytpZCkuaHRtbCgpICk7XG5cdFx0XHRcdFx0dmFyIHRvdGFsID0gY291bnQgKiBwcmljZTtcblxuXHRcdFx0XHRcdCQoJyNjYXJ0LWl0ZW0tdG90YWwtJytpZCkuaHRtbCh0b3RhbCkgO1xuXHRcdFx0XHRcdCQoJyNjYXJ0LXRvdGFsLWNvdW50JykuaHRtbChkYXRhLmNvdW50KTtcblx0XHRcdFx0XHQkKCcjY2FydC10b3RhbC1wcmljZScpLmh0bWwoZGF0YS5tb25leSk7XG5cblx0XHRcdFx0XHRpZiggJCgnI2NhcnQtY291bnQnKS5sZW5ndGggPiAwIClcblx0XHRcdFx0XHR7XG5cdFx0XHRcdFx0XHQkKCcjY2FydC1jb3VudCcpLmh0bWwoIGRhdGEuY291bnQgKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XG5cdFx0XHRcdFx0aWYoICQoJyNjYXJ0LXByaWNlJykubGVuZ3RoID4gMCApXG5cdFx0XHRcdFx0e1xuXHRcdFx0XHRcdFx0JCgnI2NhcnQtcHJpY2UnKS5odG1sKCBkYXRhLm1vbmV5ICk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9LCAnSlNPTicpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdCQuY2FydC5pbml0KCk7XG59KShqUXVlcnkpOyJdfQ==
