var body = document.body, timer;

window.addEventListener('scroll', function() {
    clearTimeout(timer);
    if(!body.classList.contains('disable-hover'))
    {
        body.classList.add('disable-hover')
    }

    timer = setTimeout(function(){
        body.classList.remove('disable-hover')
    }, 500);
}, false);

// Find, Replace, Case
// i.e "Test to see if this works? (Yes|No)".replaceAll('(Yes|No)', 'Yes!');
// i.e.2 "Test to see if this works? (Yes|No)".replaceAll('(yes|no)', 'Yes!', true);
String.prototype.replaceAll = function(_f, _r, _c){ 
    var o = this.toString();
    var r = '';
    var s = o;
    var b = 0;
    var e = -1;
    if(_c){ _f = _f.toLowerCase(); s = o.toLowerCase(); }

    while((e=s.indexOf(_f)) > -1)
    {
        r += o.substring(b, b+e) + _r;
        s = s.substring(e+_f.length, s.length);
        b += e+_f.length;
    }

    // Add Leftover
    if(s.length>0){ r+=o.substring(o.length-s.length, o.length); }

    // Return New String
    return r;
};

if (!Array.prototype.indexOf) {
    Array.prototype.indexOf = function (searchElement, fromIndex) {
      if ( this === undefined || this === null ) {
        throw new TypeError( '"this" is null or not defined' );
      }

      var length = this.length >>> 0; // Hack to convert object.length to a UInt32

      fromIndex = +fromIndex || 0;

      if (Math.abs(fromIndex) === Infinity) {
        fromIndex = 0;
      }

      if (fromIndex < 0) {
        fromIndex += length;
        if (fromIndex < 0) {
          fromIndex = 0;
        }
      }

      for (;fromIndex < length; fromIndex++) {
        if (this[fromIndex] === searchElement) {
          return fromIndex;
        }
      }

      return -1;
    };
}

// Simple JavaScript Templating
// John Resig - http://ejohn.org/ - MIT Licensed
;(function(){
    var cache = {};

    this.tmpl = function tmpl(str, data){
        // Figure out if we're getting a template, or if we need to
        // load the template - and be sure to cache the result.
        var fn = !/\W/.test(str) ?
            cache[str] = cache[str] ||
                tmpl(document.getElementById(str).innerHTML) :

            // Generate a reusable function that will serve as a template
            // generator (and which will be cached).
            new Function("obj",
                "var p=[],print=function(){p.push.apply(p,arguments);};" +

                    // Introduce the data as local variables using with(){}
                    "with(obj){p.push('" +

                    // Convert the template into pure JavaScript
                    str
                        .replace(/[\r\t\n]/g, " ")
                        .split("<%").join("\t")
                        .replace(/((^|%>)[^\t]*)'/g, "$1\r")
                        .replace(/\t=(.*?)%>/g, "',$1,'")
                        .split("\t").join("');")
                        .split("%>").join("p.push('")
                        .split("\r").join("\\'")
                    + "');}return p.join('');");

        // Provide some basic currying to the user
        return data ? fn( data ) : fn;
    };
})();

(function($) {
    $.app = {
        sandwich: {
            config: {
                keyHooks: !1,
                selector: '.js-sandwich-menu',
                wrapper: '.wrapper',
                overlay: '.menu-overlay'
            },

            extend: function(config)
            {
                _this = this;

                if (typeof config !== 'undefined')
                {
                    var x;
                    for (x in config)
                    {
                        if (typeof _this.config[x] !== 'undefined')
                            _this.config[x] = config[x];
                    }
                }
            },

            isOpen: function()
            {
                return $('body').hasClass('page-visible');
            },

            hide: function()
            {
                $('body').removeClass('page-open');

                setTimeout(function(){
                    $('body').removeClass('page-visible');
                }, 10);

                $(this.config.overlay).css({
                    'visibility': 'hidden'
                });
            },

            toggle: function()
            {
                if ($('body').hasClass('page-visible'))
                {
                    $('body').removeClass('page-open');

                    setTimeout(function(){
                        $('body').removeClass('page-visible');
                    }, 200);
                }
                else
                {
                    $('body').addClass('page-open');

                    setTimeout(function(){
                        $('body').addClass('page-visible');
                    }, 10);
                }

                var visibility = 'visible';

                if (!$('body').hasClass('page-open'))
                {
                    visibility = 'hidden'
                }
                
                $(_this.config.overlay).css({
                    'visibility': visibility
                });
            },

            sandwichTrigger: function()
            {
                _this = this;

                if (_this.config.keyHooks)
                {
                    $('body').on('keydown', function(e) {
                        if(e.keyCode == 27 && _this.isOpen())
                        {
                            _this.toggle();
                        }
                    });
                };

                $('body').on('click', _this.config.selector, function(e){
                    e.preventDefault ? e.preventDefault() : e.returnValue = false;
                    _this.toggle();
                });
            },

            overlayTrigger: function()
            {
                _this = this;

                $('body').on('click', _this.config.overlay, function(e){
                    _this.hide();
                });
            },

            init: function(config)
            {
                this.extend(config);
                this.sandwichTrigger();
                this.overlayTrigger();
            }
        },

        run: function()
        {
            $.app.sandwich.init();
            $.app.module.bear.init();
            $.app.module.form_ajax();
            $.app.module.resize(function(){ }, 500);

            $(".integer").on('keypress', function (e) { if( [0, 8].indexOf( e.which ) < 0 && ( e.which < 48 || e.which > 57 ) ) { return false; } });
            
            $('body').on('click', '.toggle-trigger', function(e){
                e.preventDefault();

                var id = $(this).attr('href');
                if( $(id).length > 0 )
                {
                    if( $(this).hasClass('ul_list-item_link-drop') )
                    {
                        $(this).toggleClass('ul_list-item_link-drop-up');
                    }

                    $(id).slideToggle(150);
                    $('html, body').animate({ scrollTop: $(this).offset().top }, 'slow');
                }
            });
        
            $('body').on('mouseenter', '.nav-list-item', function(e){
                if ($(this).find('.submenu').length)
                {
                    var $this = $(this),
                        $submenu = $this.find('.submenu');

                    setTimeout(function(){
                        $submenu.addClass('is-show');

                        setTimeout(function(){
                            $submenu.addClass('is-animate');
                        }, 10);
                    }, 50);
                }
            });
            
            $('body').on('mouseleave', '.nav-list-item', function(e){
                if ($(this).find('.submenu').length)
                {
                    var $this = $(this),
                        $submenu = $this.find('.submenu');

                    setTimeout(function(){
                        $submenu.removeClass('is-animate');

                        setTimeout(function(){
                            $submenu.removeClass('is-show');
                        }, 250);
                    }, 50);
                }
            });
            
            if( typeof $.initPopups !== 'undefined' )
            {
                $.initPopups();

                if(window.location.hash.length > 1 && $(window.location.hash).hasClass('popup') )
                {
                    try {
                        $.popup.open(window.location.hash.substr(1));
                    }
                    catch(e) {}
                }
            }
        },
        module: {
            bear: {
                timeout: 20000,
                element: '#bear',
                move: function(_go_)
                {
                    var _self_ = this, timeout = _self_.timeout;
                    _go_ = window.innerWidth - _go_ - 298;
                    
                    if(_go_ > window.innerWidth)
                    {
                        _go_ = window.innerWidth;
                    }

                    if(typeof($.cookie('_go_')) !== 'undefined')
                    {
                        _go_ = $.cookie('_go_');
                    }

                    $.cookie('_go_', _go_, { expires: 7, path: '/' });

                    if(typeof($.cookie('coordinate')) !== 'undefined' && $.cookie('coordinate') !== '')
                    {
                        var coord = Math.floor($.cookie('coordinate'));
                        
                        $(_self_.element).css({ 'left': coord });

                        var percent = 100 - Math.floor(((window.innerWidth - coord) * 100) / window.innerWidth);
                        var timeout = timeout - ( timeout * percent / 100);
                    }
                   
                    $(_self_.element).stop().animate({ left: _go_ }, { duration: timeout, step: function(now, fx) {
                        
                        $.cookie('coordinate', now, { expires: 7, path: '/' });

                        if(now == _go_)
                        {
                            $(_self_.element).toggleClass('footer-bear-reverse');

                            $.removeCookie('coordinate', { path: '/' });
                            $.removeCookie('_go_', { path: '/' });

                            $.app.module.bear.move(_go_);
                        }
                    }});
                },
                rotate: function( deg )
                {
                    $(this.element).find('.footer-bear-inner').stop().animate({ rotation: deg }, { duration: 1800, step: function(now, fx) {
                        $(this).css({"transform": "rotate("+now+"deg)"});
                        if(now == deg)
                        {
                            $.app.module.bear.rotate((deg*-1));
                        }
                    }});
                },
                init: function()
                {
                    if ($(window).width() > 960)
                    {
                        this.rotate(6);
                        this.move(0);
                    }
                }
            },
            resize: function( callback, time )
            {
                $(window).resize(function(e){
                    window.resizeEvt;
                    $(window).resize(function(){
                    clearTimeout(window.resizeEvt);
                        window.resizeEvt = setTimeout(function(){
                            callback.apply();
                        }, time);
                    });
                });
            },
            googleMap: function()
            {
                var mapOptions = {
                    zoom: 16,
                    zoomControl: !0,
                    zoomControlOptions: {
                        style: google.maps.ZoomControlStyle.LARGE,
                        position: google.maps.ControlPosition.LEFT_TOP
                    },
                    panControl: !0,
                    panControlOptions: {
                        position: google.maps.ControlPosition.LEFT_TOP
                    },
                    scrollwheel: !1,
                    navigationControl: !1,
                    mapTypeControl: !1,
                    scaleControl: !1,
                    draggable: !0,
                    styles: [
                        {
                            stylers: [
                                { hue: '#adced5' }
                            ]
                        },
                        {
                            elementType: 'labels',
                            stylers: [
                                { visibility: 'on' }
                            ]
                        },
                        {
                            featureType: 'water',
                            stylers: [
                                { color: '#c9dfe4' }
                            ]
                        }
                    ],
                    disableDoubleClickZoom: !0,
                    center: new google.maps.LatLng(43.569787, 39.756362)
                };

                var map = new google.maps.Map(document.getElementById( 'map-conteiner' ), mapOptions);
                
                var bullet = {
                    url: 'images/map-bullet.png',
                    size: new google.maps.Size(39, 52),
                    origin: new google.maps.Point(0,0),
                    anchor: new google.maps.Point(39, 52)
                };
                
                new google.maps.Marker({
                    position: new google.maps.LatLng(43.569787, 39.756362),
                    map: map,
                    icon: bullet
                });
            },
            cache: function( s, cb )
            {
                try {
                    var a, g = [], i, x, cnt = s.length, p = { i: {}, ac: 0, c: 0 }, cb = cb || function(){};
                    
                    function y( index, src )
                    {
                        g.push( src );
                        
                        if( g.length >= cnt )
                        {
                            cb.call();
                        }
                        
                        p.c++
                    }

                    for (x in s)
                    {
                        a = s[x];
                        
                        i = new Image();
                        i.src = a;

                        i.onload = y( x, a );

                        p.i[a] = i;
                        p.ac++
                    }
                }
                catch(e) {}
            },
            retina: function()
            {
                if( 'devicePixelRatio' in window && window.devicePixelRatio == 2 )
                {
                    var i=0, src, img = $( 'img.replace-2x' ).get(), l = img.length;
                    for (i; i<l; i++)
                    {
                        src = img[i].src;
                        src = src.replace(/\.(png|jpg|gif)+$/i, '@2x.$1');
                        img[i].src = src;
                    }
                }
            },
            isUndefined: function( obj )
            {
                return obj === void 0;
            },
            updateImage: function(element)
            {
                if( $(element).length > 0 ) {
                    var image = $(element).attr('src').split( '?' )[0] ;
                    $(element).attr('src', image + '?v=' + Math.random() );
                }
                return false;
            },
            random: function(min, max)
            {
                min = min || 0 ;
                max = max || 100 ;
                return Math.floor(Math.random() * ( max - min + 1 )) + min ;
            }
        }
    };

    $.app.movies = {};
    $.app.movies.load = function() {
        alert( 'load more' );
        return false;
    };

    $.app.module.form_validation_default = function($form, errors) {
        $form.find('.form_error_block').hide();
        $form.find('.error').removeClass('error');
        $form.find('.checkbox__label-error').removeClass('checkbox__label-error');
        if(errors) {
            var $error_block = $('#form-errors');
            $error_block.html('');

            for(fieldName in errors)
            {
                $field = $form.find('input[name="'+fieldName+'"]');
                $error_block.append(
                    [
                        '<span>',
                        $field.data('error'),
                        '</span>'
                    ].join('')
                );
            }
        }
    };

    $.app.callback_stack = {};
    $.app.callback_stack.form_ajax_default = function($form, response) {
        if(response.status) {
            if(response.hasOwnProperty('redirect_url')) {
                window.location.href = response.redirect_url;
            }
        }
        else if(response.errors) {
            $.app.module.form_validation_default($form, response.errors);
        }
        
        if(response.hasOwnProperty('message')) {
            $.popup.message(response.title, response.message);
        }
    };

    $.app.module.form_ajax = function() {
        $('body').on('submit' ,'.form-ajax', function(e) {
            var $form = $(this);
            e.preventDefault();
            
            $.ajax({
                url: $form.attr('action'),
                type: ($form.attr('method') || 'post'),
                data: $form.serialize(),
                dataType: 'json',
                success: function(response)
                {
                    if($form.data('callback') && $.app.callback_stack.hasOwnProperty($form.data('callback'))) {
                        $.app.callback_stack[$form.data('callback')]($form, response);
                    }
                    else {
                        $.app.callback_stack.form_ajax_default($form, response);
                    }

                    if( response.status === true && response.message !== '' )
                    {
                        $.popup.message( response.title, response.message );
                    }
                },
                error: function(response)
                {
                    $.app.callback_stack.form_ajax_default($form, response);
                    alert("error");
                }
            });
        });
    };

    $.app.module.upload_button = function(){
        $('body').on('submit' ,'.form-file-upload', function(e) {
            return AIM.submit(this, {
                onStart: function()
                {

                },
                onComplete: function( result )
                {
                    if( typeof result === 'object' && result.status === true && typeof result.photo_url !== 'undefined' )
                    { }
                }
            });
        });
        
        $(document).on('change', '.upload_button_onchange', function(){
            if( $(this).closest('.upload_button').find('.upload_button_field').length > 0 )
            {
                $(this).closest('.upload_button').find('.upload_button_field').html( $(this).val() );
            }
        });
    };

    $.app.custom_placeholder = function() {
        if (Modernizr.touch) {
            return;
        }

        $('input, textarea').each(function() {
            var $input = $(this), $inputWrapper, $placeholder, placeholderText = $input.attr('placeholder');
            if(placeholderText) {
                $inputWrapper = $input.parent();
                $placeholder = $('<div class="default-input__placeholder" style="line-height: '+($input.is('textarea') ? '36px' : ( $inputWrapper.innerHeight() == 0 ? '36' : $inputWrapper.innerHeight() )+'px')+'">'+placeholderText+'</div>');
                $placeholder[$input.val().length ? 'hide' : 'show']();
                $input.addClass('custom-placeholder').attr('placeholder', '');
                $inputWrapper.append($placeholder);
            }
        });
        
        $('body').on('blur', '.custom-placeholder', function() {
            var $this = $(this);
            if(!$this.val().length) {
                $this.parent().find('.default-input__placeholder').show();
            }
        });
        $('body').on('focus', '.custom-placeholder', function() {
            $(this).parent().find('.default-input__placeholder').hide();
        });

        $('body').on('click', '.default-input__placeholder', function() {
            var $this = $(this);
    
            $this.hide();
            $this.parent().find('.custom-placeholder').trigger('focus');
        });
        $('body').on('selectstart', '.default-input__placeholder', false);
    };

    $.app.run();
})(jQuery);
;(function($) {
    $.cart = {
        initRequestClick: function()
        {
            $('body').on('click', '.j-remover-request', function(e){
                e.preventDefault();

                var $remover = $(this).closest('.remover'), product = $(this).data('element'), status = $(this).data('status');

                if (status !== 0)
                {
                    if ($('#cart-product-'+product).length)
                    {
                        $('#cart-product-'+product).fadeOut(function(){
                            $(this).remove();
                        });
                    }

                    console.log(product + ' as ' + status);
                }
                
                setTimeout(function(){
                    $remover.fadeOut(function(){
                        $(this).remove();
                    });
                }, 150);

                return !1;
            });
        },

    	init: function()
    	{
    		$.cart.initBuy();
    		$.cart.initRemove();
    		$.cart.initControll();

            $.cart.initRequestClick();

            $('body').on('click', '.j-cart-remove', function(e){
                e.preventDefault();

                if (!$(this).closest('.list-item-footer').find('.remover').length)
                {
                    var $remover, product = $(this).data('element');

                    $remover = [
                        '<div class="remover">',
                            '<div class="remover__content">',
                                '<div class="remover__title">',
                                    'Действительно удалить?',
                                '</div>',

                                '<div class="remover__buttons">',
                                    '<a href="#" data-element="' + product + '" data-status="1" class="remover__button is-yes j-remover-request">Да</a>',
                                    '<a href="#" data-element="' + product + '" data-status="0" class="remover__button is-no j-remover-request">Нет</a>',
                                '</div>',
                            '</div>',
                        '</div>'
                    ].join(' ');
                    
                    $(this).closest('.list-item-footer').append($remover);
                }
                else
                {
                    var $remover = $(this).closest('.list-item-footer').find('.remover');

                    $remover.fadeOut(function(){
                        $(this).remove();
                    });
                }

                return !1;
            });
    	},

    	initBuy: function()
    	{
    		$('.add-cart-trigger').on('click', function(e){
    			e.preventDefault();
    			$.cart.buyItem( $(this).attr('href').split('-')[1] );
    		});
    	},
    	initControll: function()
    	{
    		$('.increase-cart-trigger').on('click', function(e){
    			e.preventDefault();
    			$.cart.increase( $(this).attr('href').split('-')[1] );
    		});

			$('.decrease-cart-trigger').on('click', function(e){
    			e.preventDefault();
    			$.cart.decrease( $(this).attr('href').split('-')[1] );
    		});
    	},
    	initRemove: function()
    	{
    		$('.remove-cart-trigger').on('click', function(e){
    			e.preventDefault();
    			$.cart.removeItem($(this).attr('href').split('-')[1], this);
    		});
    	},
    	removeItem: function(id, _self_)
		{
			$.post('/ajax/cart/remove/', { item: id }, function(data) {
				if( $('#list-item-'+id).find('.incart').length > 0 )
				{
					$('#list-item-'+id).find('.incart').remove();
				}
				
				if($(_self_).hasClass('list-item-incart'))
				{
					$(_self_).remove();
				}
				else
				{
					$('#incart-item-'+id).html( '<a href="#item-'+id+'" title="Добавить в корзину" class="button-cart add-cart-trigger">Купить кресло</a>' );
					$.cart.initBuy();
				}

		        $.cart.addedItem('Товар удален из корзины.');
			});
		},
		buyItem: function(id)
		{
			var count = 1;
			
			if( $('#count-'+id).length > 0 ) {
				count = parseInt( $('#count-'+id).val() ) ;
			}

			$.post('../cart.json', { item: id, count: count }, function(data) {
				if( $('#cart-count').length > 0 )
				{
					$('#cart-count').html( data.count );
				}
				
				if( $('#cart-price').length > 0 )
				{
					$('#cart-price').html( data.money );
				}
				
				if( $('#count-'+id).length > 0 )
				{
					$('#count-'+id).val(1);
				}

				if( $('#list-item-'+id).find('.incart').length == 0 ) {
					$('#incart-item-'+id).html( '<a href="#item-' + id + '" title="Удалить из корзины" class="button-remove remove-cart-trigger">Кресло в корзине</a>' );

					$.cart.initRemove();
				}

				$.cart.addedItem();
			}, 'JSON');
		},
		addedItem: function(text, large)
		{
		    text = !text ? 'Товар добавлен в корзину.' : text ;
		    large = !large ? false : large ;
		    var timeout = !large ? 1500 : 5000, addclass = !large ? '' : ' adding-large' ;
		    
		    if( $('body').find('#item-added-to-cart').length == 0 ) {
		        $('body').append('<div id="item-added-to-cart" class="showadding' + addclass + '"><div class="adding-inner"><div class="adding-content">' + text + '</div></div></div>');
		        setTimeout(function(){
		            $('body').find('#item-added-to-cart').remove() ;
		        },timeout);
		    }
		    else {
		        setTimeout(function(){
		            $('body').find('#item-added-to-cart').remove() ;
		        },timeout);
		    }
		},
		increase: function(id)
		{
			if( $('#count-'+id).length > 0 ) {
		        var value = parseInt( $('#count-'+id).val() ) ;
		            value = !value ? 0 : value ;
		            
		            value++ ;
		            
		            $('#count-'+id).val( value ) ;
		    }
			
			if($('#cart-table').length > 0)
			{
				$.cart.reTotal(id);
			}
		},
		decrease: function(id)
		{
			if( $('#count-'+id).length > 0 )
			{
				var value = parseInt( $('#count-'+id).val() ) ;
					value = !value ? 1 : value ;
					
					if( value >= 2 ) value-- ;
					else value = 1 ;
					
					$('#count-'+id).val( value ) ;
			}
			
			if($('#cart-table').length > 0)
			{
				$.cart.reTotal(id);
			}
		},
		reTotal: function(id)
		{
			if( $('#count-'+id).length > 0 )
			{
				var count = parseInt( $('#count-'+id).val() );
				
				$.post('/ajax/cart/recount/', { item: id, count: count }, function(data) {
					var price = parseInt( $('#cart-item-price-'+id).html() );
					var total = count * price;

					$('#cart-item-total-'+id).html(total) ;
					$('#cart-total-count').html(data.count);
					$('#cart-total-price').html(data.money);

					if( $('#cart-count').length > 0 )
					{
						$('#cart-count').html( data.count );
					}
					
					if( $('#cart-price').length > 0 )
					{
						$('#cart-price').html( data.money );
					}
				}, 'JSON');
			}
		}
	}

	$.cart.init();
})(jQuery);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIl9fYXBwLmpzIiwiX2NhcnQuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzltQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoiYXBwLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbInZhciBib2R5ID0gZG9jdW1lbnQuYm9keSwgdGltZXI7XG5cbndpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdzY3JvbGwnLCBmdW5jdGlvbigpIHtcbiAgICBjbGVhclRpbWVvdXQodGltZXIpO1xuICAgIGlmKCFib2R5LmNsYXNzTGlzdC5jb250YWlucygnZGlzYWJsZS1ob3ZlcicpKVxuICAgIHtcbiAgICAgICAgYm9keS5jbGFzc0xpc3QuYWRkKCdkaXNhYmxlLWhvdmVyJylcbiAgICB9XG5cbiAgICB0aW1lciA9IHNldFRpbWVvdXQoZnVuY3Rpb24oKXtcbiAgICAgICAgYm9keS5jbGFzc0xpc3QucmVtb3ZlKCdkaXNhYmxlLWhvdmVyJylcbiAgICB9LCA1MDApO1xufSwgZmFsc2UpO1xuXG4vLyBGaW5kLCBSZXBsYWNlLCBDYXNlXG4vLyBpLmUgXCJUZXN0IHRvIHNlZSBpZiB0aGlzIHdvcmtzPyAoWWVzfE5vKVwiLnJlcGxhY2VBbGwoJyhZZXN8Tm8pJywgJ1llcyEnKTtcbi8vIGkuZS4yIFwiVGVzdCB0byBzZWUgaWYgdGhpcyB3b3Jrcz8gKFllc3xObylcIi5yZXBsYWNlQWxsKCcoeWVzfG5vKScsICdZZXMhJywgdHJ1ZSk7XG5TdHJpbmcucHJvdG90eXBlLnJlcGxhY2VBbGwgPSBmdW5jdGlvbihfZiwgX3IsIF9jKXsgXG4gICAgdmFyIG8gPSB0aGlzLnRvU3RyaW5nKCk7XG4gICAgdmFyIHIgPSAnJztcbiAgICB2YXIgcyA9IG87XG4gICAgdmFyIGIgPSAwO1xuICAgIHZhciBlID0gLTE7XG4gICAgaWYoX2MpeyBfZiA9IF9mLnRvTG93ZXJDYXNlKCk7IHMgPSBvLnRvTG93ZXJDYXNlKCk7IH1cblxuICAgIHdoaWxlKChlPXMuaW5kZXhPZihfZikpID4gLTEpXG4gICAge1xuICAgICAgICByICs9IG8uc3Vic3RyaW5nKGIsIGIrZSkgKyBfcjtcbiAgICAgICAgcyA9IHMuc3Vic3RyaW5nKGUrX2YubGVuZ3RoLCBzLmxlbmd0aCk7XG4gICAgICAgIGIgKz0gZStfZi5sZW5ndGg7XG4gICAgfVxuXG4gICAgLy8gQWRkIExlZnRvdmVyXG4gICAgaWYocy5sZW5ndGg+MCl7IHIrPW8uc3Vic3RyaW5nKG8ubGVuZ3RoLXMubGVuZ3RoLCBvLmxlbmd0aCk7IH1cblxuICAgIC8vIFJldHVybiBOZXcgU3RyaW5nXG4gICAgcmV0dXJuIHI7XG59O1xuXG5pZiAoIUFycmF5LnByb3RvdHlwZS5pbmRleE9mKSB7XG4gICAgQXJyYXkucHJvdG90eXBlLmluZGV4T2YgPSBmdW5jdGlvbiAoc2VhcmNoRWxlbWVudCwgZnJvbUluZGV4KSB7XG4gICAgICBpZiAoIHRoaXMgPT09IHVuZGVmaW5lZCB8fCB0aGlzID09PSBudWxsICkge1xuICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCAnXCJ0aGlzXCIgaXMgbnVsbCBvciBub3QgZGVmaW5lZCcgKTtcbiAgICAgIH1cblxuICAgICAgdmFyIGxlbmd0aCA9IHRoaXMubGVuZ3RoID4+PiAwOyAvLyBIYWNrIHRvIGNvbnZlcnQgb2JqZWN0Lmxlbmd0aCB0byBhIFVJbnQzMlxuXG4gICAgICBmcm9tSW5kZXggPSArZnJvbUluZGV4IHx8IDA7XG5cbiAgICAgIGlmIChNYXRoLmFicyhmcm9tSW5kZXgpID09PSBJbmZpbml0eSkge1xuICAgICAgICBmcm9tSW5kZXggPSAwO1xuICAgICAgfVxuXG4gICAgICBpZiAoZnJvbUluZGV4IDwgMCkge1xuICAgICAgICBmcm9tSW5kZXggKz0gbGVuZ3RoO1xuICAgICAgICBpZiAoZnJvbUluZGV4IDwgMCkge1xuICAgICAgICAgIGZyb21JbmRleCA9IDA7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgZm9yICg7ZnJvbUluZGV4IDwgbGVuZ3RoOyBmcm9tSW5kZXgrKykge1xuICAgICAgICBpZiAodGhpc1tmcm9tSW5kZXhdID09PSBzZWFyY2hFbGVtZW50KSB7XG4gICAgICAgICAgcmV0dXJuIGZyb21JbmRleDtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gLTE7XG4gICAgfTtcbn1cblxuLy8gU2ltcGxlIEphdmFTY3JpcHQgVGVtcGxhdGluZ1xuLy8gSm9obiBSZXNpZyAtIGh0dHA6Ly9lam9obi5vcmcvIC0gTUlUIExpY2Vuc2VkXG47KGZ1bmN0aW9uKCl7XG4gICAgdmFyIGNhY2hlID0ge307XG5cbiAgICB0aGlzLnRtcGwgPSBmdW5jdGlvbiB0bXBsKHN0ciwgZGF0YSl7XG4gICAgICAgIC8vIEZpZ3VyZSBvdXQgaWYgd2UncmUgZ2V0dGluZyBhIHRlbXBsYXRlLCBvciBpZiB3ZSBuZWVkIHRvXG4gICAgICAgIC8vIGxvYWQgdGhlIHRlbXBsYXRlIC0gYW5kIGJlIHN1cmUgdG8gY2FjaGUgdGhlIHJlc3VsdC5cbiAgICAgICAgdmFyIGZuID0gIS9cXFcvLnRlc3Qoc3RyKSA/XG4gICAgICAgICAgICBjYWNoZVtzdHJdID0gY2FjaGVbc3RyXSB8fFxuICAgICAgICAgICAgICAgIHRtcGwoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoc3RyKS5pbm5lckhUTUwpIDpcblxuICAgICAgICAgICAgLy8gR2VuZXJhdGUgYSByZXVzYWJsZSBmdW5jdGlvbiB0aGF0IHdpbGwgc2VydmUgYXMgYSB0ZW1wbGF0ZVxuICAgICAgICAgICAgLy8gZ2VuZXJhdG9yIChhbmQgd2hpY2ggd2lsbCBiZSBjYWNoZWQpLlxuICAgICAgICAgICAgbmV3IEZ1bmN0aW9uKFwib2JqXCIsXG4gICAgICAgICAgICAgICAgXCJ2YXIgcD1bXSxwcmludD1mdW5jdGlvbigpe3AucHVzaC5hcHBseShwLGFyZ3VtZW50cyk7fTtcIiArXG5cbiAgICAgICAgICAgICAgICAgICAgLy8gSW50cm9kdWNlIHRoZSBkYXRhIGFzIGxvY2FsIHZhcmlhYmxlcyB1c2luZyB3aXRoKCl7fVxuICAgICAgICAgICAgICAgICAgICBcIndpdGgob2JqKXtwLnB1c2goJ1wiICtcblxuICAgICAgICAgICAgICAgICAgICAvLyBDb252ZXJ0IHRoZSB0ZW1wbGF0ZSBpbnRvIHB1cmUgSmF2YVNjcmlwdFxuICAgICAgICAgICAgICAgICAgICBzdHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKC9bXFxyXFx0XFxuXS9nLCBcIiBcIilcbiAgICAgICAgICAgICAgICAgICAgICAgIC5zcGxpdChcIjwlXCIpLmpvaW4oXCJcXHRcIilcbiAgICAgICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKC8oKF58JT4pW15cXHRdKiknL2csIFwiJDFcXHJcIilcbiAgICAgICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKC9cXHQ9KC4qPyklPi9nLCBcIicsJDEsJ1wiKVxuICAgICAgICAgICAgICAgICAgICAgICAgLnNwbGl0KFwiXFx0XCIpLmpvaW4oXCInKTtcIilcbiAgICAgICAgICAgICAgICAgICAgICAgIC5zcGxpdChcIiU+XCIpLmpvaW4oXCJwLnB1c2goJ1wiKVxuICAgICAgICAgICAgICAgICAgICAgICAgLnNwbGl0KFwiXFxyXCIpLmpvaW4oXCJcXFxcJ1wiKVxuICAgICAgICAgICAgICAgICAgICArIFwiJyk7fXJldHVybiBwLmpvaW4oJycpO1wiKTtcblxuICAgICAgICAvLyBQcm92aWRlIHNvbWUgYmFzaWMgY3VycnlpbmcgdG8gdGhlIHVzZXJcbiAgICAgICAgcmV0dXJuIGRhdGEgPyBmbiggZGF0YSApIDogZm47XG4gICAgfTtcbn0pKCk7XG5cbihmdW5jdGlvbigkKSB7XG4gICAgJC5hcHAgPSB7XG4gICAgICAgIHNhbmR3aWNoOiB7XG4gICAgICAgICAgICBjb25maWc6IHtcbiAgICAgICAgICAgICAgICBrZXlIb29rczogITEsXG4gICAgICAgICAgICAgICAgc2VsZWN0b3I6ICcuanMtc2FuZHdpY2gtbWVudScsXG4gICAgICAgICAgICAgICAgd3JhcHBlcjogJy53cmFwcGVyJyxcbiAgICAgICAgICAgICAgICBvdmVybGF5OiAnLm1lbnUtb3ZlcmxheSdcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIGV4dGVuZDogZnVuY3Rpb24oY29uZmlnKVxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIF90aGlzID0gdGhpcztcblxuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgY29uZmlnICE9PSAndW5kZWZpbmVkJylcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIHZhciB4O1xuICAgICAgICAgICAgICAgICAgICBmb3IgKHggaW4gY29uZmlnKVxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIF90aGlzLmNvbmZpZ1t4XSAhPT0gJ3VuZGVmaW5lZCcpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuY29uZmlnW3hdID0gY29uZmlnW3hdO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgaXNPcGVuOiBmdW5jdGlvbigpXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICQoJ2JvZHknKS5oYXNDbGFzcygncGFnZS12aXNpYmxlJyk7XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICBoaWRlOiBmdW5jdGlvbigpXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgJCgnYm9keScpLnJlbW92ZUNsYXNzKCdwYWdlLW9wZW4nKTtcblxuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgJCgnYm9keScpLnJlbW92ZUNsYXNzKCdwYWdlLXZpc2libGUnKTtcbiAgICAgICAgICAgICAgICB9LCAxMCk7XG5cbiAgICAgICAgICAgICAgICAkKHRoaXMuY29uZmlnLm92ZXJsYXkpLmNzcyh7XG4gICAgICAgICAgICAgICAgICAgICd2aXNpYmlsaXR5JzogJ2hpZGRlbidcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIHRvZ2dsZTogZnVuY3Rpb24oKVxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGlmICgkKCdib2R5JykuaGFzQ2xhc3MoJ3BhZ2UtdmlzaWJsZScpKVxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgJCgnYm9keScpLnJlbW92ZUNsYXNzKCdwYWdlLW9wZW4nKTtcblxuICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgICAgICAkKCdib2R5JykucmVtb3ZlQ2xhc3MoJ3BhZ2UtdmlzaWJsZScpO1xuICAgICAgICAgICAgICAgICAgICB9LCAyMDApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAkKCdib2R5JykuYWRkQ2xhc3MoJ3BhZ2Utb3BlbicpO1xuXG4gICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICQoJ2JvZHknKS5hZGRDbGFzcygncGFnZS12aXNpYmxlJyk7XG4gICAgICAgICAgICAgICAgICAgIH0sIDEwKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB2YXIgdmlzaWJpbGl0eSA9ICd2aXNpYmxlJztcblxuICAgICAgICAgICAgICAgIGlmICghJCgnYm9keScpLmhhc0NsYXNzKCdwYWdlLW9wZW4nKSlcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIHZpc2liaWxpdHkgPSAnaGlkZGVuJ1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAkKF90aGlzLmNvbmZpZy5vdmVybGF5KS5jc3Moe1xuICAgICAgICAgICAgICAgICAgICAndmlzaWJpbGl0eSc6IHZpc2liaWxpdHlcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIHNhbmR3aWNoVHJpZ2dlcjogZnVuY3Rpb24oKVxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIF90aGlzID0gdGhpcztcblxuICAgICAgICAgICAgICAgIGlmIChfdGhpcy5jb25maWcua2V5SG9va3MpXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAkKCdib2R5Jykub24oJ2tleWRvd24nLCBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZihlLmtleUNvZGUgPT0gMjcgJiYgX3RoaXMuaXNPcGVuKCkpXG4gICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMudG9nZ2xlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAkKCdib2R5Jykub24oJ2NsaWNrJywgX3RoaXMuY29uZmlnLnNlbGVjdG9yLCBmdW5jdGlvbihlKXtcbiAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCA/IGUucHJldmVudERlZmF1bHQoKSA6IGUucmV0dXJuVmFsdWUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMudG9nZ2xlKCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICBvdmVybGF5VHJpZ2dlcjogZnVuY3Rpb24oKVxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIF90aGlzID0gdGhpcztcblxuICAgICAgICAgICAgICAgICQoJ2JvZHknKS5vbignY2xpY2snLCBfdGhpcy5jb25maWcub3ZlcmxheSwgZnVuY3Rpb24oZSl7XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLmhpZGUoKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIGluaXQ6IGZ1bmN0aW9uKGNvbmZpZylcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB0aGlzLmV4dGVuZChjb25maWcpO1xuICAgICAgICAgICAgICAgIHRoaXMuc2FuZHdpY2hUcmlnZ2VyKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5vdmVybGF5VHJpZ2dlcigpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHJ1bjogZnVuY3Rpb24oKVxuICAgICAgICB7XG4gICAgICAgICAgICAkLmFwcC5zYW5kd2ljaC5pbml0KCk7XG4gICAgICAgICAgICAkLmFwcC5tb2R1bGUuYmVhci5pbml0KCk7XG4gICAgICAgICAgICAkLmFwcC5tb2R1bGUuZm9ybV9hamF4KCk7XG4gICAgICAgICAgICAkLmFwcC5tb2R1bGUucmVzaXplKGZ1bmN0aW9uKCl7IH0sIDUwMCk7XG5cbiAgICAgICAgICAgICQoXCIuaW50ZWdlclwiKS5vbigna2V5cHJlc3MnLCBmdW5jdGlvbiAoZSkgeyBpZiggWzAsIDhdLmluZGV4T2YoIGUud2hpY2ggKSA8IDAgJiYgKCBlLndoaWNoIDwgNDggfHwgZS53aGljaCA+IDU3ICkgKSB7IHJldHVybiBmYWxzZTsgfSB9KTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgJCgnYm9keScpLm9uKCdjbGljaycsICcudG9nZ2xlLXRyaWdnZXInLCBmdW5jdGlvbihlKXtcbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgICAgICAgICB2YXIgaWQgPSAkKHRoaXMpLmF0dHIoJ2hyZWYnKTtcbiAgICAgICAgICAgICAgICBpZiggJChpZCkubGVuZ3RoID4gMCApXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBpZiggJCh0aGlzKS5oYXNDbGFzcygndWxfbGlzdC1pdGVtX2xpbmstZHJvcCcpIClcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS50b2dnbGVDbGFzcygndWxfbGlzdC1pdGVtX2xpbmstZHJvcC11cCcpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgJChpZCkuc2xpZGVUb2dnbGUoMTUwKTtcbiAgICAgICAgICAgICAgICAgICAgJCgnaHRtbCwgYm9keScpLmFuaW1hdGUoeyBzY3JvbGxUb3A6ICQodGhpcykub2Zmc2V0KCkudG9wIH0sICdzbG93Jyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIFxuICAgICAgICAgICAgJCgnYm9keScpLm9uKCdtb3VzZWVudGVyJywgJy5uYXYtbGlzdC1pdGVtJywgZnVuY3Rpb24oZSl7XG4gICAgICAgICAgICAgICAgaWYgKCQodGhpcykuZmluZCgnLnN1Ym1lbnUnKS5sZW5ndGgpXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICB2YXIgJHRoaXMgPSAkKHRoaXMpLFxuICAgICAgICAgICAgICAgICAgICAgICAgJHN1Ym1lbnUgPSAkdGhpcy5maW5kKCcuc3VibWVudScpO1xuXG4gICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICRzdWJtZW51LmFkZENsYXNzKCdpcy1zaG93Jyk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc3VibWVudS5hZGRDbGFzcygnaXMtYW5pbWF0ZScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSwgMTApO1xuICAgICAgICAgICAgICAgICAgICB9LCA1MCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgICQoJ2JvZHknKS5vbignbW91c2VsZWF2ZScsICcubmF2LWxpc3QtaXRlbScsIGZ1bmN0aW9uKGUpe1xuICAgICAgICAgICAgICAgIGlmICgkKHRoaXMpLmZpbmQoJy5zdWJtZW51JykubGVuZ3RoKVxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyICR0aGlzID0gJCh0aGlzKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICRzdWJtZW51ID0gJHRoaXMuZmluZCgnLnN1Ym1lbnUnKTtcblxuICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgICAgICAkc3VibWVudS5yZW1vdmVDbGFzcygnaXMtYW5pbWF0ZScpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHN1Ym1lbnUucmVtb3ZlQ2xhc3MoJ2lzLXNob3cnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIDI1MCk7XG4gICAgICAgICAgICAgICAgICAgIH0sIDUwKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgaWYoIHR5cGVvZiAkLmluaXRQb3B1cHMgIT09ICd1bmRlZmluZWQnIClcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAkLmluaXRQb3B1cHMoKTtcblxuICAgICAgICAgICAgICAgIGlmKHdpbmRvdy5sb2NhdGlvbi5oYXNoLmxlbmd0aCA+IDEgJiYgJCh3aW5kb3cubG9jYXRpb24uaGFzaCkuaGFzQ2xhc3MoJ3BvcHVwJykgKVxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICQucG9wdXAub3Blbih3aW5kb3cubG9jYXRpb24uaGFzaC5zdWJzdHIoMSkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGNhdGNoKGUpIHt9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBtb2R1bGU6IHtcbiAgICAgICAgICAgIGJlYXI6IHtcbiAgICAgICAgICAgICAgICB0aW1lb3V0OiAyMDAwMCxcbiAgICAgICAgICAgICAgICBlbGVtZW50OiAnI2JlYXInLFxuICAgICAgICAgICAgICAgIG1vdmU6IGZ1bmN0aW9uKF9nb18pXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICB2YXIgX3NlbGZfID0gdGhpcywgdGltZW91dCA9IF9zZWxmXy50aW1lb3V0O1xuICAgICAgICAgICAgICAgICAgICBfZ29fID0gd2luZG93LmlubmVyV2lkdGggLSBfZ29fIC0gMjk4O1xuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgaWYoX2dvXyA+IHdpbmRvdy5pbm5lcldpZHRoKVxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICBfZ29fID0gd2luZG93LmlubmVyV2lkdGg7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBpZih0eXBlb2YoJC5jb29raWUoJ19nb18nKSkgIT09ICd1bmRlZmluZWQnKVxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICBfZ29fID0gJC5jb29raWUoJ19nb18nKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICQuY29va2llKCdfZ29fJywgX2dvXywgeyBleHBpcmVzOiA3LCBwYXRoOiAnLycgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYodHlwZW9mKCQuY29va2llKCdjb29yZGluYXRlJykpICE9PSAndW5kZWZpbmVkJyAmJiAkLmNvb2tpZSgnY29vcmRpbmF0ZScpICE9PSAnJylcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvb3JkID0gTWF0aC5mbG9vcigkLmNvb2tpZSgnY29vcmRpbmF0ZScpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgJChfc2VsZl8uZWxlbWVudCkuY3NzKHsgJ2xlZnQnOiBjb29yZCB9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBlcmNlbnQgPSAxMDAgLSBNYXRoLmZsb29yKCgod2luZG93LmlubmVyV2lkdGggLSBjb29yZCkgKiAxMDApIC8gd2luZG93LmlubmVyV2lkdGgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRpbWVvdXQgPSB0aW1lb3V0IC0gKCB0aW1lb3V0ICogcGVyY2VudCAvIDEwMCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgJChfc2VsZl8uZWxlbWVudCkuc3RvcCgpLmFuaW1hdGUoeyBsZWZ0OiBfZ29fIH0sIHsgZHVyYXRpb246IHRpbWVvdXQsIHN0ZXA6IGZ1bmN0aW9uKG5vdywgZngpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgJC5jb29raWUoJ2Nvb3JkaW5hdGUnLCBub3csIHsgZXhwaXJlczogNywgcGF0aDogJy8nIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZihub3cgPT0gX2dvXylcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKF9zZWxmXy5lbGVtZW50KS50b2dnbGVDbGFzcygnZm9vdGVyLWJlYXItcmV2ZXJzZScpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJC5yZW1vdmVDb29raWUoJ2Nvb3JkaW5hdGUnLCB7IHBhdGg6ICcvJyB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkLnJlbW92ZUNvb2tpZSgnX2dvXycsIHsgcGF0aDogJy8nIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJC5hcHAubW9kdWxlLmJlYXIubW92ZShfZ29fKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfX0pO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgcm90YXRlOiBmdW5jdGlvbiggZGVnIClcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICQodGhpcy5lbGVtZW50KS5maW5kKCcuZm9vdGVyLWJlYXItaW5uZXInKS5zdG9wKCkuYW5pbWF0ZSh7IHJvdGF0aW9uOiBkZWcgfSwgeyBkdXJhdGlvbjogMTgwMCwgc3RlcDogZnVuY3Rpb24obm93LCBmeCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5jc3Moe1widHJhbnNmb3JtXCI6IFwicm90YXRlKFwiK25vdytcImRlZylcIn0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYobm93ID09IGRlZylcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkLmFwcC5tb2R1bGUuYmVhci5yb3RhdGUoKGRlZyotMSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9fSk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBpbml0OiBmdW5jdGlvbigpXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBpZiAoJCh3aW5kb3cpLndpZHRoKCkgPiA5NjApXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucm90YXRlKDYpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tb3ZlKDApO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJlc2l6ZTogZnVuY3Rpb24oIGNhbGxiYWNrLCB0aW1lIClcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAkKHdpbmRvdykucmVzaXplKGZ1bmN0aW9uKGUpe1xuICAgICAgICAgICAgICAgICAgICB3aW5kb3cucmVzaXplRXZ0O1xuICAgICAgICAgICAgICAgICAgICAkKHdpbmRvdykucmVzaXplKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dCh3aW5kb3cucmVzaXplRXZ0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5yZXNpemVFdnQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2suYXBwbHkoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIHRpbWUpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnb29nbGVNYXA6IGZ1bmN0aW9uKClcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB2YXIgbWFwT3B0aW9ucyA9IHtcbiAgICAgICAgICAgICAgICAgICAgem9vbTogMTYsXG4gICAgICAgICAgICAgICAgICAgIHpvb21Db250cm9sOiAhMCxcbiAgICAgICAgICAgICAgICAgICAgem9vbUNvbnRyb2xPcHRpb25zOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzdHlsZTogZ29vZ2xlLm1hcHMuWm9vbUNvbnRyb2xTdHlsZS5MQVJHRSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiBnb29nbGUubWFwcy5Db250cm9sUG9zaXRpb24uTEVGVF9UT1BcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgcGFuQ29udHJvbDogITAsXG4gICAgICAgICAgICAgICAgICAgIHBhbkNvbnRyb2xPcHRpb25zOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogZ29vZ2xlLm1hcHMuQ29udHJvbFBvc2l0aW9uLkxFRlRfVE9QXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHNjcm9sbHdoZWVsOiAhMSxcbiAgICAgICAgICAgICAgICAgICAgbmF2aWdhdGlvbkNvbnRyb2w6ICExLFxuICAgICAgICAgICAgICAgICAgICBtYXBUeXBlQ29udHJvbDogITEsXG4gICAgICAgICAgICAgICAgICAgIHNjYWxlQ29udHJvbDogITEsXG4gICAgICAgICAgICAgICAgICAgIGRyYWdnYWJsZTogITAsXG4gICAgICAgICAgICAgICAgICAgIHN0eWxlczogW1xuICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0eWxlcnM6IFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeyBodWU6ICcjYWRjZWQ1JyB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXVxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50VHlwZTogJ2xhYmVscycsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3R5bGVyczogW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7IHZpc2liaWxpdHk6ICdvbicgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmVhdHVyZVR5cGU6ICd3YXRlcicsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3R5bGVyczogW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7IGNvbG9yOiAnI2M5ZGZlNCcgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICAgICAgZGlzYWJsZURvdWJsZUNsaWNrWm9vbTogITAsXG4gICAgICAgICAgICAgICAgICAgIGNlbnRlcjogbmV3IGdvb2dsZS5tYXBzLkxhdExuZyg0My41Njk3ODcsIDM5Ljc1NjM2MilcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgdmFyIG1hcCA9IG5ldyBnb29nbGUubWFwcy5NYXAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoICdtYXAtY29udGVpbmVyJyApLCBtYXBPcHRpb25zKTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICB2YXIgYnVsbGV0ID0ge1xuICAgICAgICAgICAgICAgICAgICB1cmw6ICdpbWFnZXMvbWFwLWJ1bGxldC5wbmcnLFxuICAgICAgICAgICAgICAgICAgICBzaXplOiBuZXcgZ29vZ2xlLm1hcHMuU2l6ZSgzOSwgNTIpLFxuICAgICAgICAgICAgICAgICAgICBvcmlnaW46IG5ldyBnb29nbGUubWFwcy5Qb2ludCgwLDApLFxuICAgICAgICAgICAgICAgICAgICBhbmNob3I6IG5ldyBnb29nbGUubWFwcy5Qb2ludCgzOSwgNTIpXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBuZXcgZ29vZ2xlLm1hcHMuTWFya2VyKHtcbiAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246IG5ldyBnb29nbGUubWFwcy5MYXRMbmcoNDMuNTY5Nzg3LCAzOS43NTYzNjIpLFxuICAgICAgICAgICAgICAgICAgICBtYXA6IG1hcCxcbiAgICAgICAgICAgICAgICAgICAgaWNvbjogYnVsbGV0XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgY2FjaGU6IGZ1bmN0aW9uKCBzLCBjYiApXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGEsIGcgPSBbXSwgaSwgeCwgY250ID0gcy5sZW5ndGgsIHAgPSB7IGk6IHt9LCBhYzogMCwgYzogMCB9LCBjYiA9IGNiIHx8IGZ1bmN0aW9uKCl7fTtcbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIHkoIGluZGV4LCBzcmMgKVxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICBnLnB1c2goIHNyYyApO1xuICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiggZy5sZW5ndGggPj0gY250IClcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYi5jYWxsKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgIHAuYysrXG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBmb3IgKHggaW4gcylcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgYSA9IHNbeF07XG4gICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgIGkgPSBuZXcgSW1hZ2UoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGkuc3JjID0gYTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaS5vbmxvYWQgPSB5KCB4LCBhICk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHAuaVthXSA9IGk7XG4gICAgICAgICAgICAgICAgICAgICAgICBwLmFjKytcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjYXRjaChlKSB7fVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJldGluYTogZnVuY3Rpb24oKVxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGlmKCAnZGV2aWNlUGl4ZWxSYXRpbycgaW4gd2luZG93ICYmIHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvID09IDIgKVxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGk9MCwgc3JjLCBpbWcgPSAkKCAnaW1nLnJlcGxhY2UtMngnICkuZ2V0KCksIGwgPSBpbWcubGVuZ3RoO1xuICAgICAgICAgICAgICAgICAgICBmb3IgKGk7IGk8bDsgaSsrKVxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzcmMgPSBpbWdbaV0uc3JjO1xuICAgICAgICAgICAgICAgICAgICAgICAgc3JjID0gc3JjLnJlcGxhY2UoL1xcLihwbmd8anBnfGdpZikrJC9pLCAnQDJ4LiQxJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpbWdbaV0uc3JjID0gc3JjO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGlzVW5kZWZpbmVkOiBmdW5jdGlvbiggb2JqIClcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gb2JqID09PSB2b2lkIDA7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdXBkYXRlSW1hZ2U6IGZ1bmN0aW9uKGVsZW1lbnQpXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgaWYoICQoZWxlbWVudCkubGVuZ3RoID4gMCApIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGltYWdlID0gJChlbGVtZW50KS5hdHRyKCdzcmMnKS5zcGxpdCggJz8nIClbMF0gO1xuICAgICAgICAgICAgICAgICAgICAkKGVsZW1lbnQpLmF0dHIoJ3NyYycsIGltYWdlICsgJz92PScgKyBNYXRoLnJhbmRvbSgpICk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByYW5kb206IGZ1bmN0aW9uKG1pbiwgbWF4KVxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIG1pbiA9IG1pbiB8fCAwIDtcbiAgICAgICAgICAgICAgICBtYXggPSBtYXggfHwgMTAwIDtcbiAgICAgICAgICAgICAgICByZXR1cm4gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKCBtYXggLSBtaW4gKyAxICkpICsgbWluIDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH07XG5cbiAgICAkLmFwcC5tb3ZpZXMgPSB7fTtcbiAgICAkLmFwcC5tb3ZpZXMubG9hZCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICBhbGVydCggJ2xvYWQgbW9yZScgKTtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH07XG5cbiAgICAkLmFwcC5tb2R1bGUuZm9ybV92YWxpZGF0aW9uX2RlZmF1bHQgPSBmdW5jdGlvbigkZm9ybSwgZXJyb3JzKSB7XG4gICAgICAgICRmb3JtLmZpbmQoJy5mb3JtX2Vycm9yX2Jsb2NrJykuaGlkZSgpO1xuICAgICAgICAkZm9ybS5maW5kKCcuZXJyb3InKS5yZW1vdmVDbGFzcygnZXJyb3InKTtcbiAgICAgICAgJGZvcm0uZmluZCgnLmNoZWNrYm94X19sYWJlbC1lcnJvcicpLnJlbW92ZUNsYXNzKCdjaGVja2JveF9fbGFiZWwtZXJyb3InKTtcbiAgICAgICAgaWYoZXJyb3JzKSB7XG4gICAgICAgICAgICB2YXIgJGVycm9yX2Jsb2NrID0gJCgnI2Zvcm0tZXJyb3JzJyk7XG4gICAgICAgICAgICAkZXJyb3JfYmxvY2suaHRtbCgnJyk7XG5cbiAgICAgICAgICAgIGZvcihmaWVsZE5hbWUgaW4gZXJyb3JzKVxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICRmaWVsZCA9ICRmb3JtLmZpbmQoJ2lucHV0W25hbWU9XCInK2ZpZWxkTmFtZSsnXCJdJyk7XG4gICAgICAgICAgICAgICAgJGVycm9yX2Jsb2NrLmFwcGVuZChcbiAgICAgICAgICAgICAgICAgICAgW1xuICAgICAgICAgICAgICAgICAgICAgICAgJzxzcGFuPicsXG4gICAgICAgICAgICAgICAgICAgICAgICAkZmllbGQuZGF0YSgnZXJyb3InKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICc8L3NwYW4+J1xuICAgICAgICAgICAgICAgICAgICBdLmpvaW4oJycpXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH07XG5cbiAgICAkLmFwcC5jYWxsYmFja19zdGFjayA9IHt9O1xuICAgICQuYXBwLmNhbGxiYWNrX3N0YWNrLmZvcm1fYWpheF9kZWZhdWx0ID0gZnVuY3Rpb24oJGZvcm0sIHJlc3BvbnNlKSB7XG4gICAgICAgIGlmKHJlc3BvbnNlLnN0YXR1cykge1xuICAgICAgICAgICAgaWYocmVzcG9uc2UuaGFzT3duUHJvcGVydHkoJ3JlZGlyZWN0X3VybCcpKSB7XG4gICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSByZXNwb25zZS5yZWRpcmVjdF91cmw7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZihyZXNwb25zZS5lcnJvcnMpIHtcbiAgICAgICAgICAgICQuYXBwLm1vZHVsZS5mb3JtX3ZhbGlkYXRpb25fZGVmYXVsdCgkZm9ybSwgcmVzcG9uc2UuZXJyb3JzKTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgaWYocmVzcG9uc2UuaGFzT3duUHJvcGVydHkoJ21lc3NhZ2UnKSkge1xuICAgICAgICAgICAgJC5wb3B1cC5tZXNzYWdlKHJlc3BvbnNlLnRpdGxlLCByZXNwb25zZS5tZXNzYWdlKTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICAkLmFwcC5tb2R1bGUuZm9ybV9hamF4ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICQoJ2JvZHknKS5vbignc3VibWl0JyAsJy5mb3JtLWFqYXgnLCBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICB2YXIgJGZvcm0gPSAkKHRoaXMpO1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAkLmFqYXgoe1xuICAgICAgICAgICAgICAgIHVybDogJGZvcm0uYXR0cignYWN0aW9uJyksXG4gICAgICAgICAgICAgICAgdHlwZTogKCRmb3JtLmF0dHIoJ21ldGhvZCcpIHx8ICdwb3N0JyksXG4gICAgICAgICAgICAgICAgZGF0YTogJGZvcm0uc2VyaWFsaXplKCksXG4gICAgICAgICAgICAgICAgZGF0YVR5cGU6ICdqc29uJyxcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbihyZXNwb25zZSlcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIGlmKCRmb3JtLmRhdGEoJ2NhbGxiYWNrJykgJiYgJC5hcHAuY2FsbGJhY2tfc3RhY2suaGFzT3duUHJvcGVydHkoJGZvcm0uZGF0YSgnY2FsbGJhY2snKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICQuYXBwLmNhbGxiYWNrX3N0YWNrWyRmb3JtLmRhdGEoJ2NhbGxiYWNrJyldKCRmb3JtLCByZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkLmFwcC5jYWxsYmFja19zdGFjay5mb3JtX2FqYXhfZGVmYXVsdCgkZm9ybSwgcmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgaWYoIHJlc3BvbnNlLnN0YXR1cyA9PT0gdHJ1ZSAmJiByZXNwb25zZS5tZXNzYWdlICE9PSAnJyApXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICQucG9wdXAubWVzc2FnZSggcmVzcG9uc2UudGl0bGUsIHJlc3BvbnNlLm1lc3NhZ2UgKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uKHJlc3BvbnNlKVxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgJC5hcHAuY2FsbGJhY2tfc3RhY2suZm9ybV9hamF4X2RlZmF1bHQoJGZvcm0sIHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgYWxlcnQoXCJlcnJvclwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgICQuYXBwLm1vZHVsZS51cGxvYWRfYnV0dG9uID0gZnVuY3Rpb24oKXtcbiAgICAgICAgJCgnYm9keScpLm9uKCdzdWJtaXQnICwnLmZvcm0tZmlsZS11cGxvYWQnLCBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICByZXR1cm4gQUlNLnN1Ym1pdCh0aGlzLCB7XG4gICAgICAgICAgICAgICAgb25TdGFydDogZnVuY3Rpb24oKVxuICAgICAgICAgICAgICAgIHtcblxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgb25Db21wbGV0ZTogZnVuY3Rpb24oIHJlc3VsdCApXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBpZiggdHlwZW9mIHJlc3VsdCA9PT0gJ29iamVjdCcgJiYgcmVzdWx0LnN0YXR1cyA9PT0gdHJ1ZSAmJiB0eXBlb2YgcmVzdWx0LnBob3RvX3VybCAhPT0gJ3VuZGVmaW5lZCcgKVxuICAgICAgICAgICAgICAgICAgICB7IH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIFxuICAgICAgICAkKGRvY3VtZW50KS5vbignY2hhbmdlJywgJy51cGxvYWRfYnV0dG9uX29uY2hhbmdlJywgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIGlmKCAkKHRoaXMpLmNsb3Nlc3QoJy51cGxvYWRfYnV0dG9uJykuZmluZCgnLnVwbG9hZF9idXR0b25fZmllbGQnKS5sZW5ndGggPiAwIClcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAkKHRoaXMpLmNsb3Nlc3QoJy51cGxvYWRfYnV0dG9uJykuZmluZCgnLnVwbG9hZF9idXR0b25fZmllbGQnKS5odG1sKCAkKHRoaXMpLnZhbCgpICk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICAkLmFwcC5jdXN0b21fcGxhY2Vob2xkZXIgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKE1vZGVybml6ci50b3VjaCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgJCgnaW5wdXQsIHRleHRhcmVhJykuZWFjaChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhciAkaW5wdXQgPSAkKHRoaXMpLCAkaW5wdXRXcmFwcGVyLCAkcGxhY2Vob2xkZXIsIHBsYWNlaG9sZGVyVGV4dCA9ICRpbnB1dC5hdHRyKCdwbGFjZWhvbGRlcicpO1xuICAgICAgICAgICAgaWYocGxhY2Vob2xkZXJUZXh0KSB7XG4gICAgICAgICAgICAgICAgJGlucHV0V3JhcHBlciA9ICRpbnB1dC5wYXJlbnQoKTtcbiAgICAgICAgICAgICAgICAkcGxhY2Vob2xkZXIgPSAkKCc8ZGl2IGNsYXNzPVwiZGVmYXVsdC1pbnB1dF9fcGxhY2Vob2xkZXJcIiBzdHlsZT1cImxpbmUtaGVpZ2h0OiAnKygkaW5wdXQuaXMoJ3RleHRhcmVhJykgPyAnMzZweCcgOiAoICRpbnB1dFdyYXBwZXIuaW5uZXJIZWlnaHQoKSA9PSAwID8gJzM2JyA6ICRpbnB1dFdyYXBwZXIuaW5uZXJIZWlnaHQoKSApKydweCcpKydcIj4nK3BsYWNlaG9sZGVyVGV4dCsnPC9kaXY+Jyk7XG4gICAgICAgICAgICAgICAgJHBsYWNlaG9sZGVyWyRpbnB1dC52YWwoKS5sZW5ndGggPyAnaGlkZScgOiAnc2hvdyddKCk7XG4gICAgICAgICAgICAgICAgJGlucHV0LmFkZENsYXNzKCdjdXN0b20tcGxhY2Vob2xkZXInKS5hdHRyKCdwbGFjZWhvbGRlcicsICcnKTtcbiAgICAgICAgICAgICAgICAkaW5wdXRXcmFwcGVyLmFwcGVuZCgkcGxhY2Vob2xkZXIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgICQoJ2JvZHknKS5vbignYmx1cicsICcuY3VzdG9tLXBsYWNlaG9sZGVyJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgJHRoaXMgPSAkKHRoaXMpO1xuICAgICAgICAgICAgaWYoISR0aGlzLnZhbCgpLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICR0aGlzLnBhcmVudCgpLmZpbmQoJy5kZWZhdWx0LWlucHV0X19wbGFjZWhvbGRlcicpLnNob3coKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgICQoJ2JvZHknKS5vbignZm9jdXMnLCAnLmN1c3RvbS1wbGFjZWhvbGRlcicsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJCh0aGlzKS5wYXJlbnQoKS5maW5kKCcuZGVmYXVsdC1pbnB1dF9fcGxhY2Vob2xkZXInKS5oaWRlKCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgICQoJ2JvZHknKS5vbignY2xpY2snLCAnLmRlZmF1bHQtaW5wdXRfX3BsYWNlaG9sZGVyJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgJHRoaXMgPSAkKHRoaXMpO1xuICAgIFxuICAgICAgICAgICAgJHRoaXMuaGlkZSgpO1xuICAgICAgICAgICAgJHRoaXMucGFyZW50KCkuZmluZCgnLmN1c3RvbS1wbGFjZWhvbGRlcicpLnRyaWdnZXIoJ2ZvY3VzJyk7XG4gICAgICAgIH0pO1xuICAgICAgICAkKCdib2R5Jykub24oJ3NlbGVjdHN0YXJ0JywgJy5kZWZhdWx0LWlucHV0X19wbGFjZWhvbGRlcicsIGZhbHNlKTtcbiAgICB9O1xuXG4gICAgJC5hcHAucnVuKCk7XG59KShqUXVlcnkpOyIsIjsoZnVuY3Rpb24oJCkge1xuICAgICQuY2FydCA9IHtcbiAgICAgICAgaW5pdFJlcXVlc3RDbGljazogZnVuY3Rpb24oKVxuICAgICAgICB7XG4gICAgICAgICAgICAkKCdib2R5Jykub24oJ2NsaWNrJywgJy5qLXJlbW92ZXItcmVxdWVzdCcsIGZ1bmN0aW9uKGUpe1xuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcblxuICAgICAgICAgICAgICAgIHZhciAkcmVtb3ZlciA9ICQodGhpcykuY2xvc2VzdCgnLnJlbW92ZXInKSwgcHJvZHVjdCA9ICQodGhpcykuZGF0YSgnZWxlbWVudCcpLCBzdGF0dXMgPSAkKHRoaXMpLmRhdGEoJ3N0YXR1cycpO1xuXG4gICAgICAgICAgICAgICAgaWYgKHN0YXR1cyAhPT0gMClcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIGlmICgkKCcjY2FydC1wcm9kdWN0LScrcHJvZHVjdCkubGVuZ3RoKVxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkKCcjY2FydC1wcm9kdWN0LScrcHJvZHVjdCkuZmFkZU91dChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICQodGhpcykucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHByb2R1Y3QgKyAnIGFzICcgKyBzdGF0dXMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgICRyZW1vdmVyLmZhZGVPdXQoZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICQodGhpcykucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0sIDE1MCk7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gITE7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgIFx0aW5pdDogZnVuY3Rpb24oKVxuICAgIFx0e1xuICAgIFx0XHQkLmNhcnQuaW5pdEJ1eSgpO1xuICAgIFx0XHQkLmNhcnQuaW5pdFJlbW92ZSgpO1xuICAgIFx0XHQkLmNhcnQuaW5pdENvbnRyb2xsKCk7XG5cbiAgICAgICAgICAgICQuY2FydC5pbml0UmVxdWVzdENsaWNrKCk7XG5cbiAgICAgICAgICAgICQoJ2JvZHknKS5vbignY2xpY2snLCAnLmotY2FydC1yZW1vdmUnLCBmdW5jdGlvbihlKXtcbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgICAgICAgICBpZiAoISQodGhpcykuY2xvc2VzdCgnLmxpc3QtaXRlbS1mb290ZXInKS5maW5kKCcucmVtb3ZlcicpLmxlbmd0aClcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIHZhciAkcmVtb3ZlciwgcHJvZHVjdCA9ICQodGhpcykuZGF0YSgnZWxlbWVudCcpO1xuXG4gICAgICAgICAgICAgICAgICAgICRyZW1vdmVyID0gW1xuICAgICAgICAgICAgICAgICAgICAgICAgJzxkaXYgY2xhc3M9XCJyZW1vdmVyXCI+JyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPGRpdiBjbGFzcz1cInJlbW92ZXJfX2NvbnRlbnRcIj4nLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPGRpdiBjbGFzcz1cInJlbW92ZXJfX3RpdGxlXCI+JyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICfQlNC10LnRgdGC0LLQuNGC0LXQu9GM0L3QviDRg9C00LDQu9C40YLRjD8nLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPC9kaXY+JyxcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPGRpdiBjbGFzcz1cInJlbW92ZXJfX2J1dHRvbnNcIj4nLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJzxhIGhyZWY9XCIjXCIgZGF0YS1lbGVtZW50PVwiJyArIHByb2R1Y3QgKyAnXCIgZGF0YS1zdGF0dXM9XCIxXCIgY2xhc3M9XCJyZW1vdmVyX19idXR0b24gaXMteWVzIGotcmVtb3Zlci1yZXF1ZXN0XCI+0JTQsDwvYT4nLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJzxhIGhyZWY9XCIjXCIgZGF0YS1lbGVtZW50PVwiJyArIHByb2R1Y3QgKyAnXCIgZGF0YS1zdGF0dXM9XCIwXCIgY2xhc3M9XCJyZW1vdmVyX19idXR0b24gaXMtbm8gai1yZW1vdmVyLXJlcXVlc3RcIj7QndC10YI8L2E+JyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJzwvZGl2PicsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJzwvZGl2PicsXG4gICAgICAgICAgICAgICAgICAgICAgICAnPC9kaXY+J1xuICAgICAgICAgICAgICAgICAgICBdLmpvaW4oJyAnKTtcbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICQodGhpcykuY2xvc2VzdCgnLmxpc3QtaXRlbS1mb290ZXInKS5hcHBlbmQoJHJlbW92ZXIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICB2YXIgJHJlbW92ZXIgPSAkKHRoaXMpLmNsb3Nlc3QoJy5saXN0LWl0ZW0tZm9vdGVyJykuZmluZCgnLnJlbW92ZXInKTtcblxuICAgICAgICAgICAgICAgICAgICAkcmVtb3Zlci5mYWRlT3V0KGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gITE7XG4gICAgICAgICAgICB9KTtcbiAgICBcdH0sXG5cbiAgICBcdGluaXRCdXk6IGZ1bmN0aW9uKClcbiAgICBcdHtcbiAgICBcdFx0JCgnLmFkZC1jYXJ0LXRyaWdnZXInKS5vbignY2xpY2snLCBmdW5jdGlvbihlKXtcbiAgICBcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgXHRcdFx0JC5jYXJ0LmJ1eUl0ZW0oICQodGhpcykuYXR0cignaHJlZicpLnNwbGl0KCctJylbMV0gKTtcbiAgICBcdFx0fSk7XG4gICAgXHR9LFxuICAgIFx0aW5pdENvbnRyb2xsOiBmdW5jdGlvbigpXG4gICAgXHR7XG4gICAgXHRcdCQoJy5pbmNyZWFzZS1jYXJ0LXRyaWdnZXInKS5vbignY2xpY2snLCBmdW5jdGlvbihlKXtcbiAgICBcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgXHRcdFx0JC5jYXJ0LmluY3JlYXNlKCAkKHRoaXMpLmF0dHIoJ2hyZWYnKS5zcGxpdCgnLScpWzFdICk7XG4gICAgXHRcdH0pO1xuXG5cdFx0XHQkKCcuZGVjcmVhc2UtY2FydC10cmlnZ2VyJykub24oJ2NsaWNrJywgZnVuY3Rpb24oZSl7XG4gICAgXHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIFx0XHRcdCQuY2FydC5kZWNyZWFzZSggJCh0aGlzKS5hdHRyKCdocmVmJykuc3BsaXQoJy0nKVsxXSApO1xuICAgIFx0XHR9KTtcbiAgICBcdH0sXG4gICAgXHRpbml0UmVtb3ZlOiBmdW5jdGlvbigpXG4gICAgXHR7XG4gICAgXHRcdCQoJy5yZW1vdmUtY2FydC10cmlnZ2VyJykub24oJ2NsaWNrJywgZnVuY3Rpb24oZSl7XG4gICAgXHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIFx0XHRcdCQuY2FydC5yZW1vdmVJdGVtKCQodGhpcykuYXR0cignaHJlZicpLnNwbGl0KCctJylbMV0sIHRoaXMpO1xuICAgIFx0XHR9KTtcbiAgICBcdH0sXG4gICAgXHRyZW1vdmVJdGVtOiBmdW5jdGlvbihpZCwgX3NlbGZfKVxuXHRcdHtcblx0XHRcdCQucG9zdCgnL2FqYXgvY2FydC9yZW1vdmUvJywgeyBpdGVtOiBpZCB9LCBmdW5jdGlvbihkYXRhKSB7XG5cdFx0XHRcdGlmKCAkKCcjbGlzdC1pdGVtLScraWQpLmZpbmQoJy5pbmNhcnQnKS5sZW5ndGggPiAwIClcblx0XHRcdFx0e1xuXHRcdFx0XHRcdCQoJyNsaXN0LWl0ZW0tJytpZCkuZmluZCgnLmluY2FydCcpLnJlbW92ZSgpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdFxuXHRcdFx0XHRpZigkKF9zZWxmXykuaGFzQ2xhc3MoJ2xpc3QtaXRlbS1pbmNhcnQnKSlcblx0XHRcdFx0e1xuXHRcdFx0XHRcdCQoX3NlbGZfKS5yZW1vdmUoKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRlbHNlXG5cdFx0XHRcdHtcblx0XHRcdFx0XHQkKCcjaW5jYXJ0LWl0ZW0tJytpZCkuaHRtbCggJzxhIGhyZWY9XCIjaXRlbS0nK2lkKydcIiB0aXRsZT1cItCU0L7QsdCw0LLQuNGC0Ywg0LIg0LrQvtGA0LfQuNC90YNcIiBjbGFzcz1cImJ1dHRvbi1jYXJ0IGFkZC1jYXJ0LXRyaWdnZXJcIj7QmtGD0L/QuNGC0Ywg0LrRgNC10YHQu9C+PC9hPicgKTtcblx0XHRcdFx0XHQkLmNhcnQuaW5pdEJ1eSgpO1xuXHRcdFx0XHR9XG5cblx0XHQgICAgICAgICQuY2FydC5hZGRlZEl0ZW0oJ9Ci0L7QstCw0YAg0YPQtNCw0LvQtdC9INC40Lcg0LrQvtGA0LfQuNC90YsuJyk7XG5cdFx0XHR9KTtcblx0XHR9LFxuXHRcdGJ1eUl0ZW06IGZ1bmN0aW9uKGlkKVxuXHRcdHtcblx0XHRcdHZhciBjb3VudCA9IDE7XG5cdFx0XHRcblx0XHRcdGlmKCAkKCcjY291bnQtJytpZCkubGVuZ3RoID4gMCApIHtcblx0XHRcdFx0Y291bnQgPSBwYXJzZUludCggJCgnI2NvdW50LScraWQpLnZhbCgpICkgO1xuXHRcdFx0fVxuXG5cdFx0XHQkLnBvc3QoJy4uL2NhcnQuanNvbicsIHsgaXRlbTogaWQsIGNvdW50OiBjb3VudCB9LCBmdW5jdGlvbihkYXRhKSB7XG5cdFx0XHRcdGlmKCAkKCcjY2FydC1jb3VudCcpLmxlbmd0aCA+IDAgKVxuXHRcdFx0XHR7XG5cdFx0XHRcdFx0JCgnI2NhcnQtY291bnQnKS5odG1sKCBkYXRhLmNvdW50ICk7XG5cdFx0XHRcdH1cblx0XHRcdFx0XG5cdFx0XHRcdGlmKCAkKCcjY2FydC1wcmljZScpLmxlbmd0aCA+IDAgKVxuXHRcdFx0XHR7XG5cdFx0XHRcdFx0JCgnI2NhcnQtcHJpY2UnKS5odG1sKCBkYXRhLm1vbmV5ICk7XG5cdFx0XHRcdH1cblx0XHRcdFx0XG5cdFx0XHRcdGlmKCAkKCcjY291bnQtJytpZCkubGVuZ3RoID4gMCApXG5cdFx0XHRcdHtcblx0XHRcdFx0XHQkKCcjY291bnQtJytpZCkudmFsKDEpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYoICQoJyNsaXN0LWl0ZW0tJytpZCkuZmluZCgnLmluY2FydCcpLmxlbmd0aCA9PSAwICkge1xuXHRcdFx0XHRcdCQoJyNpbmNhcnQtaXRlbS0nK2lkKS5odG1sKCAnPGEgaHJlZj1cIiNpdGVtLScgKyBpZCArICdcIiB0aXRsZT1cItCj0LTQsNC70LjRgtGMINC40Lcg0LrQvtGA0LfQuNC90YtcIiBjbGFzcz1cImJ1dHRvbi1yZW1vdmUgcmVtb3ZlLWNhcnQtdHJpZ2dlclwiPtCa0YDQtdGB0LvQviDQsiDQutC+0YDQt9C40L3QtTwvYT4nICk7XG5cblx0XHRcdFx0XHQkLmNhcnQuaW5pdFJlbW92ZSgpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0JC5jYXJ0LmFkZGVkSXRlbSgpO1xuXHRcdFx0fSwgJ0pTT04nKTtcblx0XHR9LFxuXHRcdGFkZGVkSXRlbTogZnVuY3Rpb24odGV4dCwgbGFyZ2UpXG5cdFx0e1xuXHRcdCAgICB0ZXh0ID0gIXRleHQgPyAn0KLQvtCy0LDRgCDQtNC+0LHQsNCy0LvQtdC9INCyINC60L7RgNC30LjQvdGDLicgOiB0ZXh0IDtcblx0XHQgICAgbGFyZ2UgPSAhbGFyZ2UgPyBmYWxzZSA6IGxhcmdlIDtcblx0XHQgICAgdmFyIHRpbWVvdXQgPSAhbGFyZ2UgPyAxNTAwIDogNTAwMCwgYWRkY2xhc3MgPSAhbGFyZ2UgPyAnJyA6ICcgYWRkaW5nLWxhcmdlJyA7XG5cdFx0ICAgIFxuXHRcdCAgICBpZiggJCgnYm9keScpLmZpbmQoJyNpdGVtLWFkZGVkLXRvLWNhcnQnKS5sZW5ndGggPT0gMCApIHtcblx0XHQgICAgICAgICQoJ2JvZHknKS5hcHBlbmQoJzxkaXYgaWQ9XCJpdGVtLWFkZGVkLXRvLWNhcnRcIiBjbGFzcz1cInNob3dhZGRpbmcnICsgYWRkY2xhc3MgKyAnXCI+PGRpdiBjbGFzcz1cImFkZGluZy1pbm5lclwiPjxkaXYgY2xhc3M9XCJhZGRpbmctY29udGVudFwiPicgKyB0ZXh0ICsgJzwvZGl2PjwvZGl2PjwvZGl2PicpO1xuXHRcdCAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpe1xuXHRcdCAgICAgICAgICAgICQoJ2JvZHknKS5maW5kKCcjaXRlbS1hZGRlZC10by1jYXJ0JykucmVtb3ZlKCkgO1xuXHRcdCAgICAgICAgfSx0aW1lb3V0KTtcblx0XHQgICAgfVxuXHRcdCAgICBlbHNlIHtcblx0XHQgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKXtcblx0XHQgICAgICAgICAgICAkKCdib2R5JykuZmluZCgnI2l0ZW0tYWRkZWQtdG8tY2FydCcpLnJlbW92ZSgpIDtcblx0XHQgICAgICAgIH0sdGltZW91dCk7XG5cdFx0ICAgIH1cblx0XHR9LFxuXHRcdGluY3JlYXNlOiBmdW5jdGlvbihpZClcblx0XHR7XG5cdFx0XHRpZiggJCgnI2NvdW50LScraWQpLmxlbmd0aCA+IDAgKSB7XG5cdFx0ICAgICAgICB2YXIgdmFsdWUgPSBwYXJzZUludCggJCgnI2NvdW50LScraWQpLnZhbCgpICkgO1xuXHRcdCAgICAgICAgICAgIHZhbHVlID0gIXZhbHVlID8gMCA6IHZhbHVlIDtcblx0XHQgICAgICAgICAgICBcblx0XHQgICAgICAgICAgICB2YWx1ZSsrIDtcblx0XHQgICAgICAgICAgICBcblx0XHQgICAgICAgICAgICAkKCcjY291bnQtJytpZCkudmFsKCB2YWx1ZSApIDtcblx0XHQgICAgfVxuXHRcdFx0XG5cdFx0XHRpZigkKCcjY2FydC10YWJsZScpLmxlbmd0aCA+IDApXG5cdFx0XHR7XG5cdFx0XHRcdCQuY2FydC5yZVRvdGFsKGlkKTtcblx0XHRcdH1cblx0XHR9LFxuXHRcdGRlY3JlYXNlOiBmdW5jdGlvbihpZClcblx0XHR7XG5cdFx0XHRpZiggJCgnI2NvdW50LScraWQpLmxlbmd0aCA+IDAgKVxuXHRcdFx0e1xuXHRcdFx0XHR2YXIgdmFsdWUgPSBwYXJzZUludCggJCgnI2NvdW50LScraWQpLnZhbCgpICkgO1xuXHRcdFx0XHRcdHZhbHVlID0gIXZhbHVlID8gMSA6IHZhbHVlIDtcblx0XHRcdFx0XHRcblx0XHRcdFx0XHRpZiggdmFsdWUgPj0gMiApIHZhbHVlLS0gO1xuXHRcdFx0XHRcdGVsc2UgdmFsdWUgPSAxIDtcblx0XHRcdFx0XHRcblx0XHRcdFx0XHQkKCcjY291bnQtJytpZCkudmFsKCB2YWx1ZSApIDtcblx0XHRcdH1cblx0XHRcdFxuXHRcdFx0aWYoJCgnI2NhcnQtdGFibGUnKS5sZW5ndGggPiAwKVxuXHRcdFx0e1xuXHRcdFx0XHQkLmNhcnQucmVUb3RhbChpZCk7XG5cdFx0XHR9XG5cdFx0fSxcblx0XHRyZVRvdGFsOiBmdW5jdGlvbihpZClcblx0XHR7XG5cdFx0XHRpZiggJCgnI2NvdW50LScraWQpLmxlbmd0aCA+IDAgKVxuXHRcdFx0e1xuXHRcdFx0XHR2YXIgY291bnQgPSBwYXJzZUludCggJCgnI2NvdW50LScraWQpLnZhbCgpICk7XG5cdFx0XHRcdFxuXHRcdFx0XHQkLnBvc3QoJy9hamF4L2NhcnQvcmVjb3VudC8nLCB7IGl0ZW06IGlkLCBjb3VudDogY291bnQgfSwgZnVuY3Rpb24oZGF0YSkge1xuXHRcdFx0XHRcdHZhciBwcmljZSA9IHBhcnNlSW50KCAkKCcjY2FydC1pdGVtLXByaWNlLScraWQpLmh0bWwoKSApO1xuXHRcdFx0XHRcdHZhciB0b3RhbCA9IGNvdW50ICogcHJpY2U7XG5cblx0XHRcdFx0XHQkKCcjY2FydC1pdGVtLXRvdGFsLScraWQpLmh0bWwodG90YWwpIDtcblx0XHRcdFx0XHQkKCcjY2FydC10b3RhbC1jb3VudCcpLmh0bWwoZGF0YS5jb3VudCk7XG5cdFx0XHRcdFx0JCgnI2NhcnQtdG90YWwtcHJpY2UnKS5odG1sKGRhdGEubW9uZXkpO1xuXG5cdFx0XHRcdFx0aWYoICQoJyNjYXJ0LWNvdW50JykubGVuZ3RoID4gMCApXG5cdFx0XHRcdFx0e1xuXHRcdFx0XHRcdFx0JCgnI2NhcnQtY291bnQnKS5odG1sKCBkYXRhLmNvdW50ICk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFxuXHRcdFx0XHRcdGlmKCAkKCcjY2FydC1wcmljZScpLmxlbmd0aCA+IDAgKVxuXHRcdFx0XHRcdHtcblx0XHRcdFx0XHRcdCQoJyNjYXJ0LXByaWNlJykuaHRtbCggZGF0YS5tb25leSApO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSwgJ0pTT04nKTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHQkLmNhcnQuaW5pdCgpO1xufSkoalF1ZXJ5KTsiXX0=
