var body = document.body, timer;

window.addEventListener('scroll', function() {
    clearTimeout(timer);
    if(!body.classList.contains('disable-hover'))
    {
        body.classList.add('disable-hover')
    }

    timer = setTimeout(function(){
        body.classList.remove('disable-hover')
    }, 500);
}, false);

// Find, Replace, Case
// i.e "Test to see if this works? (Yes|No)".replaceAll('(Yes|No)', 'Yes!');
// i.e.2 "Test to see if this works? (Yes|No)".replaceAll('(yes|no)', 'Yes!', true);
String.prototype.replaceAll = function(_f, _r, _c){ 
    var o = this.toString();
    var r = '';
    var s = o;
    var b = 0;
    var e = -1;
    if(_c){ _f = _f.toLowerCase(); s = o.toLowerCase(); }

    while((e=s.indexOf(_f)) > -1)
    {
        r += o.substring(b, b+e) + _r;
        s = s.substring(e+_f.length, s.length);
        b += e+_f.length;
    }

    // Add Leftover
    if(s.length>0){ r+=o.substring(o.length-s.length, o.length); }

    // Return New String
    return r;
};

if (!Array.prototype.indexOf) {
    Array.prototype.indexOf = function (searchElement, fromIndex) {
      if ( this === undefined || this === null ) {
        throw new TypeError( '"this" is null or not defined' );
      }

      var length = this.length >>> 0; // Hack to convert object.length to a UInt32

      fromIndex = +fromIndex || 0;

      if (Math.abs(fromIndex) === Infinity) {
        fromIndex = 0;
      }

      if (fromIndex < 0) {
        fromIndex += length;
        if (fromIndex < 0) {
          fromIndex = 0;
        }
      }

      for (;fromIndex < length; fromIndex++) {
        if (this[fromIndex] === searchElement) {
          return fromIndex;
        }
      }

      return -1;
    };
}

// Simple JavaScript Templating
// John Resig - http://ejohn.org/ - MIT Licensed
;(function(){
    var cache = {};

    this.tmpl = function tmpl(str, data){
        // Figure out if we're getting a template, or if we need to
        // load the template - and be sure to cache the result.
        var fn = !/\W/.test(str) ?
            cache[str] = cache[str] ||
                tmpl(document.getElementById(str).innerHTML) :

            // Generate a reusable function that will serve as a template
            // generator (and which will be cached).
            new Function("obj",
                "var p=[],print=function(){p.push.apply(p,arguments);};" +

                    // Introduce the data as local variables using with(){}
                    "with(obj){p.push('" +

                    // Convert the template into pure JavaScript
                    str
                        .replace(/[\r\t\n]/g, " ")
                        .split("<%").join("\t")
                        .replace(/((^|%>)[^\t]*)'/g, "$1\r")
                        .replace(/\t=(.*?)%>/g, "',$1,'")
                        .split("\t").join("');")
                        .split("%>").join("p.push('")
                        .split("\r").join("\\'")
                    + "');}return p.join('');");

        // Provide some basic currying to the user
        return data ? fn( data ) : fn;
    };
})();

(function($) {
    $.app = {
        run: function()
        {
            $.app.module.bear.init();
            $.app.module.form_ajax();
            $.app.module.resize(function(){ }, 500);

            // $('.header-logo').on('click', function(e){
            //     e.preventDefault();
            //     var vh = $(window).height();
                
            //     $('#wrapper-main').find('.wrapper-main').css({ 'height': vh, 'top': -vh });
            //     $('#wrapper-main').find('.wrapper-main').stop().show().animate({ 'top': '0' }, 250, function(){
            //         $('#wrapper-main').addClass('wrapper-main-open');
            //     });
            // });

            $(".integer").on('keypress', function (e) { if( [0, 8].indexOf( e.which ) < 0 && ( e.which < 48 || e.which > 57 ) ) { return false; } });
            
            $('body').on('click', '.toggle-trigger', function(e){
                e.preventDefault();

                var id = $(this).attr('href');
                if( $(id).length > 0 )
                {
                    if( $(this).hasClass('ul_list-item_link-drop') )
                    {
                        $(this).toggleClass('ul_list-item_link-drop-up');
                    }

                    $(id).slideToggle(150);
                    $('html, body').animate({ scrollTop: $(this).offset().top }, 'slow');
                }
            });

            if( typeof $.initPopups !== 'undefined' )
            {
                $.initPopups();

                if(window.location.hash.length > 1 && $(window.location.hash).hasClass('popup') )
                {
                    try {
                        $.popup.open(window.location.hash.substr(1));
                    }
                    catch(e) {}
                }
            }
        },
        module: {
            bear: {
                timeout: 20000,
                element: '#bear',
                move: function(_go_)
                {
                    var _self_ = this, timeout = _self_.timeout;
                    _go_ = window.innerWidth - _go_ - 298;
                    
                    if(_go_ > window.innerWidth)
                    {
                        _go_ = window.innerWidth;
                    }

                    if(typeof($.cookie('_go_')) !== 'undefined')
                    {
                        _go_ = $.cookie('_go_');
                    }

                    $.cookie('_go_', _go_, { expires: 7, path: '/' });

                    if(typeof($.cookie('coordinate')) !== 'undefined' && $.cookie('coordinate') !== '')
                    {
                        var coord = Math.floor($.cookie('coordinate'));
                        
                        $(_self_.element).css({ 'left': coord });

                        var percent = 100 - Math.floor(((window.innerWidth - coord) * 100) / window.innerWidth);
                        var timeout = timeout - ( timeout * percent / 100);
                    }
                   
                    $(_self_.element).stop().animate({ left: _go_ }, { duration: timeout, step: function(now, fx) {
                        
                        $.cookie('coordinate', now, { expires: 7, path: '/' });

                        if(now == _go_)
                        {
                            $(_self_.element).toggleClass('footer-bear-reverse');

                            $.removeCookie('coordinate', { path: '/' });
                            $.removeCookie('_go_', { path: '/' });

                            $.app.module.bear.move(_go_);
                        }
                    }});
                },
                rotate: function( deg )
                {
                    $(this.element).find('.footer-bear-inner').stop().animate({ rotation: deg }, { duration: 1800, step: function(now, fx) {
                        $(this).css({"transform": "rotate("+now+"deg)"});
                        if(now == deg)
                        {
                            $.app.module.bear.rotate((deg*-1));
                        }
                    }});
                },
                init: function()
                {
                    this.rotate(6);
                    this.move(0);
                }
            },
            resize: function( callback, time )
            {
                $(window).resize(function(e){
                    window.resizeEvt;
                    $(window).resize(function(){
                    clearTimeout(window.resizeEvt);
                        window.resizeEvt = setTimeout(function(){
                            callback.apply();
                        }, time);
                    });
                });
            },
            googleMap: function()
            {
                var mapOptions = {
                    zoom: 16,
                    zoomControl: !0,
                    zoomControlOptions: {
                        style: google.maps.ZoomControlStyle.LARGE,
                        position: google.maps.ControlPosition.LEFT_TOP
                    },
                    panControl: !0,
                    panControlOptions: {
                        position: google.maps.ControlPosition.LEFT_TOP
                    },
                    scrollwheel: !1,
                    navigationControl: !1,
                    mapTypeControl: !1,
                    scaleControl: !1,
                    draggable: !0,
                    styles: [
                        {
                            stylers: [
                                { hue: '#adced5' }
                            ]
                        },
                        {
                            elementType: 'labels',
                            stylers: [
                                { visibility: 'on' }
                            ]
                        },
                        {
                            featureType: 'water',
                            stylers: [
                                { color: '#c9dfe4' }
                            ]
                        }
                    ],
                    disableDoubleClickZoom: !0,
                    center: new google.maps.LatLng(43.569787, 39.756362)
                };

                var map = new google.maps.Map(document.getElementById( 'map-conteiner' ), mapOptions);
                
                var bullet = {
                    url: 'images/map-bullet.png',
                    size: new google.maps.Size(39, 52),
                    origin: new google.maps.Point(0,0),
                    anchor: new google.maps.Point(39, 52)
                };
                
                new google.maps.Marker({
                    position: new google.maps.LatLng(43.569787, 39.756362),
                    map: map,
                    icon: bullet
                });
            },
            cache: function( s, cb )
            {
                try {
                    var a, g = [], i, x, cnt = s.length, p = { i: {}, ac: 0, c: 0 }, cb = cb || function(){};
                    
                    function y( index, src )
                    {
                        g.push( src );
                        
                        if( g.length >= cnt )
                        {
                            cb.call();
                        }
                        
                        p.c++
                    }

                    for (x in s)
                    {
                        a = s[x];
                        
                        i = new Image();
                        i.src = a;

                        i.onload = y( x, a );

                        p.i[a] = i;
                        p.ac++
                    }
                }
                catch(e) {}
            },
            retina: function()
            {
                if( 'devicePixelRatio' in window && window.devicePixelRatio == 2 )
                {
                    var i=0, src, img = $( 'img.replace-2x' ).get(), l = img.length;
                    for (i; i<l; i++)
                    {
                        src = img[i].src;
                        src = src.replace(/\.(png|jpg|gif)+$/i, '@2x.$1');
                        img[i].src = src;
                    }
                }
            },
            isUndefined: function( obj )
            {
                return obj === void 0;
            },
            updateImage: function(element)
            {
                if( $(element).length > 0 ) {
                    var image = $(element).attr('src').split( '?' )[0] ;
                    $(element).attr('src', image + '?v=' + Math.random() );
                }
                return false;
            },
            random: function(min, max)
            {
                min = min || 0 ;
                max = max || 100 ;
                return Math.floor(Math.random() * ( max - min + 1 )) + min ;
            }
        }
    };

    $.app.movies = {};
    $.app.movies.load = function() {
        alert( 'load more' );
        return false;
    };

    $.app.module.form_validation_default = function($form, errors) {
        $form.find('.form_error_block').hide();
        $form.find('.error').removeClass('error');
        $form.find('.checkbox__label-error').removeClass('checkbox__label-error');
        if(errors) {
            var $error_block = $('#form-errors');
            $error_block.html('');

            for(fieldName in errors)
            {
                $field = $form.find('input[name="'+fieldName+'"]');
                $error_block.append(
                    [
                        '<span>',
                        $field.data('error'),
                        '</span>'
                    ].join('')
                );
            }
        }
    };

    $.app.callback_stack = {};
    $.app.callback_stack.form_ajax_default = function($form, response) {
        if(response.status) {
            if(response.hasOwnProperty('redirect_url')) {
                window.location.href = response.redirect_url;
            }
        }
        else if(response.errors) {
            $.app.module.form_validation_default($form, response.errors);
        }
        
        if(response.hasOwnProperty('message')) {
            $.popup.message(response.title, response.message);
        }
    };

    $.app.module.form_ajax = function() {
        $('body').on('submit' ,'.form-ajax', function(e) {
            var $form = $(this);
            e.preventDefault();
            
            $.ajax({
                url: $form.attr('action'),
                type: ($form.attr('method') || 'post'),
                data: $form.serialize(),
                dataType: 'json',
                success: function(response)
                {
                    if($form.data('callback') && $.app.callback_stack.hasOwnProperty($form.data('callback'))) {
                        $.app.callback_stack[$form.data('callback')]($form, response);
                    }
                    else {
                        $.app.callback_stack.form_ajax_default($form, response);
                    }

                    if( response.status === true && response.message !== '' )
                    {
                        $.popup.message( response.title, response.message );
                    }
                },
                error: function(response)
                {
                    $.app.callback_stack.form_ajax_default($form, response);
                    alert("error");
                }
            });
        });
    };

    $.app.module.upload_button = function(){
        $('body').on('submit' ,'.form-file-upload', function(e) {
            return AIM.submit(this, {
                onStart: function()
                {

                },
                onComplete: function( result )
                {
                    if( typeof result === 'object' && result.status === true && typeof result.photo_url !== 'undefined' )
                    { }
                }
            });
        });
        
        $(document).on('change', '.upload_button_onchange', function(){
            if( $(this).closest('.upload_button').find('.upload_button_field').length > 0 )
            {
                $(this).closest('.upload_button').find('.upload_button_field').html( $(this).val() );
            }
        });
    };

    $.app.custom_placeholder = function() {
        if (Modernizr.touch) {
            return;
        }

        $('input, textarea').each(function() {
            var $input = $(this), $inputWrapper, $placeholder, placeholderText = $input.attr('placeholder');
            if(placeholderText) {
                $inputWrapper = $input.parent();
                $placeholder = $('<div class="default-input__placeholder" style="line-height: '+($input.is('textarea') ? '36px' : ( $inputWrapper.innerHeight() == 0 ? '36' : $inputWrapper.innerHeight() )+'px')+'">'+placeholderText+'</div>');
                $placeholder[$input.val().length ? 'hide' : 'show']();
                $input.addClass('custom-placeholder').attr('placeholder', '');
                $inputWrapper.append($placeholder);
            }
        });
        
        $('body').on('blur', '.custom-placeholder', function() {
            var $this = $(this);
            if(!$this.val().length) {
                $this.parent().find('.default-input__placeholder').show();
            }
        });
        $('body').on('focus', '.custom-placeholder', function() {
            $(this).parent().find('.default-input__placeholder').hide();
        });

        $('body').on('click', '.default-input__placeholder', function() {
            var $this = $(this);
    
            $this.hide();
            $this.parent().find('.custom-placeholder').trigger('focus');
        });
        $('body').on('selectstart', '.default-input__placeholder', false);
    };

    $.app.run();
})(jQuery);
;(function($) {
    $.cart = {
        initRequestClick: function()
        {
            $('body').on('click', '.j-remover-request', function(e){
                e.preventDefault();

                var $remover = $(this).closest('.remover'), product = $(this).data('element'), status = $(this).data('status');

                if (status !== 0)
                {
                    if ($('#cart-product-'+product).length)
                    {
                        $('#cart-product-'+product).fadeOut(function(){
                            $(this).remove();
                        });
                    }

                    console.log(product + ' as ' + status);
                }
                
                setTimeout(function(){
                    $remover.fadeOut(function(){
                        $(this).remove();
                    });
                }, 150);

                return !1;
            });
        },

    	init: function()
    	{
    		$.cart.initBuy();
    		$.cart.initRemove();
    		$.cart.initControll();

            $.cart.initRequestClick();

            $('body').on('click', '.j-cart-remove', function(e){
                e.preventDefault();

                if (!$(this).closest('.list-item-footer').find('.remover').length)
                {
                    var $remover, product = $(this).data('element');

                    $remover = [
                        '<div class="remover">',
                            '<div class="remover__content">',
                                '<div class="remover__title">',
                                    'Действительно удалить?',
                                '</div>',

                                '<div class="remover__buttons">',
                                    '<a href="#" data-element="' + product + '" data-status="1" class="remover__button is-yes j-remover-request">Да</a>',
                                    '<a href="#" data-element="' + product + '" data-status="0" class="remover__button is-no j-remover-request">Нет</a>',
                                '</div>',
                            '</div>',
                        '</div>'
                    ].join(' ');
                    
                    $(this).closest('.list-item-footer').append($remover);
                }
                else
                {
                    var $remover = $(this).closest('.list-item-footer').find('.remover');

                    $remover.fadeOut(function(){
                        $(this).remove();
                    });
                }

                return !1;
            });
    	},

    	initBuy: function()
    	{
    		$('.add-cart-trigger').on('click', function(e){
    			e.preventDefault();
    			$.cart.buyItem( $(this).attr('href').split('-')[1] );
    		});
    	},
    	initControll: function()
    	{
    		$('.increase-cart-trigger').on('click', function(e){
    			e.preventDefault();
    			$.cart.increase( $(this).attr('href').split('-')[1] );
    		});

			$('.decrease-cart-trigger').on('click', function(e){
    			e.preventDefault();
    			$.cart.decrease( $(this).attr('href').split('-')[1] );
    		});
    	},
    	initRemove: function()
    	{
    		$('.remove-cart-trigger').on('click', function(e){
    			e.preventDefault();
    			$.cart.removeItem($(this).attr('href').split('-')[1], this);
    		});
    	},
    	removeItem: function(id, _self_)
		{
			$.post('/ajax/cart/remove/', { item: id }, function(data) {
				if( $('#list-item-'+id).find('.incart').length > 0 )
				{
					$('#list-item-'+id).find('.incart').remove();
				}
				
				if($(_self_).hasClass('list-item-incart'))
				{
					$(_self_).remove();
				}
				else
				{
					$('#incart-item-'+id).html( '<a href="#item-'+id+'" title="Добавить в корзину" class="button-cart add-cart-trigger">Купить кресло</a>' );
					$.cart.initBuy();
				}

		        $.cart.addedItem('Товар удален из корзины.');
			});
		},
		buyItem: function(id)
		{
			var count = 1;
			
			if( $('#count-'+id).length > 0 ) {
				count = parseInt( $('#count-'+id).val() ) ;
			}

			$.post('../cart.json', { item: id, count: count }, function(data) {
				if( $('#cart-count').length > 0 )
				{
					$('#cart-count').html( data.count );
				}
				
				if( $('#cart-price').length > 0 )
				{
					$('#cart-price').html( data.money );
				}
				
				if( $('#count-'+id).length > 0 )
				{
					$('#count-'+id).val(1);
				}

				if( $('#list-item-'+id).find('.incart').length == 0 ) {
					$('#incart-item-'+id).html( '<a href="#item-' + id + '" title="Удалить из корзины" class="button-remove remove-cart-trigger">Кресло в корзине</a>' );

					$.cart.initRemove();
				}

				$.cart.addedItem();
			}, 'JSON');
		},
		addedItem: function(text, large)
		{
		    text = !text ? 'Товар добавлен в корзину.' : text ;
		    large = !large ? false : large ;
		    var timeout = !large ? 1500 : 5000, addclass = !large ? '' : ' adding-large' ;
		    
		    if( $('body').find('#item-added-to-cart').length == 0 ) {
		        $('body').append('<div id="item-added-to-cart" class="showadding' + addclass + '"><div class="adding-inner"><div class="adding-content">' + text + '</div></div></div>');
		        setTimeout(function(){
		            $('body').find('#item-added-to-cart').remove() ;
		        },timeout);
		    }
		    else {
		        setTimeout(function(){
		            $('body').find('#item-added-to-cart').remove() ;
		        },timeout);
		    }
		},
		increase: function(id)
		{
			if( $('#count-'+id).length > 0 ) {
		        var value = parseInt( $('#count-'+id).val() ) ;
		            value = !value ? 0 : value ;
		            
		            value++ ;
		            
		            $('#count-'+id).val( value ) ;
		    }
			
			if($('#cart-table').length > 0)
			{
				$.cart.reTotal(id);
			}
		},
		decrease: function(id)
		{
			if( $('#count-'+id).length > 0 )
			{
				var value = parseInt( $('#count-'+id).val() ) ;
					value = !value ? 1 : value ;
					
					if( value >= 2 ) value-- ;
					else value = 1 ;
					
					$('#count-'+id).val( value ) ;
			}
			
			if($('#cart-table').length > 0)
			{
				$.cart.reTotal(id);
			}
		},
		reTotal: function(id)
		{
			if( $('#count-'+id).length > 0 )
			{
				var count = parseInt( $('#count-'+id).val() );
				
				$.post('/ajax/cart/recount/', { item: id, count: count }, function(data) {
					var price = parseInt( $('#cart-item-price-'+id).html() );
					var total = count * price;

					$('#cart-item-total-'+id).html(total) ;
					$('#cart-total-count').html(data.count);
					$('#cart-total-price').html(data.money);

					if( $('#cart-count').length > 0 )
					{
						$('#cart-count').html( data.count );
					}
					
					if( $('#cart-price').length > 0 )
					{
						$('#cart-price').html( data.money );
					}
				}, 'JSON');
			}
		}
	}

	$.cart.init();
})(jQuery);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIl9fYXBwLmpzIiwiX2NhcnQuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3ZlQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJhcHAubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsidmFyIGJvZHkgPSBkb2N1bWVudC5ib2R5LCB0aW1lcjtcblxud2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Njcm9sbCcsIGZ1bmN0aW9uKCkge1xuICAgIGNsZWFyVGltZW91dCh0aW1lcik7XG4gICAgaWYoIWJvZHkuY2xhc3NMaXN0LmNvbnRhaW5zKCdkaXNhYmxlLWhvdmVyJykpXG4gICAge1xuICAgICAgICBib2R5LmNsYXNzTGlzdC5hZGQoJ2Rpc2FibGUtaG92ZXInKVxuICAgIH1cblxuICAgIHRpbWVyID0gc2V0VGltZW91dChmdW5jdGlvbigpe1xuICAgICAgICBib2R5LmNsYXNzTGlzdC5yZW1vdmUoJ2Rpc2FibGUtaG92ZXInKVxuICAgIH0sIDUwMCk7XG59LCBmYWxzZSk7XG5cbi8vIEZpbmQsIFJlcGxhY2UsIENhc2Vcbi8vIGkuZSBcIlRlc3QgdG8gc2VlIGlmIHRoaXMgd29ya3M/IChZZXN8Tm8pXCIucmVwbGFjZUFsbCgnKFllc3xObyknLCAnWWVzIScpO1xuLy8gaS5lLjIgXCJUZXN0IHRvIHNlZSBpZiB0aGlzIHdvcmtzPyAoWWVzfE5vKVwiLnJlcGxhY2VBbGwoJyh5ZXN8bm8pJywgJ1llcyEnLCB0cnVlKTtcblN0cmluZy5wcm90b3R5cGUucmVwbGFjZUFsbCA9IGZ1bmN0aW9uKF9mLCBfciwgX2MpeyBcbiAgICB2YXIgbyA9IHRoaXMudG9TdHJpbmcoKTtcbiAgICB2YXIgciA9ICcnO1xuICAgIHZhciBzID0gbztcbiAgICB2YXIgYiA9IDA7XG4gICAgdmFyIGUgPSAtMTtcbiAgICBpZihfYyl7IF9mID0gX2YudG9Mb3dlckNhc2UoKTsgcyA9IG8udG9Mb3dlckNhc2UoKTsgfVxuXG4gICAgd2hpbGUoKGU9cy5pbmRleE9mKF9mKSkgPiAtMSlcbiAgICB7XG4gICAgICAgIHIgKz0gby5zdWJzdHJpbmcoYiwgYitlKSArIF9yO1xuICAgICAgICBzID0gcy5zdWJzdHJpbmcoZStfZi5sZW5ndGgsIHMubGVuZ3RoKTtcbiAgICAgICAgYiArPSBlK19mLmxlbmd0aDtcbiAgICB9XG5cbiAgICAvLyBBZGQgTGVmdG92ZXJcbiAgICBpZihzLmxlbmd0aD4wKXsgcis9by5zdWJzdHJpbmcoby5sZW5ndGgtcy5sZW5ndGgsIG8ubGVuZ3RoKTsgfVxuXG4gICAgLy8gUmV0dXJuIE5ldyBTdHJpbmdcbiAgICByZXR1cm4gcjtcbn07XG5cbmlmICghQXJyYXkucHJvdG90eXBlLmluZGV4T2YpIHtcbiAgICBBcnJheS5wcm90b3R5cGUuaW5kZXhPZiA9IGZ1bmN0aW9uIChzZWFyY2hFbGVtZW50LCBmcm9tSW5kZXgpIHtcbiAgICAgIGlmICggdGhpcyA9PT0gdW5kZWZpbmVkIHx8IHRoaXMgPT09IG51bGwgKSB7XG4gICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoICdcInRoaXNcIiBpcyBudWxsIG9yIG5vdCBkZWZpbmVkJyApO1xuICAgICAgfVxuXG4gICAgICB2YXIgbGVuZ3RoID0gdGhpcy5sZW5ndGggPj4+IDA7IC8vIEhhY2sgdG8gY29udmVydCBvYmplY3QubGVuZ3RoIHRvIGEgVUludDMyXG5cbiAgICAgIGZyb21JbmRleCA9ICtmcm9tSW5kZXggfHwgMDtcblxuICAgICAgaWYgKE1hdGguYWJzKGZyb21JbmRleCkgPT09IEluZmluaXR5KSB7XG4gICAgICAgIGZyb21JbmRleCA9IDA7XG4gICAgICB9XG5cbiAgICAgIGlmIChmcm9tSW5kZXggPCAwKSB7XG4gICAgICAgIGZyb21JbmRleCArPSBsZW5ndGg7XG4gICAgICAgIGlmIChmcm9tSW5kZXggPCAwKSB7XG4gICAgICAgICAgZnJvbUluZGV4ID0gMDtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBmb3IgKDtmcm9tSW5kZXggPCBsZW5ndGg7IGZyb21JbmRleCsrKSB7XG4gICAgICAgIGlmICh0aGlzW2Zyb21JbmRleF0gPT09IHNlYXJjaEVsZW1lbnQpIHtcbiAgICAgICAgICByZXR1cm4gZnJvbUluZGV4O1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHJldHVybiAtMTtcbiAgICB9O1xufVxuXG4vLyBTaW1wbGUgSmF2YVNjcmlwdCBUZW1wbGF0aW5nXG4vLyBKb2huIFJlc2lnIC0gaHR0cDovL2Vqb2huLm9yZy8gLSBNSVQgTGljZW5zZWRcbjsoZnVuY3Rpb24oKXtcbiAgICB2YXIgY2FjaGUgPSB7fTtcblxuICAgIHRoaXMudG1wbCA9IGZ1bmN0aW9uIHRtcGwoc3RyLCBkYXRhKXtcbiAgICAgICAgLy8gRmlndXJlIG91dCBpZiB3ZSdyZSBnZXR0aW5nIGEgdGVtcGxhdGUsIG9yIGlmIHdlIG5lZWQgdG9cbiAgICAgICAgLy8gbG9hZCB0aGUgdGVtcGxhdGUgLSBhbmQgYmUgc3VyZSB0byBjYWNoZSB0aGUgcmVzdWx0LlxuICAgICAgICB2YXIgZm4gPSAhL1xcVy8udGVzdChzdHIpID9cbiAgICAgICAgICAgIGNhY2hlW3N0cl0gPSBjYWNoZVtzdHJdIHx8XG4gICAgICAgICAgICAgICAgdG1wbChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChzdHIpLmlubmVySFRNTCkgOlxuXG4gICAgICAgICAgICAvLyBHZW5lcmF0ZSBhIHJldXNhYmxlIGZ1bmN0aW9uIHRoYXQgd2lsbCBzZXJ2ZSBhcyBhIHRlbXBsYXRlXG4gICAgICAgICAgICAvLyBnZW5lcmF0b3IgKGFuZCB3aGljaCB3aWxsIGJlIGNhY2hlZCkuXG4gICAgICAgICAgICBuZXcgRnVuY3Rpb24oXCJvYmpcIixcbiAgICAgICAgICAgICAgICBcInZhciBwPVtdLHByaW50PWZ1bmN0aW9uKCl7cC5wdXNoLmFwcGx5KHAsYXJndW1lbnRzKTt9O1wiICtcblxuICAgICAgICAgICAgICAgICAgICAvLyBJbnRyb2R1Y2UgdGhlIGRhdGEgYXMgbG9jYWwgdmFyaWFibGVzIHVzaW5nIHdpdGgoKXt9XG4gICAgICAgICAgICAgICAgICAgIFwid2l0aChvYmope3AucHVzaCgnXCIgK1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIENvbnZlcnQgdGhlIHRlbXBsYXRlIGludG8gcHVyZSBKYXZhU2NyaXB0XG4gICAgICAgICAgICAgICAgICAgIHN0clxuICAgICAgICAgICAgICAgICAgICAgICAgLnJlcGxhY2UoL1tcXHJcXHRcXG5dL2csIFwiIFwiKVxuICAgICAgICAgICAgICAgICAgICAgICAgLnNwbGl0KFwiPCVcIikuam9pbihcIlxcdFwiKVxuICAgICAgICAgICAgICAgICAgICAgICAgLnJlcGxhY2UoLygoXnwlPilbXlxcdF0qKScvZywgXCIkMVxcclwiKVxuICAgICAgICAgICAgICAgICAgICAgICAgLnJlcGxhY2UoL1xcdD0oLio/KSU+L2csIFwiJywkMSwnXCIpXG4gICAgICAgICAgICAgICAgICAgICAgICAuc3BsaXQoXCJcXHRcIikuam9pbihcIicpO1wiKVxuICAgICAgICAgICAgICAgICAgICAgICAgLnNwbGl0KFwiJT5cIikuam9pbihcInAucHVzaCgnXCIpXG4gICAgICAgICAgICAgICAgICAgICAgICAuc3BsaXQoXCJcXHJcIikuam9pbihcIlxcXFwnXCIpXG4gICAgICAgICAgICAgICAgICAgICsgXCInKTt9cmV0dXJuIHAuam9pbignJyk7XCIpO1xuXG4gICAgICAgIC8vIFByb3ZpZGUgc29tZSBiYXNpYyBjdXJyeWluZyB0byB0aGUgdXNlclxuICAgICAgICByZXR1cm4gZGF0YSA/IGZuKCBkYXRhICkgOiBmbjtcbiAgICB9O1xufSkoKTtcblxuKGZ1bmN0aW9uKCQpIHtcbiAgICAkLmFwcCA9IHtcbiAgICAgICAgcnVuOiBmdW5jdGlvbigpXG4gICAgICAgIHtcbiAgICAgICAgICAgICQuYXBwLm1vZHVsZS5iZWFyLmluaXQoKTtcbiAgICAgICAgICAgICQuYXBwLm1vZHVsZS5mb3JtX2FqYXgoKTtcbiAgICAgICAgICAgICQuYXBwLm1vZHVsZS5yZXNpemUoZnVuY3Rpb24oKXsgfSwgNTAwKTtcblxuICAgICAgICAgICAgLy8gJCgnLmhlYWRlci1sb2dvJykub24oJ2NsaWNrJywgZnVuY3Rpb24oZSl7XG4gICAgICAgICAgICAvLyAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgLy8gICAgIHZhciB2aCA9ICQod2luZG93KS5oZWlnaHQoKTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgIC8vICAgICAkKCcjd3JhcHBlci1tYWluJykuZmluZCgnLndyYXBwZXItbWFpbicpLmNzcyh7ICdoZWlnaHQnOiB2aCwgJ3RvcCc6IC12aCB9KTtcbiAgICAgICAgICAgIC8vICAgICAkKCcjd3JhcHBlci1tYWluJykuZmluZCgnLndyYXBwZXItbWFpbicpLnN0b3AoKS5zaG93KCkuYW5pbWF0ZSh7ICd0b3AnOiAnMCcgfSwgMjUwLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgLy8gICAgICAgICAkKCcjd3JhcHBlci1tYWluJykuYWRkQ2xhc3MoJ3dyYXBwZXItbWFpbi1vcGVuJyk7XG4gICAgICAgICAgICAvLyAgICAgfSk7XG4gICAgICAgICAgICAvLyB9KTtcblxuICAgICAgICAgICAgJChcIi5pbnRlZ2VyXCIpLm9uKCdrZXlwcmVzcycsIGZ1bmN0aW9uIChlKSB7IGlmKCBbMCwgOF0uaW5kZXhPZiggZS53aGljaCApIDwgMCAmJiAoIGUud2hpY2ggPCA0OCB8fCBlLndoaWNoID4gNTcgKSApIHsgcmV0dXJuIGZhbHNlOyB9IH0pO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAkKCdib2R5Jykub24oJ2NsaWNrJywgJy50b2dnbGUtdHJpZ2dlcicsIGZ1bmN0aW9uKGUpe1xuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcblxuICAgICAgICAgICAgICAgIHZhciBpZCA9ICQodGhpcykuYXR0cignaHJlZicpO1xuICAgICAgICAgICAgICAgIGlmKCAkKGlkKS5sZW5ndGggPiAwIClcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIGlmKCAkKHRoaXMpLmhhc0NsYXNzKCd1bF9saXN0LWl0ZW1fbGluay1kcm9wJykgKVxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLnRvZ2dsZUNsYXNzKCd1bF9saXN0LWl0ZW1fbGluay1kcm9wLXVwJyk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAkKGlkKS5zbGlkZVRvZ2dsZSgxNTApO1xuICAgICAgICAgICAgICAgICAgICAkKCdodG1sLCBib2R5JykuYW5pbWF0ZSh7IHNjcm9sbFRvcDogJCh0aGlzKS5vZmZzZXQoKS50b3AgfSwgJ3Nsb3cnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaWYoIHR5cGVvZiAkLmluaXRQb3B1cHMgIT09ICd1bmRlZmluZWQnIClcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAkLmluaXRQb3B1cHMoKTtcblxuICAgICAgICAgICAgICAgIGlmKHdpbmRvdy5sb2NhdGlvbi5oYXNoLmxlbmd0aCA+IDEgJiYgJCh3aW5kb3cubG9jYXRpb24uaGFzaCkuaGFzQ2xhc3MoJ3BvcHVwJykgKVxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICQucG9wdXAub3Blbih3aW5kb3cubG9jYXRpb24uaGFzaC5zdWJzdHIoMSkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGNhdGNoKGUpIHt9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBtb2R1bGU6IHtcbiAgICAgICAgICAgIGJlYXI6IHtcbiAgICAgICAgICAgICAgICB0aW1lb3V0OiAyMDAwMCxcbiAgICAgICAgICAgICAgICBlbGVtZW50OiAnI2JlYXInLFxuICAgICAgICAgICAgICAgIG1vdmU6IGZ1bmN0aW9uKF9nb18pXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICB2YXIgX3NlbGZfID0gdGhpcywgdGltZW91dCA9IF9zZWxmXy50aW1lb3V0O1xuICAgICAgICAgICAgICAgICAgICBfZ29fID0gd2luZG93LmlubmVyV2lkdGggLSBfZ29fIC0gMjk4O1xuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgaWYoX2dvXyA+IHdpbmRvdy5pbm5lcldpZHRoKVxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICBfZ29fID0gd2luZG93LmlubmVyV2lkdGg7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBpZih0eXBlb2YoJC5jb29raWUoJ19nb18nKSkgIT09ICd1bmRlZmluZWQnKVxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICBfZ29fID0gJC5jb29raWUoJ19nb18nKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICQuY29va2llKCdfZ29fJywgX2dvXywgeyBleHBpcmVzOiA3LCBwYXRoOiAnLycgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYodHlwZW9mKCQuY29va2llKCdjb29yZGluYXRlJykpICE9PSAndW5kZWZpbmVkJyAmJiAkLmNvb2tpZSgnY29vcmRpbmF0ZScpICE9PSAnJylcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvb3JkID0gTWF0aC5mbG9vcigkLmNvb2tpZSgnY29vcmRpbmF0ZScpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgJChfc2VsZl8uZWxlbWVudCkuY3NzKHsgJ2xlZnQnOiBjb29yZCB9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBlcmNlbnQgPSAxMDAgLSBNYXRoLmZsb29yKCgod2luZG93LmlubmVyV2lkdGggLSBjb29yZCkgKiAxMDApIC8gd2luZG93LmlubmVyV2lkdGgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRpbWVvdXQgPSB0aW1lb3V0IC0gKCB0aW1lb3V0ICogcGVyY2VudCAvIDEwMCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgJChfc2VsZl8uZWxlbWVudCkuc3RvcCgpLmFuaW1hdGUoeyBsZWZ0OiBfZ29fIH0sIHsgZHVyYXRpb246IHRpbWVvdXQsIHN0ZXA6IGZ1bmN0aW9uKG5vdywgZngpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgJC5jb29raWUoJ2Nvb3JkaW5hdGUnLCBub3csIHsgZXhwaXJlczogNywgcGF0aDogJy8nIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZihub3cgPT0gX2dvXylcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKF9zZWxmXy5lbGVtZW50KS50b2dnbGVDbGFzcygnZm9vdGVyLWJlYXItcmV2ZXJzZScpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJC5yZW1vdmVDb29raWUoJ2Nvb3JkaW5hdGUnLCB7IHBhdGg6ICcvJyB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkLnJlbW92ZUNvb2tpZSgnX2dvXycsIHsgcGF0aDogJy8nIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJC5hcHAubW9kdWxlLmJlYXIubW92ZShfZ29fKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfX0pO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgcm90YXRlOiBmdW5jdGlvbiggZGVnIClcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICQodGhpcy5lbGVtZW50KS5maW5kKCcuZm9vdGVyLWJlYXItaW5uZXInKS5zdG9wKCkuYW5pbWF0ZSh7IHJvdGF0aW9uOiBkZWcgfSwgeyBkdXJhdGlvbjogMTgwMCwgc3RlcDogZnVuY3Rpb24obm93LCBmeCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5jc3Moe1widHJhbnNmb3JtXCI6IFwicm90YXRlKFwiK25vdytcImRlZylcIn0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYobm93ID09IGRlZylcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkLmFwcC5tb2R1bGUuYmVhci5yb3RhdGUoKGRlZyotMSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9fSk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBpbml0OiBmdW5jdGlvbigpXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnJvdGF0ZSg2KTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5tb3ZlKDApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByZXNpemU6IGZ1bmN0aW9uKCBjYWxsYmFjaywgdGltZSApXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgJCh3aW5kb3cpLnJlc2l6ZShmdW5jdGlvbihlKXtcbiAgICAgICAgICAgICAgICAgICAgd2luZG93LnJlc2l6ZUV2dDtcbiAgICAgICAgICAgICAgICAgICAgJCh3aW5kb3cpLnJlc2l6ZShmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQod2luZG93LnJlc2l6ZUV2dCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cucmVzaXplRXZ0ID0gc2V0VGltZW91dChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrLmFwcGx5KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9LCB0aW1lKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ29vZ2xlTWFwOiBmdW5jdGlvbigpXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgdmFyIG1hcE9wdGlvbnMgPSB7XG4gICAgICAgICAgICAgICAgICAgIHpvb206IDE2LFxuICAgICAgICAgICAgICAgICAgICB6b29tQ29udHJvbDogITAsXG4gICAgICAgICAgICAgICAgICAgIHpvb21Db250cm9sT3B0aW9uczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgc3R5bGU6IGdvb2dsZS5tYXBzLlpvb21Db250cm9sU3R5bGUuTEFSR0UsXG4gICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogZ29vZ2xlLm1hcHMuQ29udHJvbFBvc2l0aW9uLkxFRlRfVE9QXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHBhbkNvbnRyb2w6ICEwLFxuICAgICAgICAgICAgICAgICAgICBwYW5Db250cm9sT3B0aW9uczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246IGdvb2dsZS5tYXBzLkNvbnRyb2xQb3NpdGlvbi5MRUZUX1RPUFxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBzY3JvbGx3aGVlbDogITEsXG4gICAgICAgICAgICAgICAgICAgIG5hdmlnYXRpb25Db250cm9sOiAhMSxcbiAgICAgICAgICAgICAgICAgICAgbWFwVHlwZUNvbnRyb2w6ICExLFxuICAgICAgICAgICAgICAgICAgICBzY2FsZUNvbnRyb2w6ICExLFxuICAgICAgICAgICAgICAgICAgICBkcmFnZ2FibGU6ICEwLFxuICAgICAgICAgICAgICAgICAgICBzdHlsZXM6IFtcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHlsZXJzOiBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgaHVlOiAnI2FkY2VkNScgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudFR5cGU6ICdsYWJlbHMnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0eWxlcnM6IFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeyB2aXNpYmlsaXR5OiAnb24nIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBdXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZlYXR1cmVUeXBlOiAnd2F0ZXInLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0eWxlcnM6IFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeyBjb2xvcjogJyNjOWRmZTQnIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBdXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgICAgIGRpc2FibGVEb3VibGVDbGlja1pvb206ICEwLFxuICAgICAgICAgICAgICAgICAgICBjZW50ZXI6IG5ldyBnb29nbGUubWFwcy5MYXRMbmcoNDMuNTY5Nzg3LCAzOS43NTYzNjIpXG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIHZhciBtYXAgPSBuZXcgZ29vZ2xlLm1hcHMuTWFwKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCAnbWFwLWNvbnRlaW5lcicgKSwgbWFwT3B0aW9ucyk7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgdmFyIGJ1bGxldCA9IHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiAnaW1hZ2VzL21hcC1idWxsZXQucG5nJyxcbiAgICAgICAgICAgICAgICAgICAgc2l6ZTogbmV3IGdvb2dsZS5tYXBzLlNpemUoMzksIDUyKSxcbiAgICAgICAgICAgICAgICAgICAgb3JpZ2luOiBuZXcgZ29vZ2xlLm1hcHMuUG9pbnQoMCwwKSxcbiAgICAgICAgICAgICAgICAgICAgYW5jaG9yOiBuZXcgZ29vZ2xlLm1hcHMuUG9pbnQoMzksIDUyKVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgbmV3IGdvb2dsZS5tYXBzLk1hcmtlcih7XG4gICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiBuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nKDQzLjU2OTc4NywgMzkuNzU2MzYyKSxcbiAgICAgICAgICAgICAgICAgICAgbWFwOiBtYXAsXG4gICAgICAgICAgICAgICAgICAgIGljb246IGJ1bGxldFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNhY2hlOiBmdW5jdGlvbiggcywgY2IgKVxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBhLCBnID0gW10sIGksIHgsIGNudCA9IHMubGVuZ3RoLCBwID0geyBpOiB7fSwgYWM6IDAsIGM6IDAgfSwgY2IgPSBjYiB8fCBmdW5jdGlvbigpe307XG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiB5KCBpbmRleCwgc3JjIClcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgZy5wdXNoKCBzcmMgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgaWYoIGcubGVuZ3RoID49IGNudCApXG4gICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2IuY2FsbCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICBwLmMrK1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgZm9yICh4IGluIHMpXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGEgPSBzW3hdO1xuICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICBpID0gbmV3IEltYWdlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpLnNyYyA9IGE7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGkub25sb2FkID0geSggeCwgYSApO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBwLmlbYV0gPSBpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcC5hYysrXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY2F0Y2goZSkge31cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByZXRpbmE6IGZ1bmN0aW9uKClcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBpZiggJ2RldmljZVBpeGVsUmF0aW8nIGluIHdpbmRvdyAmJiB3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpbyA9PSAyIClcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBpPTAsIHNyYywgaW1nID0gJCggJ2ltZy5yZXBsYWNlLTJ4JyApLmdldCgpLCBsID0gaW1nLmxlbmd0aDtcbiAgICAgICAgICAgICAgICAgICAgZm9yIChpOyBpPGw7IGkrKylcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgc3JjID0gaW1nW2ldLnNyYztcbiAgICAgICAgICAgICAgICAgICAgICAgIHNyYyA9IHNyYy5yZXBsYWNlKC9cXC4ocG5nfGpwZ3xnaWYpKyQvaSwgJ0AyeC4kMScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaW1nW2ldLnNyYyA9IHNyYztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBpc1VuZGVmaW5lZDogZnVuY3Rpb24oIG9iaiApXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG9iaiA9PT0gdm9pZCAwO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHVwZGF0ZUltYWdlOiBmdW5jdGlvbihlbGVtZW50KVxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGlmKCAkKGVsZW1lbnQpLmxlbmd0aCA+IDAgKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBpbWFnZSA9ICQoZWxlbWVudCkuYXR0cignc3JjJykuc3BsaXQoICc/JyApWzBdIDtcbiAgICAgICAgICAgICAgICAgICAgJChlbGVtZW50KS5hdHRyKCdzcmMnLCBpbWFnZSArICc/dj0nICsgTWF0aC5yYW5kb20oKSApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmFuZG9tOiBmdW5jdGlvbihtaW4sIG1heClcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBtaW4gPSBtaW4gfHwgMCA7XG4gICAgICAgICAgICAgICAgbWF4ID0gbWF4IHx8IDEwMCA7XG4gICAgICAgICAgICAgICAgcmV0dXJuIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqICggbWF4IC0gbWluICsgMSApKSArIG1pbiA7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgJC5hcHAubW92aWVzID0ge307XG4gICAgJC5hcHAubW92aWVzLmxvYWQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgYWxlcnQoICdsb2FkIG1vcmUnICk7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9O1xuXG4gICAgJC5hcHAubW9kdWxlLmZvcm1fdmFsaWRhdGlvbl9kZWZhdWx0ID0gZnVuY3Rpb24oJGZvcm0sIGVycm9ycykge1xuICAgICAgICAkZm9ybS5maW5kKCcuZm9ybV9lcnJvcl9ibG9jaycpLmhpZGUoKTtcbiAgICAgICAgJGZvcm0uZmluZCgnLmVycm9yJykucmVtb3ZlQ2xhc3MoJ2Vycm9yJyk7XG4gICAgICAgICRmb3JtLmZpbmQoJy5jaGVja2JveF9fbGFiZWwtZXJyb3InKS5yZW1vdmVDbGFzcygnY2hlY2tib3hfX2xhYmVsLWVycm9yJyk7XG4gICAgICAgIGlmKGVycm9ycykge1xuICAgICAgICAgICAgdmFyICRlcnJvcl9ibG9jayA9ICQoJyNmb3JtLWVycm9ycycpO1xuICAgICAgICAgICAgJGVycm9yX2Jsb2NrLmh0bWwoJycpO1xuXG4gICAgICAgICAgICBmb3IoZmllbGROYW1lIGluIGVycm9ycylcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAkZmllbGQgPSAkZm9ybS5maW5kKCdpbnB1dFtuYW1lPVwiJytmaWVsZE5hbWUrJ1wiXScpO1xuICAgICAgICAgICAgICAgICRlcnJvcl9ibG9jay5hcHBlbmQoXG4gICAgICAgICAgICAgICAgICAgIFtcbiAgICAgICAgICAgICAgICAgICAgICAgICc8c3Bhbj4nLFxuICAgICAgICAgICAgICAgICAgICAgICAgJGZpZWxkLmRhdGEoJ2Vycm9yJyksXG4gICAgICAgICAgICAgICAgICAgICAgICAnPC9zcGFuPidcbiAgICAgICAgICAgICAgICAgICAgXS5qb2luKCcnKVxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgJC5hcHAuY2FsbGJhY2tfc3RhY2sgPSB7fTtcbiAgICAkLmFwcC5jYWxsYmFja19zdGFjay5mb3JtX2FqYXhfZGVmYXVsdCA9IGZ1bmN0aW9uKCRmb3JtLCByZXNwb25zZSkge1xuICAgICAgICBpZihyZXNwb25zZS5zdGF0dXMpIHtcbiAgICAgICAgICAgIGlmKHJlc3BvbnNlLmhhc093blByb3BlcnR5KCdyZWRpcmVjdF91cmwnKSkge1xuICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gcmVzcG9uc2UucmVkaXJlY3RfdXJsO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYocmVzcG9uc2UuZXJyb3JzKSB7XG4gICAgICAgICAgICAkLmFwcC5tb2R1bGUuZm9ybV92YWxpZGF0aW9uX2RlZmF1bHQoJGZvcm0sIHJlc3BvbnNlLmVycm9ycyk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGlmKHJlc3BvbnNlLmhhc093blByb3BlcnR5KCdtZXNzYWdlJykpIHtcbiAgICAgICAgICAgICQucG9wdXAubWVzc2FnZShyZXNwb25zZS50aXRsZSwgcmVzcG9uc2UubWVzc2FnZSk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgJC5hcHAubW9kdWxlLmZvcm1fYWpheCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAkKCdib2R5Jykub24oJ3N1Ym1pdCcgLCcuZm9ybS1hamF4JywgZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgdmFyICRmb3JtID0gJCh0aGlzKTtcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgJC5hamF4KHtcbiAgICAgICAgICAgICAgICB1cmw6ICRmb3JtLmF0dHIoJ2FjdGlvbicpLFxuICAgICAgICAgICAgICAgIHR5cGU6ICgkZm9ybS5hdHRyKCdtZXRob2QnKSB8fCAncG9zdCcpLFxuICAgICAgICAgICAgICAgIGRhdGE6ICRmb3JtLnNlcmlhbGl6ZSgpLFxuICAgICAgICAgICAgICAgIGRhdGFUeXBlOiAnanNvbicsXG4gICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24ocmVzcG9uc2UpXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBpZigkZm9ybS5kYXRhKCdjYWxsYmFjaycpICYmICQuYXBwLmNhbGxiYWNrX3N0YWNrLmhhc093blByb3BlcnR5KCRmb3JtLmRhdGEoJ2NhbGxiYWNrJykpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkLmFwcC5jYWxsYmFja19zdGFja1skZm9ybS5kYXRhKCdjYWxsYmFjaycpXSgkZm9ybSwgcmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgJC5hcHAuY2FsbGJhY2tfc3RhY2suZm9ybV9hamF4X2RlZmF1bHQoJGZvcm0sIHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGlmKCByZXNwb25zZS5zdGF0dXMgPT09IHRydWUgJiYgcmVzcG9uc2UubWVzc2FnZSAhPT0gJycgKVxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkLnBvcHVwLm1lc3NhZ2UoIHJlc3BvbnNlLnRpdGxlLCByZXNwb25zZS5tZXNzYWdlICk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGVycm9yOiBmdW5jdGlvbihyZXNwb25zZSlcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICQuYXBwLmNhbGxiYWNrX3N0YWNrLmZvcm1fYWpheF9kZWZhdWx0KCRmb3JtLCByZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgIGFsZXJ0KFwiZXJyb3JcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICAkLmFwcC5tb2R1bGUudXBsb2FkX2J1dHRvbiA9IGZ1bmN0aW9uKCl7XG4gICAgICAgICQoJ2JvZHknKS5vbignc3VibWl0JyAsJy5mb3JtLWZpbGUtdXBsb2FkJywgZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgcmV0dXJuIEFJTS5zdWJtaXQodGhpcywge1xuICAgICAgICAgICAgICAgIG9uU3RhcnQ6IGZ1bmN0aW9uKClcbiAgICAgICAgICAgICAgICB7XG5cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIG9uQ29tcGxldGU6IGZ1bmN0aW9uKCByZXN1bHQgKVxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgaWYoIHR5cGVvZiByZXN1bHQgPT09ICdvYmplY3QnICYmIHJlc3VsdC5zdGF0dXMgPT09IHRydWUgJiYgdHlwZW9mIHJlc3VsdC5waG90b191cmwgIT09ICd1bmRlZmluZWQnIClcbiAgICAgICAgICAgICAgICAgICAgeyB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICAgJChkb2N1bWVudCkub24oJ2NoYW5nZScsICcudXBsb2FkX2J1dHRvbl9vbmNoYW5nZScsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICBpZiggJCh0aGlzKS5jbG9zZXN0KCcudXBsb2FkX2J1dHRvbicpLmZpbmQoJy51cGxvYWRfYnV0dG9uX2ZpZWxkJykubGVuZ3RoID4gMCApXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgJCh0aGlzKS5jbG9zZXN0KCcudXBsb2FkX2J1dHRvbicpLmZpbmQoJy51cGxvYWRfYnV0dG9uX2ZpZWxkJykuaHRtbCggJCh0aGlzKS52YWwoKSApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgJC5hcHAuY3VzdG9tX3BsYWNlaG9sZGVyID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmIChNb2Rlcm5penIudG91Y2gpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgICQoJ2lucHV0LCB0ZXh0YXJlYScpLmVhY2goZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgJGlucHV0ID0gJCh0aGlzKSwgJGlucHV0V3JhcHBlciwgJHBsYWNlaG9sZGVyLCBwbGFjZWhvbGRlclRleHQgPSAkaW5wdXQuYXR0cigncGxhY2Vob2xkZXInKTtcbiAgICAgICAgICAgIGlmKHBsYWNlaG9sZGVyVGV4dCkge1xuICAgICAgICAgICAgICAgICRpbnB1dFdyYXBwZXIgPSAkaW5wdXQucGFyZW50KCk7XG4gICAgICAgICAgICAgICAgJHBsYWNlaG9sZGVyID0gJCgnPGRpdiBjbGFzcz1cImRlZmF1bHQtaW5wdXRfX3BsYWNlaG9sZGVyXCIgc3R5bGU9XCJsaW5lLWhlaWdodDogJysoJGlucHV0LmlzKCd0ZXh0YXJlYScpID8gJzM2cHgnIDogKCAkaW5wdXRXcmFwcGVyLmlubmVySGVpZ2h0KCkgPT0gMCA/ICczNicgOiAkaW5wdXRXcmFwcGVyLmlubmVySGVpZ2h0KCkgKSsncHgnKSsnXCI+JytwbGFjZWhvbGRlclRleHQrJzwvZGl2PicpO1xuICAgICAgICAgICAgICAgICRwbGFjZWhvbGRlclskaW5wdXQudmFsKCkubGVuZ3RoID8gJ2hpZGUnIDogJ3Nob3cnXSgpO1xuICAgICAgICAgICAgICAgICRpbnB1dC5hZGRDbGFzcygnY3VzdG9tLXBsYWNlaG9sZGVyJykuYXR0cigncGxhY2Vob2xkZXInLCAnJyk7XG4gICAgICAgICAgICAgICAgJGlucHV0V3JhcHBlci5hcHBlbmQoJHBsYWNlaG9sZGVyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIFxuICAgICAgICAkKCdib2R5Jykub24oJ2JsdXInLCAnLmN1c3RvbS1wbGFjZWhvbGRlcicsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyICR0aGlzID0gJCh0aGlzKTtcbiAgICAgICAgICAgIGlmKCEkdGhpcy52YWwoKS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAkdGhpcy5wYXJlbnQoKS5maW5kKCcuZGVmYXVsdC1pbnB1dF9fcGxhY2Vob2xkZXInKS5zaG93KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICAkKCdib2R5Jykub24oJ2ZvY3VzJywgJy5jdXN0b20tcGxhY2Vob2xkZXInLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICQodGhpcykucGFyZW50KCkuZmluZCgnLmRlZmF1bHQtaW5wdXRfX3BsYWNlaG9sZGVyJykuaGlkZSgpO1xuICAgICAgICB9KTtcblxuICAgICAgICAkKCdib2R5Jykub24oJ2NsaWNrJywgJy5kZWZhdWx0LWlucHV0X19wbGFjZWhvbGRlcicsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyICR0aGlzID0gJCh0aGlzKTtcbiAgICBcbiAgICAgICAgICAgICR0aGlzLmhpZGUoKTtcbiAgICAgICAgICAgICR0aGlzLnBhcmVudCgpLmZpbmQoJy5jdXN0b20tcGxhY2Vob2xkZXInKS50cmlnZ2VyKCdmb2N1cycpO1xuICAgICAgICB9KTtcbiAgICAgICAgJCgnYm9keScpLm9uKCdzZWxlY3RzdGFydCcsICcuZGVmYXVsdC1pbnB1dF9fcGxhY2Vob2xkZXInLCBmYWxzZSk7XG4gICAgfTtcblxuICAgICQuYXBwLnJ1bigpO1xufSkoalF1ZXJ5KTsiLCI7KGZ1bmN0aW9uKCQpIHtcbiAgICAkLmNhcnQgPSB7XG4gICAgICAgIGluaXRSZXF1ZXN0Q2xpY2s6IGZ1bmN0aW9uKClcbiAgICAgICAge1xuICAgICAgICAgICAgJCgnYm9keScpLm9uKCdjbGljaycsICcuai1yZW1vdmVyLXJlcXVlc3QnLCBmdW5jdGlvbihlKXtcbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgICAgICAgICB2YXIgJHJlbW92ZXIgPSAkKHRoaXMpLmNsb3Nlc3QoJy5yZW1vdmVyJyksIHByb2R1Y3QgPSAkKHRoaXMpLmRhdGEoJ2VsZW1lbnQnKSwgc3RhdHVzID0gJCh0aGlzKS5kYXRhKCdzdGF0dXMnKTtcblxuICAgICAgICAgICAgICAgIGlmIChzdGF0dXMgIT09IDApXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBpZiAoJCgnI2NhcnQtcHJvZHVjdC0nK3Byb2R1Y3QpLmxlbmd0aClcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgJCgnI2NhcnQtcHJvZHVjdC0nK3Byb2R1Y3QpLmZhZGVPdXQoZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhwcm9kdWN0ICsgJyBhcyAnICsgc3RhdHVzKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICAkcmVtb3Zlci5mYWRlT3V0KGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9LCAxNTApO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuICExO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICBcdGluaXQ6IGZ1bmN0aW9uKClcbiAgICBcdHtcbiAgICBcdFx0JC5jYXJ0LmluaXRCdXkoKTtcbiAgICBcdFx0JC5jYXJ0LmluaXRSZW1vdmUoKTtcbiAgICBcdFx0JC5jYXJ0LmluaXRDb250cm9sbCgpO1xuXG4gICAgICAgICAgICAkLmNhcnQuaW5pdFJlcXVlc3RDbGljaygpO1xuXG4gICAgICAgICAgICAkKCdib2R5Jykub24oJ2NsaWNrJywgJy5qLWNhcnQtcmVtb3ZlJywgZnVuY3Rpb24oZSl7XG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgICAgICAgICAgaWYgKCEkKHRoaXMpLmNsb3Nlc3QoJy5saXN0LWl0ZW0tZm9vdGVyJykuZmluZCgnLnJlbW92ZXInKS5sZW5ndGgpXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICB2YXIgJHJlbW92ZXIsIHByb2R1Y3QgPSAkKHRoaXMpLmRhdGEoJ2VsZW1lbnQnKTtcblxuICAgICAgICAgICAgICAgICAgICAkcmVtb3ZlciA9IFtcbiAgICAgICAgICAgICAgICAgICAgICAgICc8ZGl2IGNsYXNzPVwicmVtb3ZlclwiPicsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJzxkaXYgY2xhc3M9XCJyZW1vdmVyX19jb250ZW50XCI+JyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJzxkaXYgY2xhc3M9XCJyZW1vdmVyX190aXRsZVwiPicsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAn0JTQtdC50YHRgtCy0LjRgtC10LvRjNC90L4g0YPQtNCw0LvQuNGC0Yw/JyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJzwvZGl2PicsXG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJzxkaXYgY2xhc3M9XCJyZW1vdmVyX19idXR0b25zXCI+JyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8YSBocmVmPVwiI1wiIGRhdGEtZWxlbWVudD1cIicgKyBwcm9kdWN0ICsgJ1wiIGRhdGEtc3RhdHVzPVwiMVwiIGNsYXNzPVwicmVtb3Zlcl9fYnV0dG9uIGlzLXllcyBqLXJlbW92ZXItcmVxdWVzdFwiPtCU0LA8L2E+JyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8YSBocmVmPVwiI1wiIGRhdGEtZWxlbWVudD1cIicgKyBwcm9kdWN0ICsgJ1wiIGRhdGEtc3RhdHVzPVwiMFwiIGNsYXNzPVwicmVtb3Zlcl9fYnV0dG9uIGlzLW5vIGotcmVtb3Zlci1yZXF1ZXN0XCI+0J3QtdGCPC9hPicsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8L2Rpdj4nLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8L2Rpdj4nLFxuICAgICAgICAgICAgICAgICAgICAgICAgJzwvZGl2PidcbiAgICAgICAgICAgICAgICAgICAgXS5qb2luKCcgJyk7XG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLmNsb3Nlc3QoJy5saXN0LWl0ZW0tZm9vdGVyJykuYXBwZW5kKCRyZW1vdmVyKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyICRyZW1vdmVyID0gJCh0aGlzKS5jbG9zZXN0KCcubGlzdC1pdGVtLWZvb3RlcicpLmZpbmQoJy5yZW1vdmVyJyk7XG5cbiAgICAgICAgICAgICAgICAgICAgJHJlbW92ZXIuZmFkZU91dChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgcmV0dXJuICExO1xuICAgICAgICAgICAgfSk7XG4gICAgXHR9LFxuXG4gICAgXHRpbml0QnV5OiBmdW5jdGlvbigpXG4gICAgXHR7XG4gICAgXHRcdCQoJy5hZGQtY2FydC10cmlnZ2VyJykub24oJ2NsaWNrJywgZnVuY3Rpb24oZSl7XG4gICAgXHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIFx0XHRcdCQuY2FydC5idXlJdGVtKCAkKHRoaXMpLmF0dHIoJ2hyZWYnKS5zcGxpdCgnLScpWzFdICk7XG4gICAgXHRcdH0pO1xuICAgIFx0fSxcbiAgICBcdGluaXRDb250cm9sbDogZnVuY3Rpb24oKVxuICAgIFx0e1xuICAgIFx0XHQkKCcuaW5jcmVhc2UtY2FydC10cmlnZ2VyJykub24oJ2NsaWNrJywgZnVuY3Rpb24oZSl7XG4gICAgXHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIFx0XHRcdCQuY2FydC5pbmNyZWFzZSggJCh0aGlzKS5hdHRyKCdocmVmJykuc3BsaXQoJy0nKVsxXSApO1xuICAgIFx0XHR9KTtcblxuXHRcdFx0JCgnLmRlY3JlYXNlLWNhcnQtdHJpZ2dlcicpLm9uKCdjbGljaycsIGZ1bmN0aW9uKGUpe1xuICAgIFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcbiAgICBcdFx0XHQkLmNhcnQuZGVjcmVhc2UoICQodGhpcykuYXR0cignaHJlZicpLnNwbGl0KCctJylbMV0gKTtcbiAgICBcdFx0fSk7XG4gICAgXHR9LFxuICAgIFx0aW5pdFJlbW92ZTogZnVuY3Rpb24oKVxuICAgIFx0e1xuICAgIFx0XHQkKCcucmVtb3ZlLWNhcnQtdHJpZ2dlcicpLm9uKCdjbGljaycsIGZ1bmN0aW9uKGUpe1xuICAgIFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcbiAgICBcdFx0XHQkLmNhcnQucmVtb3ZlSXRlbSgkKHRoaXMpLmF0dHIoJ2hyZWYnKS5zcGxpdCgnLScpWzFdLCB0aGlzKTtcbiAgICBcdFx0fSk7XG4gICAgXHR9LFxuICAgIFx0cmVtb3ZlSXRlbTogZnVuY3Rpb24oaWQsIF9zZWxmXylcblx0XHR7XG5cdFx0XHQkLnBvc3QoJy9hamF4L2NhcnQvcmVtb3ZlLycsIHsgaXRlbTogaWQgfSwgZnVuY3Rpb24oZGF0YSkge1xuXHRcdFx0XHRpZiggJCgnI2xpc3QtaXRlbS0nK2lkKS5maW5kKCcuaW5jYXJ0JykubGVuZ3RoID4gMCApXG5cdFx0XHRcdHtcblx0XHRcdFx0XHQkKCcjbGlzdC1pdGVtLScraWQpLmZpbmQoJy5pbmNhcnQnKS5yZW1vdmUoKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRcblx0XHRcdFx0aWYoJChfc2VsZl8pLmhhc0NsYXNzKCdsaXN0LWl0ZW0taW5jYXJ0JykpXG5cdFx0XHRcdHtcblx0XHRcdFx0XHQkKF9zZWxmXykucmVtb3ZlKCk7XG5cdFx0XHRcdH1cblx0XHRcdFx0ZWxzZVxuXHRcdFx0XHR7XG5cdFx0XHRcdFx0JCgnI2luY2FydC1pdGVtLScraWQpLmh0bWwoICc8YSBocmVmPVwiI2l0ZW0tJytpZCsnXCIgdGl0bGU9XCLQlNC+0LHQsNCy0LjRgtGMINCyINC60L7RgNC30LjQvdGDXCIgY2xhc3M9XCJidXR0b24tY2FydCBhZGQtY2FydC10cmlnZ2VyXCI+0JrRg9C/0LjRgtGMINC60YDQtdGB0LvQvjwvYT4nICk7XG5cdFx0XHRcdFx0JC5jYXJ0LmluaXRCdXkoKTtcblx0XHRcdFx0fVxuXG5cdFx0ICAgICAgICAkLmNhcnQuYWRkZWRJdGVtKCfQotC+0LLQsNGAINGD0LTQsNC70LXQvSDQuNC3INC60L7RgNC30LjQvdGLLicpO1xuXHRcdFx0fSk7XG5cdFx0fSxcblx0XHRidXlJdGVtOiBmdW5jdGlvbihpZClcblx0XHR7XG5cdFx0XHR2YXIgY291bnQgPSAxO1xuXHRcdFx0XG5cdFx0XHRpZiggJCgnI2NvdW50LScraWQpLmxlbmd0aCA+IDAgKSB7XG5cdFx0XHRcdGNvdW50ID0gcGFyc2VJbnQoICQoJyNjb3VudC0nK2lkKS52YWwoKSApIDtcblx0XHRcdH1cblxuXHRcdFx0JC5wb3N0KCcuLi9jYXJ0Lmpzb24nLCB7IGl0ZW06IGlkLCBjb3VudDogY291bnQgfSwgZnVuY3Rpb24oZGF0YSkge1xuXHRcdFx0XHRpZiggJCgnI2NhcnQtY291bnQnKS5sZW5ndGggPiAwIClcblx0XHRcdFx0e1xuXHRcdFx0XHRcdCQoJyNjYXJ0LWNvdW50JykuaHRtbCggZGF0YS5jb3VudCApO1xuXHRcdFx0XHR9XG5cdFx0XHRcdFxuXHRcdFx0XHRpZiggJCgnI2NhcnQtcHJpY2UnKS5sZW5ndGggPiAwIClcblx0XHRcdFx0e1xuXHRcdFx0XHRcdCQoJyNjYXJ0LXByaWNlJykuaHRtbCggZGF0YS5tb25leSApO1xuXHRcdFx0XHR9XG5cdFx0XHRcdFxuXHRcdFx0XHRpZiggJCgnI2NvdW50LScraWQpLmxlbmd0aCA+IDAgKVxuXHRcdFx0XHR7XG5cdFx0XHRcdFx0JCgnI2NvdW50LScraWQpLnZhbCgxKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmKCAkKCcjbGlzdC1pdGVtLScraWQpLmZpbmQoJy5pbmNhcnQnKS5sZW5ndGggPT0gMCApIHtcblx0XHRcdFx0XHQkKCcjaW5jYXJ0LWl0ZW0tJytpZCkuaHRtbCggJzxhIGhyZWY9XCIjaXRlbS0nICsgaWQgKyAnXCIgdGl0bGU9XCLQo9C00LDQu9C40YLRjCDQuNC3INC60L7RgNC30LjQvdGLXCIgY2xhc3M9XCJidXR0b24tcmVtb3ZlIHJlbW92ZS1jYXJ0LXRyaWdnZXJcIj7QmtGA0LXRgdC70L4g0LIg0LrQvtGA0LfQuNC90LU8L2E+JyApO1xuXG5cdFx0XHRcdFx0JC5jYXJ0LmluaXRSZW1vdmUoKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdCQuY2FydC5hZGRlZEl0ZW0oKTtcblx0XHRcdH0sICdKU09OJyk7XG5cdFx0fSxcblx0XHRhZGRlZEl0ZW06IGZ1bmN0aW9uKHRleHQsIGxhcmdlKVxuXHRcdHtcblx0XHQgICAgdGV4dCA9ICF0ZXh0ID8gJ9Ci0L7QstCw0YAg0LTQvtCx0LDQstC70LXQvSDQsiDQutC+0YDQt9C40L3Rgy4nIDogdGV4dCA7XG5cdFx0ICAgIGxhcmdlID0gIWxhcmdlID8gZmFsc2UgOiBsYXJnZSA7XG5cdFx0ICAgIHZhciB0aW1lb3V0ID0gIWxhcmdlID8gMTUwMCA6IDUwMDAsIGFkZGNsYXNzID0gIWxhcmdlID8gJycgOiAnIGFkZGluZy1sYXJnZScgO1xuXHRcdCAgICBcblx0XHQgICAgaWYoICQoJ2JvZHknKS5maW5kKCcjaXRlbS1hZGRlZC10by1jYXJ0JykubGVuZ3RoID09IDAgKSB7XG5cdFx0ICAgICAgICAkKCdib2R5JykuYXBwZW5kKCc8ZGl2IGlkPVwiaXRlbS1hZGRlZC10by1jYXJ0XCIgY2xhc3M9XCJzaG93YWRkaW5nJyArIGFkZGNsYXNzICsgJ1wiPjxkaXYgY2xhc3M9XCJhZGRpbmctaW5uZXJcIj48ZGl2IGNsYXNzPVwiYWRkaW5nLWNvbnRlbnRcIj4nICsgdGV4dCArICc8L2Rpdj48L2Rpdj48L2Rpdj4nKTtcblx0XHQgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKXtcblx0XHQgICAgICAgICAgICAkKCdib2R5JykuZmluZCgnI2l0ZW0tYWRkZWQtdG8tY2FydCcpLnJlbW92ZSgpIDtcblx0XHQgICAgICAgIH0sdGltZW91dCk7XG5cdFx0ICAgIH1cblx0XHQgICAgZWxzZSB7XG5cdFx0ICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7XG5cdFx0ICAgICAgICAgICAgJCgnYm9keScpLmZpbmQoJyNpdGVtLWFkZGVkLXRvLWNhcnQnKS5yZW1vdmUoKSA7XG5cdFx0ICAgICAgICB9LHRpbWVvdXQpO1xuXHRcdCAgICB9XG5cdFx0fSxcblx0XHRpbmNyZWFzZTogZnVuY3Rpb24oaWQpXG5cdFx0e1xuXHRcdFx0aWYoICQoJyNjb3VudC0nK2lkKS5sZW5ndGggPiAwICkge1xuXHRcdCAgICAgICAgdmFyIHZhbHVlID0gcGFyc2VJbnQoICQoJyNjb3VudC0nK2lkKS52YWwoKSApIDtcblx0XHQgICAgICAgICAgICB2YWx1ZSA9ICF2YWx1ZSA/IDAgOiB2YWx1ZSA7XG5cdFx0ICAgICAgICAgICAgXG5cdFx0ICAgICAgICAgICAgdmFsdWUrKyA7XG5cdFx0ICAgICAgICAgICAgXG5cdFx0ICAgICAgICAgICAgJCgnI2NvdW50LScraWQpLnZhbCggdmFsdWUgKSA7XG5cdFx0ICAgIH1cblx0XHRcdFxuXHRcdFx0aWYoJCgnI2NhcnQtdGFibGUnKS5sZW5ndGggPiAwKVxuXHRcdFx0e1xuXHRcdFx0XHQkLmNhcnQucmVUb3RhbChpZCk7XG5cdFx0XHR9XG5cdFx0fSxcblx0XHRkZWNyZWFzZTogZnVuY3Rpb24oaWQpXG5cdFx0e1xuXHRcdFx0aWYoICQoJyNjb3VudC0nK2lkKS5sZW5ndGggPiAwIClcblx0XHRcdHtcblx0XHRcdFx0dmFyIHZhbHVlID0gcGFyc2VJbnQoICQoJyNjb3VudC0nK2lkKS52YWwoKSApIDtcblx0XHRcdFx0XHR2YWx1ZSA9ICF2YWx1ZSA/IDEgOiB2YWx1ZSA7XG5cdFx0XHRcdFx0XG5cdFx0XHRcdFx0aWYoIHZhbHVlID49IDIgKSB2YWx1ZS0tIDtcblx0XHRcdFx0XHRlbHNlIHZhbHVlID0gMSA7XG5cdFx0XHRcdFx0XG5cdFx0XHRcdFx0JCgnI2NvdW50LScraWQpLnZhbCggdmFsdWUgKSA7XG5cdFx0XHR9XG5cdFx0XHRcblx0XHRcdGlmKCQoJyNjYXJ0LXRhYmxlJykubGVuZ3RoID4gMClcblx0XHRcdHtcblx0XHRcdFx0JC5jYXJ0LnJlVG90YWwoaWQpO1xuXHRcdFx0fVxuXHRcdH0sXG5cdFx0cmVUb3RhbDogZnVuY3Rpb24oaWQpXG5cdFx0e1xuXHRcdFx0aWYoICQoJyNjb3VudC0nK2lkKS5sZW5ndGggPiAwIClcblx0XHRcdHtcblx0XHRcdFx0dmFyIGNvdW50ID0gcGFyc2VJbnQoICQoJyNjb3VudC0nK2lkKS52YWwoKSApO1xuXHRcdFx0XHRcblx0XHRcdFx0JC5wb3N0KCcvYWpheC9jYXJ0L3JlY291bnQvJywgeyBpdGVtOiBpZCwgY291bnQ6IGNvdW50IH0sIGZ1bmN0aW9uKGRhdGEpIHtcblx0XHRcdFx0XHR2YXIgcHJpY2UgPSBwYXJzZUludCggJCgnI2NhcnQtaXRlbS1wcmljZS0nK2lkKS5odG1sKCkgKTtcblx0XHRcdFx0XHR2YXIgdG90YWwgPSBjb3VudCAqIHByaWNlO1xuXG5cdFx0XHRcdFx0JCgnI2NhcnQtaXRlbS10b3RhbC0nK2lkKS5odG1sKHRvdGFsKSA7XG5cdFx0XHRcdFx0JCgnI2NhcnQtdG90YWwtY291bnQnKS5odG1sKGRhdGEuY291bnQpO1xuXHRcdFx0XHRcdCQoJyNjYXJ0LXRvdGFsLXByaWNlJykuaHRtbChkYXRhLm1vbmV5KTtcblxuXHRcdFx0XHRcdGlmKCAkKCcjY2FydC1jb3VudCcpLmxlbmd0aCA+IDAgKVxuXHRcdFx0XHRcdHtcblx0XHRcdFx0XHRcdCQoJyNjYXJ0LWNvdW50JykuaHRtbCggZGF0YS5jb3VudCApO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcblx0XHRcdFx0XHRpZiggJCgnI2NhcnQtcHJpY2UnKS5sZW5ndGggPiAwIClcblx0XHRcdFx0XHR7XG5cdFx0XHRcdFx0XHQkKCcjY2FydC1wcmljZScpLmh0bWwoIGRhdGEubW9uZXkgKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0sICdKU09OJyk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0JC5jYXJ0LmluaXQoKTtcbn0pKGpRdWVyeSk7Il19
